<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iblviewer.utils &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataJoint</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dj_docs/dj_introduction.html">Introduction to DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dj_docs/dj_public.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dj_docs/dj_credentials.html">DataJoint credentials for internal IBL users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../public_docs/public_introduction.html">Publicly available IBL data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../06_examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/dj_intro/dj_intro.html">Datajoint Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/dj_basics/dj_basics.html">Exploring the IBL Data Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Detailed Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>iblviewer.utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for iblviewer.utils</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">vtk.util.numpy_support</span> <span class="kn">import</span> <span class="n">numpy_to_vtk</span><span class="p">,</span> <span class="n">vtk_to_numpy</span><span class="p">,</span> <span class="n">numpy_to_vtkIdTypeArray</span>
<span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">import</span> <span class="nn">vedo</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c1">#import trimesh</span>


<span class="n">ROOT_FOLDER</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
<span class="n">ASSETS_FOLDER</span> <span class="o">=</span> <span class="n">ROOT_FOLDER</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;./iblviewer_assets&#39;</span><span class="p">)</span>
<span class="n">FONTS_FOLDER</span> <span class="o">=</span> <span class="n">ASSETS_FOLDER</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;./fonts&#39;</span><span class="p">)</span>
<span class="n">EXAMPLES_FOLDER</span> <span class="o">=</span> <span class="n">ROOT_FOLDER</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;./iblviewer_examples&#39;</span><span class="p">)</span>
<span class="n">EXAMPLES_DATA_FOLDER</span> <span class="o">=</span> <span class="n">ROOT_FOLDER</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;./iblviewer_examples/data&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="get_type"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_type">[docs]</a><span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the type of object as a string</span>
<span class="sd">    :return: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_unique_name"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_unique_name">[docs]</a><span class="k">def</span> <span class="nf">get_unique_name</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">spacer</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a unique key for a collection by appending numbers when entries exist</span>
<span class="sd">    :param collection: A list, collection, array, ...</span>
<span class="sd">    :param name: Name (for instance &#39;Points&#39;)</span>
<span class="sd">    :param spacer: Spacer char</span>
<span class="sd">    :return: New name, for instance &#39;Points_4&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">similar_ones</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">name</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">similar_ones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">spacer</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spacer</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">max_value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">similar_ones</span><span class="p">),</span> <span class="n">max_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">spacer</span><span class="si">}{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span></div>
    

<div class="viewcode-block" id="numpy2vtk"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.numpy2vtk">[docs]</a><span class="k">def</span> <span class="nf">numpy2vtk</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a numpy array into a vtkDataArray</span>
<span class="sd">    :param arr: Array</span>
<span class="sd">    :param dtype: Data type. Allows to set a specific data type to the VTK array</span>
<span class="sd">    :param deep: Whether a deep copy is made. Defaults to True</span>
<span class="sd">    :param name: Name of the array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dtype</span><span class="o">!=</span><span class="s1">&#39;id&#39;</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">and</span> <span class="n">dtype</span><span class="o">==</span><span class="s1">&#39;id&#39;</span><span class="p">:</span>
        <span class="n">varr</span> <span class="o">=</span> <span class="n">numpy_to_vtkIdTypeArray</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">varr</span> <span class="o">=</span> <span class="n">numpy_to_vtk</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">varr</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">varr</span></div>


<div class="viewcode-block" id="spherical_degree_angles_to_xyz"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.spherical_degree_angles_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">spherical_degree_angles_to_xyz</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert spherical degree angles to XYZ coordinates</span>
<span class="sd">    :param radius: Radius</span>
<span class="sd">    :param theta: Theta angle value in degrees</span>
<span class="sd">    :param phi: Phi angle value in degrees</span>
<span class="sd">    :return: List of 3 coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vedo</span><span class="o">.</span><span class="n">spher2cart</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">theta</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> </div>


<div class="viewcode-block" id="pick_object"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.pick_object">[docs]</a><span class="k">def</span> <span class="nf">pick_object</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">event_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pick an object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">GetEventPosition</span><span class="p">()</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">FindPokedRenderer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="o">.</span><span class="n">picker</span><span class="p">:</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPropPicker</span><span class="p">()</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">PickProp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">picked2d</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">GetLastEventPosition</span><span class="p">()</span>
    <span class="n">actor</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span>
    <span class="n">delta3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">picked3d</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">picker</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">picker</span>
    <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Ok, this is tricky. I found out that vtkPropPicker, even</span>
        <span class="c1"># if it optimized, can fail at detecting a simple mesh</span>
        <span class="c1"># so we use the vtkPicker as fall back plan</span>
        <span class="n">picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPicker</span><span class="p">()</span>
        <span class="n">picker</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">picked3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">picker</span><span class="o">.</span><span class="n">GetPickPosition</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="c1"># There is a bug with transparent objects or objects that do not have ForceOpaqueOn()</span>
            <span class="c1"># which prevents picked3d from being valid so we have to use another picking method</span>
            <span class="n">cell_picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellPicker</span><span class="p">()</span>
            <span class="n">cell_picker</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cell_picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span> <span class="o">==</span> <span class="n">actor</span><span class="p">:</span>
                <span class="n">picked3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell_picker</span><span class="o">.</span><span class="n">GetPickPosition</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delta3d</span> <span class="o">=</span> <span class="n">picked3d</span> <span class="o">-</span> <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span> <span class="o">=</span> <span class="n">picked3d</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">GetActor2D</span><span class="p">()</span>

    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">xp</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">yp</span>

    <span class="n">event_dict</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dotdict</span><span class="p">({</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">event_name</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">cid</span><span class="p">,</span>
        <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">priority</span><span class="p">,</span>
        <span class="s2">&quot;at&quot;</span><span class="p">:</span> <span class="n">plot</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="p">),</span>
        <span class="s2">&quot;actor&quot;</span><span class="p">:</span> <span class="n">actor</span><span class="p">,</span>
        <span class="s2">&quot;picked3d&quot;</span><span class="p">:</span> <span class="n">picked3d</span><span class="p">,</span>
        <span class="s2">&quot;keyPressed&quot;</span><span class="p">:</span> <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">GetKeySym</span><span class="p">(),</span>
        <span class="s2">&quot;picked2d&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
        <span class="s2">&quot;delta2d&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span>
        <span class="s2">&quot;angle2d&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">dx</span><span class="p">),</span>
        <span class="s2">&quot;speed2d&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">),</span>
        <span class="s2">&quot;delta3d&quot;</span><span class="p">:</span> <span class="n">delta3d</span><span class="p">,</span>
        <span class="s2">&quot;speed3d&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">delta3d</span><span class="p">,</span><span class="n">delta3d</span><span class="p">)),</span>
        <span class="s2">&quot;isPoints&quot;</span><span class="p">:</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Points</span><span class="p">),</span>
        <span class="s2">&quot;isMesh&quot;</span><span class="p">:</span>     <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">),</span>
        <span class="s2">&quot;isAssembly&quot;</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Assembly</span><span class="p">),</span>
        <span class="s2">&quot;isVolume&quot;</span><span class="p">:</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">),</span>
        <span class="s2">&quot;isPicture&quot;</span><span class="p">:</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Picture</span><span class="p">),</span>
        <span class="s2">&quot;isActor2D&quot;</span><span class="p">:</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor2D</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">event_dict</span></div>


<div class="viewcode-block" id="add_callback"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.add_callback">[docs]</a><span class="k">def</span> <span class="nf">add_callback</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Modified function from vedo. The issue is that the way vedo (and pyvista for that matter)</span>
<span class="sd">    is structured is that it helps using vtk but sometimes hinders using it with code that makes</span>
<span class="sd">    assumptions we don&#39;t want.</span>

<span class="sd">    Add a function to be executed while show() is active.</span>
<span class="sd">    Information about the event can be acquired with method ``getEvent()``.</span>
<span class="sd">    Return a unique id for the callback.</span>
<span class="sd">    The callback function (see example below) exposes a dictionary</span>
<span class="sd">    Frequently used events are:</span>
<span class="sd">        - KeyPress, KeyRelease: listen to keyboard events</span>
<span class="sd">        - LeftButtonPress, LeftButtonRelease: listen to mouse clicks</span>
<span class="sd">        - MiddleButtonPress, MiddleButtonRelease</span>
<span class="sd">        - RightButtonPress, RightButtonRelease</span>
<span class="sd">        - MouseMove: listen to mouse pointer changing position</span>
<span class="sd">        - MouseWheelForward, MouseWheelBackward</span>
<span class="sd">        - Enter, Leave: listen to mouse entering or leaving the window</span>
<span class="sd">        - Pick, StartPick, EndPick: listen to object picking</span>
<span class="sd">        - ResetCamera, ResetCameraClippingRange</span>
<span class="sd">        - Error, Warning</span>
<span class="sd">        - Char</span>
<span class="sd">        - Timer</span>
<span class="sd">    Check the complete list of events here:</span>
<span class="sd">        https://vtk.org/doc/nightly/html/classvtkCommand.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Processing names is removed from vedo function</span>
    <span class="c1"># Also the whole thing is refactored with improved picking</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">iren</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">event_dict</span> <span class="o">=</span> <span class="n">pick_object</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">cid</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>

    <span class="n">cid</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cid</span></div>


<div class="viewcode-block" id="get_file_name"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_file_name">[docs]</a><span class="k">def</span> <span class="nf">get_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get full file name</span>
<span class="sd">    :param file_name: File name without extension</span>
<span class="sd">    :param extension: File extension</span>
<span class="sd">    :return: File name with extension</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">extension</span><span class="p">):</span>
        <span class="n">full_file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">full_file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">full_file_name</span></div>


<div class="viewcode-block" id="get_local_data_file_path"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_local_data_file_path">[docs]</a><span class="k">def</span> <span class="nf">get_local_data_file_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">,</span> <span class="n">sub_folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get data path</span>
<span class="sd">    :param file_name: File name without extension</span>
<span class="sd">    :param extension: File extension</span>
<span class="sd">    :return: File path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ASSETS_FOLDER</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">sub_folder</span><span class="p">,</span> <span class="n">get_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_surface_mesh_path"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_surface_mesh_path">[docs]</a><span class="k">def</span> <span class="nf">get_surface_mesh_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">meshes_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;ply&#39;</span><span class="p">,</span> <span class="n">default_meshes_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a surface mesh file path</span>
<span class="sd">    :param file_name: File name without extension</span>
<span class="sd">    :param meshes_path: Folder path. If None given, this method will look into the data folder of iblviewer</span>
<span class="sd">    :param extension: File extension</span>
<span class="sd">    :param default_meshes_path: Fallback local or remote path</span>
<span class="sd">    :return: Full mesh file path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">meshes_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">region_mesh_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_local_data_file_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">,</span> <span class="s1">&#39;surfaces&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">region_mesh_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">default_meshes_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">region_mesh_path</span> <span class="o">=</span> <span class="n">default_meshes_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">region_mesh_path</span> <span class="o">=</span> <span class="s1">&#39;https://raw.github.com/int-brain-lab/iblviewer/main/iblviewer_assets/surfaces/&#39;</span>
            <span class="n">region_mesh_path</span> <span class="o">+=</span> <span class="n">get_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">region_mesh_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meshes_path</span><span class="p">,</span> <span class="n">get_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">region_mesh_path</span></div>


<div class="viewcode-block" id="load_surface_mesh"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.load_surface_mesh">[docs]</a><span class="k">def</span> <span class="nf">load_surface_mesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">meshes_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;ply&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a surface mesh with vedo.</span>
<span class="sd">    :param file_name: File name without extension</span>
<span class="sd">    :param meshes_path: Folder path. If None given, this method will look into the data folder of iblviewer</span>
<span class="sd">    :param extension: File extension</span>
<span class="sd">    :return: Mesh or None if path is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">get_surface_mesh_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">meshes_path</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">vedo</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="change_file_name"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.change_file_name">[docs]</a><span class="k">def</span> <span class="nf">change_file_name</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change the file name from the given file path</span>
<span class="sd">    :param file_path: Input file path</span>
<span class="sd">    :param prefix: Prefix to the file name</span>
<span class="sd">    :param name: Whether a new name is set instead of the current name.</span>
<span class="sd">        If None, the current file name is used.</span>
<span class="sd">    :param suffix: Suffix to the file name</span>
<span class="sd">    :return: New file path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span></div>


<div class="viewcode-block" id="split_path"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.split_path">[docs]</a><span class="k">def</span> <span class="nf">split_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split any given file path to folder path, file name and extension</span>
<span class="sd">    :return: Folder path, file name and extension</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">base_name</span><span class="p">)],</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">extension</span></div>


<div class="viewcode-block" id="time_diff"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.time_diff">[docs]</a><span class="k">def</span> <span class="nf">time_diff</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a time difference in seconds</span>
<span class="sd">    :param t: Time</span>
<span class="sd">    :return: Number of seconds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span>  <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">t</span>
    <span class="k">return</span> <span class="n">duration</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span></div>


<div class="viewcode-block" id="recompute_normals"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.recompute_normals">[docs]</a><span class="k">def</span> <span class="nf">recompute_normals</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="n">pdnorm</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataNormals</span><span class="p">()</span>
    <span class="n">pdnorm</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">pdnorm</span><span class="o">.</span><span class="n">ComputePointNormalsOn</span><span class="p">()</span>
    <span class="n">pdnorm</span><span class="o">.</span><span class="n">ComputeCellNormalsOn</span><span class="p">()</span>
    <span class="n">pdnorm</span><span class="o">.</span><span class="n">FlipNormalsOff</span><span class="p">()</span>
    <span class="n">pdnorm</span><span class="o">.</span><span class="n">ConsistencyOn</span><span class="p">()</span>
    <span class="n">pdnorm</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pdnorm</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span> <span class="c1">#self._data</span></div>


<div class="viewcode-block" id="get_actor_center"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_actor_center">[docs]</a><span class="k">def</span> <span class="nf">get_actor_center</span><span class="p">(</span><span class="n">actor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the absolute center position of an actor</span>
<span class="sd">    :param actor: VTK actor</span>
<span class="sd">    :return: 3d array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">actor</span><span class="o">.</span><span class="n">center</span><span class="p">()</span> <span class="o">+</span> <span class="n">actor</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">actor</span><span class="o">.</span><span class="n">centerOfMass</span><span class="p">()</span> <span class="o">+</span> <span class="n">actor</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="c1"># TODO: check that this is necessary (adding pos)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="get_actor_bounds"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_actor_bounds">[docs]</a><span class="k">def</span> <span class="nf">get_actor_bounds</span><span class="p">(</span><span class="n">actor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the bounds of an actor as xmin, xmax, ymin, ymax, zmin, zmax</span>
<span class="sd">    :param actor: VTK actor</span>
<span class="sd">    :return: Array with 6 values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()</span> <span class="o">*</span> <span class="n">actor</span><span class="o">.</span><span class="n">spacing</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">get_actor_center</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">actor</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="get_actor_dimensions"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_actor_dimensions">[docs]</a><span class="k">def</span> <span class="nf">get_actor_dimensions</span><span class="p">(</span><span class="n">actor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the dimensions of an actor</span>
<span class="sd">    :param actor: VTK actor</span>
<span class="sd">    :return: 3d array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">actor</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()</span> <span class="o">*</span> <span class="n">actor</span><span class="o">.</span><span class="n">spacing</span><span class="p">()</span><span class="c1"># equivalent to self.model.resolution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="get_bounding_planes"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_bounding_planes">[docs]</a><span class="k">def</span> <span class="nf">get_bounding_planes</span><span class="p">(</span><span class="n">actor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get bounding planes for an actor</span>
<span class="sd">    :param actor: VTK actor</span>
<span class="sd">    :return: vtkPlanes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">planes</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlanes</span><span class="p">()</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">SetBounds</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">planes</span></div>


<div class="viewcode-block" id="get_planes_bounds"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_planes_bounds">[docs]</a><span class="k">def</span> <span class="nf">get_planes_bounds</span><span class="p">(</span><span class="n">planes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the bounding box coordinates of a series of planes.</span>
<span class="sd">    [WARNING] Only works for six planes (box mode) at the moment</span>
<span class="sd">    :param planes: vtkPlaneCollection</span>
<span class="sd">    :return: 6 values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">planes</span><span class="o">.</span><span class="n">GetNumberOfItems</span><span class="p">()):</span>
        <span class="n">plane</span> <span class="o">=</span> <span class="n">planes</span><span class="o">.</span><span class="n">GetItem</span><span class="p">(</span><span class="n">p_id</span><span class="p">)</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plane</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">())</span>
        <span class="n">origins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
    <span class="c1"># We don&#39;t want zeros to be accounted for so we select planes of interest</span>
    <span class="c1"># First x planes, then y planes, then z ones. To be improved/generalized.</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span>
    <span class="n">mi_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">origins</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">origins</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">mi_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">origins</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">origins</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">mi_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">origins</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ma_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">origins</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mi_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ma_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mi_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ma_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mi_z</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ma_z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_transformation_matrix"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.get_transformation_matrix">[docs]</a><span class="k">def</span> <span class="nf">get_transformation_matrix</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get transformation matrix for a plane given by its origin and normal</span>
<span class="sd">    :param origin: Origin 3D vector</span>
<span class="sd">    :param normal: Normal 3D vector</span>
<span class="sd">    :return: Matrix and Translation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newaxis</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">versor</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
    <span class="n">initaxis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">crossvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">initaxis</span><span class="p">,</span> <span class="n">newaxis</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">initaxis</span><span class="p">,</span> <span class="n">newaxis</span><span class="p">))</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">()</span>
    <span class="n">T</span><span class="o">.</span><span class="n">PostMultiply</span><span class="p">()</span>
    <span class="n">T</span><span class="o">.</span><span class="n">RotateWXYZ</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">crossvec</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">origin</span><span class="p">))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">T</span></div>


<div class="viewcode-block" id="set_clipping_planes"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.set_clipping_planes">[docs]</a><span class="k">def</span> <span class="nf">set_clipping_planes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">flip_normals</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clip the volume and move the slicing planes according the given planes</span>
<span class="sd">    :param target: vedo.Mesh (can be iblviewer.objects.Points or similar)</span>
<span class="sd">    :param planes: vtkPlanes</span>
<span class="sd">    :param flip_normals: Whether clipping normals are flipped</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">planes</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlanes</span><span class="p">):</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">planes</span>
        <span class="n">planes</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlanes</span><span class="p">()</span>
        <span class="n">planes</span><span class="o">.</span><span class="n">SetBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flip_normals</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">plane_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">planes</span><span class="o">.</span><span class="n">GetNumberOfPlanes</span><span class="p">()):</span>
            <span class="n">plane</span> <span class="o">=</span> <span class="n">planes</span><span class="o">.</span><span class="n">GetPlane</span><span class="p">(</span><span class="n">plane_id</span><span class="p">)</span>
            <span class="n">plane</span><span class="o">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plane</span><span class="o">.</span><span class="n">GetNormal</span><span class="p">())</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">target</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">SetClippingPlanes</span><span class="p">(</span><span class="n">planes</span><span class="p">)</span></div>


<div class="viewcode-block" id="probe"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.probe">[docs]</a><span class="k">def</span> <span class="nf">probe</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interaction_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">place_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">handle_size</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes a line widget on the given target</span>
<span class="sd">    :param plot: vtk plot</span>
<span class="sd">    :param target: Target object</span>
<span class="sd">    :param widget: Existing widget. In case a valid vtkLineWidget is given,</span>
<span class="sd">    it will be used and modified directly</span>
<span class="sd">    :param interaction_callback: Function that will be called every</span>
<span class="sd">    time there is an interaction with the widget. That&#39;s where</span>
<span class="sd">    you set the clipping planes to the object for instance</span>
<span class="sd">    :param point1: Initial position of point 1</span>
<span class="sd">    :param point2: Initial position of point 2</span>
<span class="sd">    :param place_factor: see vtkBoxWidget.setPlaceFactor()</span>
<span class="sd">    :param handle_size: set the relative handle size, see vtkBoxWidget.SetHandleSize()</span>
<span class="sd">    :param color: Color of the line</span>
<span class="sd">    :return: vtkLineWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existing</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLineWidget</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLineWidget</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">SetInteractor</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">SetPlaceFactor</span><span class="p">(</span><span class="n">place_factor</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">SetHandleSize</span><span class="p">(</span><span class="n">handle_size</span><span class="p">)</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
    
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">GetSelectedLineProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
    <span class="c1">#widget.GetSelectedLineProperty().SetOpacity(0.7)</span>
    <span class="k">if</span> <span class="n">point1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">point2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">PlaceWidget</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">SetPoint1</span><span class="p">(</span><span class="o">*</span><span class="n">point1</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">SetPoint2</span><span class="p">(</span><span class="o">*</span><span class="n">point2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">PlaceWidget</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">interaction_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">RemoveObservers</span><span class="p">(</span><span class="s1">&#39;InteractionEvent&#39;</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s1">&#39;InteractionEvent&#39;</span><span class="p">,</span> <span class="n">interaction_callback</span><span class="p">)</span>

    <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">widget</span></div>


<div class="viewcode-block" id="box_widget"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.box_widget">[docs]</a><span class="k">def</span> <span class="nf">box_widget</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">interaction_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">place_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                <span class="n">handle_size</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">outline_color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes a box widget on the given target</span>
<span class="sd">    :param plot: vtk plot</span>
<span class="sd">    :param target: Target object</span>
<span class="sd">    :param interaction_callback: Function that will be called every</span>
<span class="sd">        time there is an interaction with the widget. That&#39;s where</span>
<span class="sd">        you set the clipping planes to the object for instance</span>
<span class="sd">    :param place_factor: see vtkBoxWidget.setPlaceFactor()</span>
<span class="sd">    :param handle_size: set the relative handle size, see vtkBoxWidget.SetHandleSize()</span>
<span class="sd">    :param outline_color: Color of the outline</span>
<span class="sd">    :return: vtkBoxWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkBoxWidget</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">SetInteractor</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="p">)</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">SetPlaceFactor</span><span class="p">(</span><span class="n">place_factor</span><span class="p">)</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">SetHandleSize</span><span class="p">(</span><span class="n">handle_size</span><span class="p">)</span>
    <span class="c1"># TODO: handle the update event in volumes in order to choose</span>
    <span class="c1"># the best method, either axis-aligned slicing when normals</span>
    <span class="c1"># are axis-aligned, or slicing with vtkImageReslice. </span>
    <span class="c1"># Both functionalities are available in VolumeView already.</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">RotationEnabledOff</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">ScalingEnabledOn</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">TranslationEnabledOn</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">cutterWidget</span> <span class="o">=</span> <span class="n">widget</span>
    
    <span class="c1"># Only valid for vtkBoxWidget</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">OutlineCursorWiresOn</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">InsideOutOn</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">GetSelectedOutlineProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outline_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outline_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">GetOutlineProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="o">*</span><span class="n">outline_color</span><span class="p">)</span>
    <span class="c1">#widget.GetOutlineProperty().SetOpacity(0.7)</span>

    <span class="c1">#widget.SetRepresentationToOutline()</span>
    <span class="n">existing_planes</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">GetClippingPlanes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">existing_planes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_planes_bounds</span><span class="p">(</span><span class="n">existing_planes</span><span class="p">)</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">PlaceWidget</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;[Warning] Object &#39;</span> <span class="o">+</span> <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; does not have six clipping planes.&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;Placing widget is not supported atm in this configuration.&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">PlaceWidget</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">PlaceWidget</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">clip_target</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clip the target with the current box widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">clipping_planes</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlanes</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">GetPlanes</span><span class="p">(</span><span class="n">clipping_planes</span><span class="p">)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">SetClippingPlanes</span><span class="p">(</span><span class="n">clipping_planes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interaction_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">interaction_callback</span> <span class="o">=</span> <span class="n">clip_target</span>
    
    <span class="n">widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s1">&#39;InteractionEvent&#39;</span><span class="p">,</span> <span class="n">interaction_callback</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">widget</span></div>


<div class="viewcode-block" id="update_scalar_bar"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.update_scalar_bar">[docs]</a><span class="k">def</span> <span class="nf">update_scalar_bar</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">lut</span><span class="p">,</span> <span class="n">use_alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nan_color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a scalar bar with a new LUT</span>
<span class="sd">    :param sb: vtkScalarBarActor</span>
<span class="sd">    :param lut: vtkLookupTable</span>
<span class="sd">    :param use_alpha: whether alpha is used in the scalar bar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sb</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span> <span class="o">==</span> <span class="n">lut</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetUseOpacity</span><span class="p">(</span><span class="n">use_alpha</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetDrawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetDrawBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetUseBelowRangeColor</span><span class="p">():</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">DrawBelowRangeSwatchOn</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetBelowRangeAnnotation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetUseAboveRangeColor</span><span class="p">():</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">DrawAboveRangeSwatchOn</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetAboveRangeAnnotation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nan_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#lut.GetNanColor() != (0.5, 0.0, 0.0, 1.0):</span>
        <span class="n">lut</span><span class="o">.</span><span class="n">SetNanColor</span><span class="p">(</span><span class="o">*</span><span class="n">nan_color</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">DrawNanAnnotationOn</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetNanAnnotation</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="add_scalar_bar"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.add_scalar_bar">[docs]</a><span class="k">def</span> <span class="nf">add_scalar_bar</span><span class="p">(</span><span class="n">lut</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">font_color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">titleYOffset</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">titleFontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">nlabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new 2D scalar bar. This is a modified method from vedo.addons.addScalarBar</span>
<span class="sd">    :param lut: Color map LUT</span>
<span class="sd">    :param list pos: fractional x and y position in the 2D window</span>
<span class="sd">    :param list size: size of the scalarbar in pixel units (width, heigth)</span>
<span class="sd">    :param int nlabels: number of numeric labels to be shown</span>
<span class="sd">    :param bool use_alpha: retain trasparency in scalarbar</span>
<span class="sd">    :param bool horizontal: show in horizontal layout</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">font_color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">font_color</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">font_color</span><span class="p">)</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkScalarBarActor</span><span class="p">()</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetLabelFormat</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-#6.4g</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#print(sb.GetLabelFormat())</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetUseOpacity</span><span class="p">(</span><span class="n">use_alpha</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetDrawFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetDrawBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetUseBelowRangeColor</span><span class="p">():</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">DrawBelowRangeSwatchOn</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetBelowRangeAnnotation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetUseAboveRangeColor</span><span class="p">():</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">DrawAboveRangeSwatchOn</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetAboveRangeAnnotation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetNanColor</span><span class="p">()</span> <span class="o">!=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">DrawNanAnnotationOn</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetNanAnnotation</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="nb">repr</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">vedo</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">_reps</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">titprop</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">GetTitleTextProperty</span><span class="p">()</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">BoldOn</span><span class="p">()</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">ItalicOff</span><span class="p">()</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">ShadowOff</span><span class="p">()</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">font_color</span><span class="p">)</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">SetVerticalJustificationToTop</span><span class="p">()</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">SetFontSize</span><span class="p">(</span><span class="n">titleFontSize</span><span class="p">)</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">SetFontFamily</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_FONT_FILE</span><span class="p">)</span>
        <span class="n">titprop</span><span class="o">.</span><span class="n">SetFontFile</span><span class="p">(</span><span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fonts_path</span> <span class="o">+</span> <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">defaultFont</span> <span class="o">+</span><span class="s1">&#39;.ttf&#39;</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetVerticalTitleSeparation</span><span class="p">(</span><span class="n">titleYOffset</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetTitleTextProperty</span><span class="p">(</span><span class="n">titprop</span><span class="p">)</span>

    <span class="n">sb</span><span class="o">.</span><span class="n">UnconstrainedFontSizeOn</span><span class="p">()</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">DrawAnnotationsOn</span><span class="p">()</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">DrawTickLabelsOn</span><span class="p">()</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumNumberOfColors</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetOrientationToHorizontal</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetNumberOfLabels</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetTextPositionToSucceedScalarBar</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumWidthInPixels</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumHeightInPixels</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetNumberOfLabels</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetTextPositionToPrecedeScalarBar</span><span class="p">()</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumWidthInPixels</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumHeightInPixels</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumWidthInPixels</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">sb</span><span class="o">.</span><span class="n">SetMaximumHeightInPixels</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">nlabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">SetNumberOfLabels</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)</span>

    <span class="n">sctxt</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">GetLabelTextProperty</span><span class="p">()</span>
    <span class="n">sctxt</span><span class="o">.</span><span class="n">SetFontFamily</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_FONT_FILE</span><span class="p">)</span>
    <span class="n">sctxt</span><span class="o">.</span><span class="n">SetFontFile</span><span class="p">(</span><span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fonts_path</span> <span class="o">+</span> <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">defaultFont</span> <span class="o">+</span><span class="s1">&#39;.ttf&#39;</span><span class="p">)</span>
    <span class="n">sctxt</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">font_color</span><span class="p">)</span>
    <span class="n">sctxt</span><span class="o">.</span><span class="n">ItalicOff</span><span class="p">()</span>
    <span class="n">sctxt</span><span class="o">.</span><span class="n">SetShadow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sctxt</span><span class="o">.</span><span class="n">SetFontSize</span><span class="p">(</span><span class="n">titleFontSize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">SetAnnotationTextProperty</span><span class="p">(</span><span class="n">sctxt</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">PickableOff</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sb</span></div>

<div class="viewcode-block" id="add_caption_symbol"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.add_caption_symbol">[docs]</a><span class="k">def</span> <span class="nf">add_caption_symbol</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">overlay_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a 2D or 3D overlay (aka caption in VTK).</span>
<span class="sd">    Modified from vedo caption() method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#c = np.array(self.GetProperty().GetColor())/2</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if point is None:</span>
<span class="sd">        x0,x1,y0,y1,z0,z1 = self.GetBounds()</span>
<span class="sd">        pt = [(x0+x1)/2, (y0+y1)/2, z1]</span>
<span class="sd">        point = self.closestPoint(pt)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">caption</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCaptionActor2D</span><span class="p">()</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetAttachmentPoint</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetBorder</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetLeader</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sph</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">()</span>
    <span class="n">sph</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetLeaderGlyphData</span><span class="p">(</span><span class="n">sph</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetLeaderGlyphSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetMaximumLeaderGlyphSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1">#capt.SetPadding(pad)</span>
    <span class="c1">#capt.SetCaption(txt)</span>
    <span class="c1">#capt.SetWidth(width)</span>
    <span class="c1">#capt.SetHeight(height)</span>
    <span class="n">caption</span><span class="o">.</span><span class="n">SetThreeDimensionalLeader</span><span class="p">(</span><span class="ow">not</span> <span class="n">overlay_2d</span><span class="p">)</span>

    <span class="n">prop</span> <span class="o">=</span> <span class="n">caption</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>
    <span class="n">prop</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">prop</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pr = caption.GetCaptionTextProperty()</span>
<span class="sd">    pr.SetFontFamily(vtk.VTK_FONT_FILE)</span>
<span class="sd">    if &#39;LogoType&#39; in font: # special case of big file</span>
<span class="sd">        fl = vedo.io.download(&quot;https://vedo.embl.es/fonts/LogoType.ttf&quot;)</span>
<span class="sd">    else:</span>
<span class="sd">        fl = settings.fonts_path + font + &#39;.ttf&#39;</span>
<span class="sd">    if not os.path.isfile(fl):</span>
<span class="sd">        fl = font</span>
<span class="sd">    pr.SetFontFile(fl)</span>
<span class="sd">    pr.ShadowOff()</span>
<span class="sd">    pr.BoldOff()</span>
<span class="sd">    pr.FrameOff()</span>
<span class="sd">    pr.SetColor(c)</span>
<span class="sd">    pr.SetOpacity(alpha)</span>
<span class="sd">    pr.SetJustificationToLeft()</span>
<span class="sd">    if &quot;top&quot; in justify:</span>
<span class="sd">        pr.SetVerticalJustificationToTop()</span>
<span class="sd">    if &quot;bottom&quot; in justify:</span>
<span class="sd">        pr.SetVerticalJustificationToBottom()</span>
<span class="sd">    if &quot;cent&quot; in justify:</span>
<span class="sd">        pr.SetVerticalJustificationToCentered()</span>
<span class="sd">        pr.SetJustificationToCentered()</span>
<span class="sd">    if &quot;left&quot; in justify:</span>
<span class="sd">        pr.SetJustificationToLeft()</span>
<span class="sd">    if &quot;right&quot; in justify:</span>
<span class="sd">        pr.SetJustificationToRight()</span>
<span class="sd">    pr.SetLineSpacing(vspacing)</span>
<span class="sd">    self._caption = capt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">caption</span></div>


<div class="viewcode-block" id="load_gltf_mesh"><a class="viewcode-back" href="../../_autosummary/iblviewer.utils.html#iblviewer.utils.load_gltf_mesh">[docs]</a><span class="k">def</span> <span class="nf">load_gltf_mesh</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="s1">&#39;./data//brain_regions.glb&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read surface data from a binary GLTF scene</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGLTFDocumentLoader</span><span class="p">()</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGLTFReader</span><span class="p">()</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span> 
    <span class="c1">#reader.Read()</span>

    <span class="n">mb</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="n">mb</span><span class="o">.</span><span class="n">NewIterator</span><span class="p">()</span>

    <span class="n">vtk_polyobjects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">iterator</span><span class="o">.</span><span class="n">IsDoneWithTraversal</span><span class="p">():</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">GetCurrentDataObject</span><span class="p">()</span>
        <span class="n">vtk_polyobjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">iterator</span><span class="o">.</span><span class="n">GoToNextItem</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Read&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vtk_polyobjects</span><span class="p">),</span> <span class="s1">&#39;objects from glb&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    output_port = reader.GetOutputPort()</span>

<span class="sd">    mapper = vtkPolyDataMapper()</span>
<span class="sd">    mapper.SetInputConnection(output_port)</span>

<span class="sd">    actor = vtkActor()</span>
<span class="sd">    actor.SetMapper(mapper) </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">vtk_polyobjects</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>