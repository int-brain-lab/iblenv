<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iblviewer.application &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataJoint</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dj_docs/dj_introduction.html">Introduction to DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dj_docs/dj_public.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dj_docs/dj_credentials.html">DataJoint credentials for internal IBL users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../public_docs/public_introduction.html">Publicly available IBL data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../06_examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/dj_intro/dj_intro.html">Datajoint Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/dj_basics/dj_basics.html">Exploring the IBL Data Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Detailed Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>iblviewer.application</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for iblviewer.application</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">vedo.colors</span> <span class="kn">import</span> <span class="n">colorMap</span>

<span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">import</span> <span class="nn">vedo</span>

<span class="kn">from</span> <span class="nn">iblviewer.volume</span> <span class="kn">import</span> <span class="n">Volume</span><span class="p">,</span> <span class="n">VolumeModel</span><span class="p">,</span> <span class="n">VolumeController</span>
<span class="kn">from</span> <span class="nn">iblviewer.collection</span> <span class="kn">import</span> <span class="n">Collection</span>
<span class="kn">import</span> <span class="nn">iblviewer.objects</span> <span class="k">as</span> <span class="nn">obj</span>
<span class="kn">import</span> <span class="nn">iblviewer.utils</span> <span class="k">as</span> <span class="nn">utils</span>


<span class="c1"># A camera model does not necessarily reflect the view. It&#39;s a state that can be set</span>
<span class="c1"># to a view. It&#39;s also a state that can be retrieved from the view.</span>
<div class="viewcode-block" id="CameraModel"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.CameraModel">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CameraModel</span><span class="p">:</span>
    <span class="n">camera</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCamera</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">autofocus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">distance_factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">orthographic_scale_factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="UIModel"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">UIModel</span><span class="p">:</span>
    <span class="n">DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
    <span class="n">CAMERA</span> <span class="o">=</span> <span class="s1">&#39;camera&#39;</span>
    <span class="n">SCENE</span> <span class="o">=</span> <span class="s1">&#39;scene&#39;</span>
    <span class="n">OBJECT</span> <span class="o">=</span> <span class="s1">&#39;object&#39;</span>
    <span class="n">DATA</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
    <span class="n">EXPORT</span> <span class="o">=</span> <span class="s1">&#39;export&#39;</span>

    <span class="n">visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">embed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">embed_menu_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">embed_menu_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">embed_submenu_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">embed_submenu_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">embed_slider_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span>

    <span class="n">color</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
    <span class="n">background_color</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span>

    <span class="n">contexts</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="p">{},</span> <span class="n">CAMERA</span><span class="p">:</span> <span class="p">{},</span> <span class="n">SCENE</span><span class="p">:</span> <span class="p">{},</span> <span class="n">OBJECT</span><span class="p">:</span> <span class="p">{},</span> <span class="n">DATA</span><span class="p">:</span> <span class="p">{},</span> <span class="n">EXPORT</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="c1"># Font license is under https://raw.github.com/int-brain-lab/iblviewer/main/assets/fonts</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">FONTS_FOLDER</span><span class="p">)</span>
    <span class="n">font</span> <span class="o">=</span> <span class="s1">&#39;SourceSansPro-Regular&#39;</span>
    <span class="c1">#font = &#39;https://raw.github.com/int-brain-lab/iblviewer/main/assets/fonts/SourceSansPro-Regular.ttf&#39;</span>

    <span class="c1"># VTK is a nightmare for having a basic UI working...</span>
    <span class="c1"># and we need one when running in standalone or jupyter modes.</span>
    <span class="n">font_size</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">toggle_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;#bbbbbb&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;bc&#39;</span><span class="p">:[</span><span class="s1">&#39;#dddddd&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;font&#39;</span><span class="p">:</span><span class="n">font</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="n">font_size</span><span class="p">,</span> 
                    <span class="s1">&#39;bold&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;italic&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
    <span class="n">button_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;bc&#39;</span><span class="p">:[</span><span class="s1">&#39;#dddddd&#39;</span><span class="p">,</span> <span class="s1">&#39;#dddddd&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;font&#39;</span><span class="p">:</span><span class="n">font</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="n">font_size</span><span class="p">,</span> 
                    <span class="s1">&#39;bold&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;italic&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
    <span class="n">slider_config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;font&#39;</span><span class="p">:</span><span class="n">font</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">}</span>

    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT</span>
    <span class="n">context_changed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">last_context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">main_context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="UIModel.set_dark_mode"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.set_dark_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_dark_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_config</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#eeeeee&#39;</span><span class="p">,</span> <span class="s1">&#39;#eeeeee&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;#111111&#39;</span><span class="p">,</span> <span class="s1">&#39;#111111&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_config</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#444444&#39;</span><span class="p">,</span> <span class="s1">&#39;#777777&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;#cfcfcf&#39;</span><span class="p">,</span> <span class="s1">&#39;#dfdfdf&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_config</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#eeeeee&#39;</span><span class="p">,</span> <span class="s1">&#39;#eeeeee&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;#111111&#39;</span><span class="p">,</span> <span class="s1">&#39;#111111&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_config</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#444444&#39;</span><span class="p">,</span> <span class="s1">&#39;#777777&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;#cfcfcf&#39;</span><span class="p">,</span> <span class="s1">&#39;#dfdfdf&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_config</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="s1">&#39;black&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#eeeeee&#39;</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="s1">&#39;#222222&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="s1">&#39;#2d2d2d&#39;</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="s1">&#39;#eeeeee&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dark_mode</span> <span class="o">=</span> <span class="n">on</span></div>

<div class="viewcode-block" id="UIModel.all_elements"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.all_elements">[docs]</a>    <span class="k">def</span> <span class="nf">all_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">context_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_elements</span><span class="p">(</span><span class="n">context_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">elements</span></div>

<div class="viewcode-block" id="UIModel.get_elements"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.get_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div>

<div class="viewcode-block" id="UIModel.get_element"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.get_element">[docs]</a>    <span class="k">def</span> <span class="nf">get_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elements</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="UIModel.is_camera_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.is_camera_context">[docs]</a>    <span class="k">def</span> <span class="nf">is_camera_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">CAMERA</span></div>

<div class="viewcode-block" id="UIModel.is_scene_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.is_scene_context">[docs]</a>    <span class="k">def</span> <span class="nf">is_scene_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">SCENE</span></div>

<div class="viewcode-block" id="UIModel.is_object_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.is_object_context">[docs]</a>    <span class="k">def</span> <span class="nf">is_object_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">OBJECT</span></div>

<div class="viewcode-block" id="UIModel.is_data_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.is_data_context">[docs]</a>    <span class="k">def</span> <span class="nf">is_data_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">DATA</span></div>

<div class="viewcode-block" id="UIModel.is_export_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.is_export_context">[docs]</a>    <span class="k">def</span> <span class="nf">is_export_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">EXPORT</span></div>

<div class="viewcode-block" id="UIModel.is_valid_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.is_valid_context">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span></div>

<div class="viewcode-block" id="UIModel.toggle_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.toggle_context">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles between current context and given one</span>
<span class="sd">        :param context: A context string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_context</span> <span class="o">==</span> <span class="n">context</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context_changed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_context</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">context</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_context</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context_changed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_changed</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UIModel.set_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.set_context">[docs]</a>    <span class="k">def</span> <span class="nf">set_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the context</span>
<span class="sd">        :param context: A context from CONTEXTS</span>
<span class="sd">        :return: True if context was changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="ow">and</span> <span class="n">context</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#logging.error(&#39;Context &#39; + str(context) + &#39; is invalid. Ignoring it.&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="UIModel.register"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.UIModel.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register UI components (or anything else really) to the given context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_context</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="n">context</span><span class="p">][</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contexts</span><span class="p">[</span><span class="n">context</span><span class="p">][</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span></div></div>
        

<div class="viewcode-block" id="ViewerModel"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ViewerModel</span><span class="p">:</span>
    <span class="n">POINT</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span>
    <span class="n">LINE</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span>
    <span class="n">SURFACE</span> <span class="o">=</span> <span class="s1">&#39;surface&#39;</span>
    <span class="n">VOLUME</span> <span class="o">=</span> <span class="s1">&#39;volume&#39;</span>
    <span class="n">UI</span> <span class="o">=</span> <span class="s1">&#39;ui&#39;</span>
    <span class="n">OBJECTS_TYPE</span> <span class="o">=</span> <span class="p">{</span><span class="n">POINT</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">LINE</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">SURFACE</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">VOLUME</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">UI</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>

    <span class="c1"># Global application camera presets</span>
    <span class="n">X_UP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">Y_UP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">Z_UP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">X_DOWN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">Y_DOWN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">Z_DOWN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;VTK Viewer&#39;</span>
    <span class="n">window_size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1280</span><span class="p">,</span> <span class="mi">720</span><span class="p">])</span>
    <span class="n">web_window_size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">960</span><span class="p">,</span> <span class="mi">600</span><span class="p">])</span>
    <span class="n">web_ui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span>  <span class="kc">False</span>
    <span class="n">offscreen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ui</span><span class="p">:</span> <span class="n">UIModel</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">UIModel</span><span class="p">)</span>

    <span class="n">origin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="n">cameras</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="c1"># VolumeModel instances have their own SlicerModel instances (ie. box slicing)</span>
    <span class="n">volumes</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="c1"># This set is used only by independent SlicerModel instances</span>
    <span class="n">slicers</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="n">points</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="n">lines</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="n">surfaces</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="n">probes</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>
    <span class="n">luts</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Collection</span><span class="p">)</span>

    <span class="c1"># Optimization for faster interactivity with volumes</span>
    <span class="n">interactive_volume_subsampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">runtime</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">timer_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">playback_speed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1">#ms</span>
    <span class="n">animation_playing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">animation_function</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">selection_changed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">selection_point_changed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">selection</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">selection_type</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">selection_point</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Point relative to absolute origin in VTK</span>
    <span class="n">selection_relative_point</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Point relative to the origin you define</span>
    <span class="n">selection_controller</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">selection_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">selection_related_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Custom value that you assign to a volume region (optional)</span>
    <span class="n">selection_related_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Related name to the custom value</span>
    <span class="n">selection_camera_position</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">selection_marker_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">selection_text_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">selection_outline_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">selection_color_bar_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">probe_initial_point1</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">probe_initial_point2</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">outline_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">outline_color</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">outline_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">pickings</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">first_picked_position</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_picked_position</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">video_start_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">video_end_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">360.0</span>
    <span class="n">video_duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span>

    <span class="n">global_slicer</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlaneCollection</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ViewerModel.initialize"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We always want to have at least a camera</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">CameraModel</span><span class="p">())</span></div>

<div class="viewcode-block" id="ViewerModel.get_actor_type"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.get_actor_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_actor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the type of the given actor</span>
<span class="sd">        Vedo does a similar thing for some of its events:</span>
<span class="sd">        &quot;isPoints&quot;:   isinstance(actor, vedo.Points),</span>
<span class="sd">        &quot;isMesh&quot;:     isinstance(actor, vedo.Mesh),</span>
<span class="sd">        &quot;isAssembly&quot;: isinstance(actor, vedo.Assembly),</span>
<span class="sd">        &quot;isVolume&quot;:   isinstance(actor, vedo.Volume),</span>
<span class="sd">        &quot;isPicture&quot;:  isinstance(actor, vedo.Picture),</span>
<span class="sd">        &quot;isActor2D&quot;:  isinstance(actor, vtk.vtkActor2D),</span>
<span class="sd">        :param actor: vtkActor</span>
<span class="sd">        :return: String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qualified_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">actor</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">obj_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">LINE</span> <span class="ow">in</span> <span class="n">qualified_type</span><span class="p">:</span>
            <span class="n">obj_type</span> <span class="o">=</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">LINE</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="n">obj_type</span> <span class="o">=</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">SURFACE</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Points</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Spheres</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Points</span><span class="p">):</span>
            <span class="n">obj_type</span> <span class="o">=</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">POINT</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">Volume</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="n">obj_type</span> <span class="o">=</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">VOLUME</span>
        <span class="k">return</span> <span class="n">obj_type</span></div>

<div class="viewcode-block" id="ViewerModel.got_selection"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.got_selection">[docs]</a>    <span class="k">def</span> <span class="nf">got_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether a selection is set</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ViewerModel.got_new_selection"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.got_new_selection">[docs]</a>    <span class="k">def</span> <span class="nf">got_new_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether a the selection target changed</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">got_selection</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ViewerModel.is_selection_point"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.is_selection_point">[docs]</a>    <span class="k">def</span> <span class="nf">is_selection_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the type of selection is a point cloud</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">POINT</span></div>

<div class="viewcode-block" id="ViewerModel.is_selection_line"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.is_selection_line">[docs]</a>    <span class="k">def</span> <span class="nf">is_selection_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the type of selection is a set of lines</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">LINE</span></div>

<div class="viewcode-block" id="ViewerModel.is_selection_surface"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.is_selection_surface">[docs]</a>    <span class="k">def</span> <span class="nf">is_selection_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the type of selection is a surface mesh</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">SURFACE</span></div>

<div class="viewcode-block" id="ViewerModel.is_selection_volume"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.is_selection_volume">[docs]</a>    <span class="k">def</span> <span class="nf">is_selection_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the type of selection is a volume</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">VOLUME</span></div>

<div class="viewcode-block" id="ViewerModel.define_view_axis"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.ViewerModel.define_view_axis">[docs]</a>    <span class="k">def</span> <span class="nf">define_view_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">X_UP</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">Y_UP</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">Z_UP</span></div></div>


<div class="viewcode-block" id="Viewer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer">[docs]</a><span class="k">class</span> <span class="nc">Viewer</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is the container and context for having </span>
<span class="sd">    an interactive VTK viewer with a controllable scene</span>
<span class="sd">    and objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#logging.basicConfig(level=logging.DEBUG)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_window_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_windows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">ViewerModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="c1">#self.views = Collection()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_press_position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_release_position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_mouse_down</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time_series_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># UI related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes_assembly</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets_reflection</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth_picking</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_peeling_enabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">useDepthPeeling</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">useFXAA</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">multiSamples</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">alphaBitPlane</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">immediateRendering</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># This line is necessary as for some reason, </span>
        <span class="c1"># vedo&#39;s allowInteraction kills the app when we listen to TimerEvents!</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">allowInteraction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fonts_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font_path</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">defaultFont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font</span>
        <span class="n">font_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;islocal&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">font_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">font_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">font_parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font</span><span class="p">]</span> <span class="o">=</span> <span class="n">font_params</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">enableDefaultKeyboardCallbacks</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Viewer.initialize"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offscreen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed_ui</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed_font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> 
                    <span class="n">plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_window_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_windows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dark_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the controller, main entry point to the viewer</span>
<span class="sd">        :param context: Context of the visualization</span>
<span class="sd">        :param embed_ui: Whether the UI is embed within the VTK window</span>
<span class="sd">        :param embed_font_size: Embed font size. Defaults to 16 points. You might need larger values</span>
<span class="sd">            in case you have a small screen with high dpi (but VTK methods fail to detect that).</span>
<span class="sd">        :param jupyter: Whether we&#39;re running from a jupyter notebook or not</span>
<span class="sd">        :param offscreen: Whether the rendering is done offscreen (headless) or not</span>
<span class="sd">        :param plot: A vedo Plotter instance. You can either create it by yourself before hand, in case </span>
<span class="sd">            you want to have multiple windows with other stats or let the controller create a new one</span>
<span class="sd">        :param plot_window_id: Sub-window id where the 3D visualization will be displayed</span>
<span class="sd">        :param num_windows: Number of subwindows, in case you want to display your own stuff later</span>
<span class="sd">        :param render: Whether rendering occurs at the end of the initialization or not. Defaults to False</span>
<span class="sd">        :param dark_mode: Whether the viewer is in dark mode</span>
<span class="sd">        :param auto_select_first_object: Auto select the first object displayed</span>
<span class="sd">        :param silent: Whether printing to console is disabled or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IBL Viewer...&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">embed_font_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">web_ui</span> <span class="o">=</span> <span class="n">jupyter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">web_ui</span><span class="p">:</span>
            <span class="n">vedo</span><span class="o">.</span><span class="n">embedWindow</span><span class="p">(</span><span class="s1">&#39;ipyvtk&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>
        <span class="n">window_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">web_window_size</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">web_ui</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">window_size</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">num_windows</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span> 
                                    <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> 
                                    <span class="n">bg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">background_color</span><span class="p">,</span>
                                    <span class="n">offscreen</span><span class="o">=</span><span class="n">offscreen</span> <span class="ow">or</span> <span class="n">jupyter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_window_id</span> <span class="o">=</span> <span class="n">plot_window_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="o">*</span><span class="n">window_size</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_renderer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dark_mode</span><span class="p">(</span><span class="n">dark_mode</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if jupyter:</span>
<span class="sd">            self.plot.offscreen = offscreen if offscreen is not None else offscreen is None</span>
<span class="sd">            self.plot.window.SetOffScreenRendering(self.plot.offscreen)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># In cases where we are headless, this will fail because there is no interactor</span>
            <span class="c1"># but in cases where a headless window is embed into an app like Qt, this will work</span>
            <span class="c1"># So everything&#39;s fine like this</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_window_interactions</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed_ui</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_vtk_ui</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed_menu_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed_menu_y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span>
        
        <span class="c1"># Generic UI part: prepares the cursor and draws a box outline on the selected object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_selection_ui</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span><span class="p">()</span></div>
        <span class="c1">#logging.info(&#39;Initialization complete.&#39;)</span>
    
<div class="viewcode-block" id="Viewer.initialize_window_interactions"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.initialize_window_interactions">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_window_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize window interactions on the VTK window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># LeftButtonReleaseEvent does not work. You have to use EndInteractionEvent instead (go figure...)</span>
        <span class="c1"># see https://stackoverflow.com/questions/52209534</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="s1">&#39;LeftButtonPressEvent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_left_mouse_press</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="s1">&#39;EndInteractionEvent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_left_mouse_release</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s1">&#39;TimerEvent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="s1">&#39;KeyPressEvent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_key_press</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.initialize_selection_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.initialize_selection_ui">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_selection_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize selection marker and text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if self.model.ui.embed:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s1">&#39;selection_info&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> 
                                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span><span class="p">,</span> <span class="n">render</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_selection_marker</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.handle_key_press"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_key_press">[docs]</a>    <span class="k">def</span> <span class="nf">handle_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iren</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle key press events</span>
<span class="sd">        :param iren: vtk iren</span>
<span class="sd">        :param event: vtk event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">iren</span><span class="o">.</span><span class="n">GetKeySym</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;esc&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">iren</span><span class="o">.</span><span class="n">ExitCallback</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;space&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_widget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_box_widget</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.exit_interactive_mode"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.exit_interactive_mode">[docs]</a>    <span class="k">def</span> <span class="nf">exit_interactive_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exit/leave interactive mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">ExitCallback</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.toggle_dark_mode"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_dark_mode">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_dark_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle dark/light mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dark_mode</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">dark_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_dark_mode"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_dark_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_dark_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set dark mode on or off</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">set_dark_mode</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">background</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_element_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">update_ui</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">all_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">all_elements</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_elements</span><span class="p">:</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">all_elements</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_element_color</span><span class="p">(</span><span class="n">element</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_renderer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_renderer">[docs]</a>    <span class="k">def</span> <span class="nf">set_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set VTK renderer, attempts to use OSPRay, if available</span>
<span class="sd">        OSPRay is not supported (2021) by default and there is no</span>
<span class="sd">        pip wheel for it with vtk, or paraview or any vtk-based tool.</span>
<span class="sd">        So you can only rely on OSPRay if you compile it alongside VTK.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">renderer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">renderer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ospray_pass</span><span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkOSPRayPass</span><span class="p">()</span>
            <span class="n">renderer</span><span class="o">.</span><span class="n">SetPass</span><span class="p">(</span><span class="n">ospray_pass</span><span class="p">)</span>

            <span class="n">node</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkOSPRayRendererNode</span><span class="p">()</span>
            <span class="n">node</span><span class="o">.</span><span class="n">SetSamplesPerPixel</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">renderer</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">SetAmbientSamples</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">renderer</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">SetMaxFrames</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="c1"># For some reason, depth peeling is sometimes not activated</span>
        <span class="c1"># so it&#39;s further made active in volume.SlicerView.initialize_mapper()</span>
        <span class="c1"># If you don&#39;t know about depth peeling: https://vtk.org/Wiki/VTK/Depth_Peeling</span>
        <span class="k">for</span> <span class="n">renderer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">renderers</span><span class="p">:</span>
            <span class="n">renderer</span><span class="o">.</span><span class="n">UseDepthPeelingForVolumesOn</span><span class="p">()</span>
            <span class="n">renderer</span><span class="o">.</span><span class="n">SetOcclusionRatio</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
            <span class="n">renderer</span><span class="o">.</span><span class="n">SetMaximumNumberOfPeels</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.register_object"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.register_object">[docs]</a>    <span class="k">def</span> <span class="nf">register_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtk_object</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selectable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register an object as selectable by the user in the UI</span>
<span class="sd">        :param vtk_object: VTK object</span>
<span class="sd">        :param name: Name or given id. IF None, the name of the</span>
<span class="sd">        object is used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">vtk_object</span><span class="o">.</span><span class="n">name</span>
        <span class="n">existing_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_obj</span> <span class="o">!=</span> <span class="n">vtk_object</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="c1"># Then we have two same names for two different objects</span>
            <span class="c1"># let&#39;s change that</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unique_object_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_object</span>
        <span class="k">if</span> <span class="n">selectable</span><span class="p">:</span>
            <span class="n">vtk_object</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># We overwrite the vtk object&#39;s name with the new one</span>
        <span class="n">vtk_object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection_slider</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects_changed</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.get_unique_object_name"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_unique_object_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_unique_object_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">spacer</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a unique key/name for selectable objects with similar names</span>
<span class="sd">        :param name: Name (for instance &#39;Points&#39;)</span>
<span class="sd">        :param spacer: Spacer char</span>
<span class="sd">        :return: New name, for instance &#39;Points_4&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_unique_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">spacer</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.unregister_object"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.unregister_object">[docs]</a>    <span class="k">def</span> <span class="nf">unregister_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unregister an object from the selectable objects list</span>
<span class="sd">        :param name: Object name or given id or int or the object itself</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="k">break</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection_slider</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.update_selection_slider"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_selection_slider">[docs]</a>    <span class="k">def</span> <span class="nf">update_selection_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the selection slider max value</span>
<span class="sd">        :param max_value: Max value. If None, the maximum value</span>
<span class="sd">        is the length of the self.objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetMinimumValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetMaximumValue</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.register_controller"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.register_controller">[docs]</a>    <span class="k">def</span> <span class="nf">register_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">vtk_objects</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register/map VTK objects to a view</span>
<span class="sd">        :param controller: A controller instance (like VolumeController)</span>
<span class="sd">        :param vtk_objects: All objects directly related to this view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_object</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vtk_objects</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">vtk_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">vtk_objects</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">vtk_objects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">controller</span></div>

<div class="viewcode-block" id="Viewer.get_view_objects"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_view_objects">[docs]</a>    <span class="k">def</span> <span class="nf">get_view_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all view objects registered in this model</span>
<span class="sd">        :return: List</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="Viewer.get_view_objects_names"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_view_objects_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_view_objects_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get view objects names</span>
<span class="sd">        :return: Dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="p">:</span>
            <span class="n">names</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="n">names</span></div>

<div class="viewcode-block" id="Viewer.get_window"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_window">[docs]</a>    <span class="k">def</span> <span class="nf">get_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the plot window object. This is useful for displaying this window </span>
<span class="sd">        in Jupyter notebooks for instance</span>
<span class="sd">        :return: iren window object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">window</span></div>

<div class="viewcode-block" id="Viewer.render"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_to_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the current state of the viewer, optionally to a file.</span>
<span class="sd">        Supported formats are jpg, png, pdf, svg, eps</span>
<span class="sd">        :param save_to_file: File path</span>
<span class="sd">        :param width: Width of the rendered image</span>
<span class="sd">        :param height: Height of the rendered image</span>
<span class="sd">        :param scale: Rendering scale factor. Defaults to 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save_to_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_size</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">custom_size</span><span class="p">:</span>
                <span class="n">current_width</span><span class="p">,</span> <span class="n">current_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
                <span class="c1"># Set the desired size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Apparently it&#39;s better to enable the setting below when we use</span>
                <span class="c1"># scaling for larger size rendering.</span>
                <span class="c1"># There&#39;s a typo in the variable name and even the variable name</span>
                <span class="c1"># is inappropriate. This isn&#39;t a screenshot but a render. (@marcomusy)</span>
                <span class="c1"># So I put that in a try catch just in case it changes in the future...</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">screeshotLargeImage</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">vedo</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">save_to_file</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">custom_size</span><span class="p">:</span>
                <span class="c1"># Now reset the size as it was</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">current_width</span><span class="p">,</span> <span class="n">current_height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.show"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">actors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the plot and let the user interact with it</span>
<span class="sd">        :param interactive: Whether we render and make the window interactive</span>
<span class="sd">        :param actors: List of actors to show. Use this parameter only if you know what you&#39;re doing.</span>
<span class="sd">        :param at: Which VTK window to use. Defaults to 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">actors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actors_to_show</span> <span class="o">=</span> <span class="n">actors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">actors_to_show</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">actors</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#self.view_selected()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">web_ui</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Visualizer started in Web UI mode: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">runtime</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">actors_to_show</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">resetcam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#return ViewInteractiveWidget(self.plot.window)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Visualizer started: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">runtime</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1">#self.plot.window.SetWindowName()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">actors_to_show</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">resetcam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.close"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the current plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.add_callback"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_callback">[docs]</a>    <span class="k">def</span> <span class="nf">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an event listener (aka callback method)</span>
<span class="sd">        :param event_name: A VTK event name</span>
<span class="sd">        :param func: Listener function</span>
<span class="sd">        :param priority: Priority in event queue</span>
<span class="sd">        :return: Callback id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.remove_callback"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.remove_callback">[docs]</a>    <span class="k">def</span> <span class="nf">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an event listener (aka callback method)</span>
<span class="sd">        :param callback_id_or_event_name: A VTK event name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">RemoveObserver</span><span class="p">(</span><span class="n">callback_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.handle_timer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_timer">[docs]</a>    <span class="k">def</span> <span class="nf">handle_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iren</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle vtk timer event</span>
<span class="sd">        :param iren: Render window</span>
<span class="sd">        :param event: TimerEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">animation_playing</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_time_series</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">DestroyTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">timer_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.handle_left_mouse_press"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_left_mouse_press">[docs]</a>    <span class="k">def</span> <span class="nf">handle_left_mouse_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle left mouse down event. The event is triggered for any &quot;pickable&quot; object</span>
<span class="sd">        :param mesh: Selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_press_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picked2d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_mouse_down</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># 1. Make sure the click occured on a vtk actor</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">actor</span>
        <span class="k">return</span> <span class="n">actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Viewer.clear_depth_picking"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.clear_depth_picking">[docs]</a>    <span class="k">def</span> <span class="nf">clear_depth_picking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_element</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear depth picking, making all objects put in depth queue pickable again</span>
<span class="sd">        :param return_element: An element to be returned by its index of insertion</span>
<span class="sd">        :return: object and picked 3d coordinates (only if return_element is valid)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">picked3d</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">iter_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_picking</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_element</span> <span class="o">==</span> <span class="n">iter_id</span><span class="p">:</span>
                <span class="n">picked3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_picking</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">iter_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_picking</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">return_element</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">,</span> <span class="n">picked3d</span></div>

<div class="viewcode-block" id="Viewer.get_actor_type"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_actor_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_actor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get what type is the given actor</span>
<span class="sd">        :param actor: vtkActor</span>
<span class="sd">        :return: String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_actor_type</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.handle_left_mouse_release"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_left_mouse_release">[docs]</a>    <span class="k">def</span> <span class="nf">handle_left_mouse_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle left mouse up event.</span>
<span class="sd">        :param event: vtkEvent</span>
<span class="sd">        :return: Int value. 0 for invalid click, 1 for actor click, </span>
<span class="sd">        2 for double click on actor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># 1. Make sure it&#39;s left mouse context</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_mouse_down</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">state</span>

        <span class="c1"># Handle mouse click release with a workaround for bad </span>
        <span class="c1"># VTK event mgmt (LeftButtonReleaseEvent does not work)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_mouse_down</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">drag_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_press_position</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">picked2d</span><span class="p">)</span>
        <span class="c1"># 2. If delta is larger than a few pixels, it means there was a click and drag</span>
        <span class="c1"># which is not considered as a single click</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">actor</span>
        <span class="k">if</span> <span class="n">drag_delta</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_depth_picking</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_drag_release</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">state</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">isActor2D</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_actor2d_click</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">picked3d</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">picked3d</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_release_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">release_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_release_position</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">picked2d</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">release_delta</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_depth_picking</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_release_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picked2d</span><span class="p">)</span>

        <span class="c1"># 3. Make sure the click occured on a vtk actor</span>
        <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_void_click</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">state</span>

        <span class="c1"># 4. If we click on the same spot, maybe we want to select another object behind that one</span>
        <span class="n">camera_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">actor_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_actor_type</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actor_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">VOLUME</span><span class="p">:</span>
            <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Volume picking often results in a wrong coordinate so we compute it properly here</span>
                <span class="n">picked3d</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">camera_position</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picked2d</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">actor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_picking</span><span class="p">:</span>
            <span class="c1"># First disable temporarily the selected actor</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># This gets needlessly complicated but there&#39;s no other way with VTK...</span>
            <span class="c1"># So, the standard vtk.vtkPropPicker() that is hardware accelerated works</span>
            <span class="c1"># for points, lines and partly for volumes (which is why we have the pick()</span>
            <span class="c1"># method in VolumeController to readjust that).</span>
            <span class="c1"># Now, vtkPropPicker fails to work on meshes that do not have ForceOpaqueOn()</span>
            <span class="c1"># and obviously we want to keep transparency enabled so if we want to pick</span>
            <span class="c1"># a transparent mesh, we have to use vtkCellPicker and then compare results...</span>
            <span class="n">cell_picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellPicker</span><span class="p">()</span>
            <span class="n">picker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">picker</span> <span class="c1"># this is a vtk.vtkPropPicker()</span>
            
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">picked2d</span>
            <span class="n">picker</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
            <span class="n">cell_picker</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
            <span class="n">valid_result</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cell_picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">valid_result</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span> <span class="o">!=</span> <span class="n">actor</span><span class="p">:</span>
                <span class="n">actor</span> <span class="o">=</span> <span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">cell_picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">actor</span> <span class="o">=</span> <span class="n">cell_picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span>
                <span class="n">picker</span> <span class="o">=</span> <span class="n">cell_picker</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid_result</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_result</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_depth_picking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">actor</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">actor</span><span class="p">,</span> <span class="n">picked3d</span> <span class="o">=</span> <span class="n">result</span>

            <span class="n">last</span> <span class="o">=</span> <span class="n">picked3d</span>
            <span class="n">picked3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">picker</span><span class="o">.</span><span class="n">GetPickPosition</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">picked3d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_depth_picking</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span> <span class="o">=</span> <span class="n">picked3d</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;picked3d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">picked3d</span>
            <span class="n">delta3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">delta3d</span> <span class="o">=</span> <span class="n">picked3d</span> <span class="o">-</span> <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span> <span class="o">=</span> <span class="n">picked3d</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;delta3d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta3d</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;speed3d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">delta3d</span><span class="p">,</span><span class="n">delta3d</span><span class="p">))</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isPoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Points</span><span class="p">)</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isMesh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">)</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isAssembly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Assembly</span><span class="p">)</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">)</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isPicture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Picture</span><span class="p">)</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isActor2D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor2D</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth_picking</span><span class="p">[</span><span class="n">actor</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">picked3d</span>

        <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># 5. Handle double click case</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_mouse_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># We have a valid click event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_object_click</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="Viewer.handle_actor2d_click"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_actor2d_click">[docs]</a>    <span class="k">def</span> <span class="nf">handle_actor2d_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle click on a 2D actor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.handle_void_click"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_void_click">[docs]</a>    <span class="k">def</span> <span class="nf">handle_void_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle click and drag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Selection is None here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_box_widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_widget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_outline_visibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color_bar_visibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Event-like function that you may customize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">()</span></div>
        <span class="c1">#self.update_ui()</span>

<div class="viewcode-block" id="Viewer.handle_drag_release"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_drag_release">[docs]</a>    <span class="k">def</span> <span class="nf">handle_drag_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle click and drag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.handle_object_click"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_object_click">[docs]</a>    <span class="k">def</span> <span class="nf">handle_object_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle valid object selection</span>
<span class="sd">        :param actor: Selected actor</span>
<span class="sd">        :param state: Number of mouse clicks</span>
<span class="sd">        :param event: Event given by vedo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We ignore double clicks by default</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">camera_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
        <span class="c1"># If a view container is found by reverse mapping, we get it here</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">camera_position</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_outline_visibility</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_widget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_box_widget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sub_selection_changed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.objects_changed"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.objects_changed">[docs]</a>    <span class="k">def</span> <span class="nf">objects_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called when a new object is registered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.initialized"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.initialized">[docs]</a>    <span class="k">def</span> <span class="nf">initialized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called the viewer is initialized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.selection_changed"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.selection_changed">[docs]</a>    <span class="k">def</span> <span class="nf">selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called when another object is selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.sub_selection_changed"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.sub_selection_changed">[docs]</a>    <span class="k">def</span> <span class="nf">sub_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called when for the same object, a new data point is selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.get_object_names"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_object_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="Viewer.get_selectable_key_by_id"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_selectable_key_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_selectable_key_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an object by the id of the key (not by the key/name itself)</span>
<span class="sd">        This is useful for sliders</span>
<span class="sd">        :return: String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_names</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">object_ids</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">key</span></div>

    <span class="k">def</span> <span class="nf">_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">camera_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current selected object in the model</span>
<span class="sd">        :param actor: a vtkActor</span>
<span class="sd">        :param controller: Controller of the given actor (optional)</span>
<span class="sd">        :param event: a vedo event from which we use picked3d and picked2d (we could directly use vtk)</span>
<span class="sd">        :param camera_position: position of the camera (optional) at selection time</span>
<span class="sd">        :param position: The final position computed on the volume or mesh or point or line.</span>
<span class="sd">            If not given, this will be automatically calculated</span>
<span class="sd">        .param value: The value corresponding to the point on the object. If not given, this will</span>
<span class="sd">            be automatically retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_changed</span> <span class="o">=</span> <span class="n">actor</span> <span class="o">!=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point_changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_controller</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_relative_point</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_camera_position</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">mdl</span><span class="o">.</span><span class="n">selection_changed</span><span class="p">:</span>
            <span class="c1"># We assume that, even in the case where the point is the same</span>
            <span class="c1"># as before, the selection point changed because it&#39;s a different object</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point_changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">actor_type</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">get_actor_type</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">actor</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_controller</span> <span class="o">=</span> <span class="n">controller</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">=</span> <span class="n">actor_type</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># We&#39;re interested in the vedo class type like &lt;class &#39;vedo.shapes.Line&#39;&gt;</span>
            <span class="k">if</span> <span class="n">actor_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">LINE</span><span class="p">:</span>
                <span class="n">mesh_id</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span><span class="p">,</span> <span class="n">returnCellId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">)</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span>

            <span class="k">elif</span> <span class="n">actor_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">SURFACE</span><span class="p">:</span>
                <span class="n">point_id</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picked3d</span><span class="p">,</span> <span class="n">returnPointId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># Scalar values in volume are integers in this case</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">getPointArray</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">point_id</span><span class="p">]</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">picked3d</span><span class="c1"># actor.points(point_id)</span>

            <span class="k">elif</span> <span class="n">actor_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">POINT</span><span class="p">:</span>
                <span class="c1"># If on a sphere glyph, we will not get the center of it here</span>
                <span class="n">point_id</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">picked3d</span><span class="p">,</span> <span class="n">returnPointId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span>
                <span class="n">scalars</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">scalars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">point_id</span> <span class="o">&lt;</span> <span class="n">scalars</span><span class="o">.</span><span class="n">GetNumberOfValues</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">scalars</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">point_id</span><span class="p">)</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                [Optional] TODO: WIP below to have the position in the center of the glyph when using</span>
<span class="sd">                non screen-space points. </span>
<span class="sd">                # So we do another query to have the center position which</span>
<span class="sd">                # correctly represents the given data</span>
<span class="sd">                if actor.point_locator is None:</span>
<span class="sd">                    actor.point_locator = vtk.vtkPointLocator()</span>
<span class="sd">                    actor.point_locator.SetDataSet(poly)</span>
<span class="sd">                    actor.point_locator.BuildLocator()</span>
<span class="sd">                pid = point_id</span>
<span class="sd">                point_id = actor.point_locator.FindClosestPoint(actor.picked3d)</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">point_id</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">actor_type</span> <span class="o">==</span> <span class="n">ViewerModel</span><span class="o">.</span><span class="n">VOLUME</span><span class="p">:</span>
                <span class="n">position</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">camera_position</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picked2d</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">slicers_selectable</span><span class="p">:</span>
                    <span class="n">override_selection</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">if</span> <span class="n">camera_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">camera_position</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s1">&#39;volume&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">controller</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">actor</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">actor</span>

        <span class="k">if</span> <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">selection_point</span><span class="p">)</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point_changed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">position</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span>

        <span class="n">mdl</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">actor</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_type</span> <span class="o">=</span> <span class="n">actor_type</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_relative_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">-</span> <span class="n">mdl</span><span class="o">.</span><span class="n">origin</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">selection_camera_position</span> <span class="o">=</span> <span class="n">camera_position</span>

<div class="viewcode-block" id="Viewer.select"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select an object, either by its name (or subname) or by</span>
<span class="sd">        reference to the vtk object. </span>
<span class="sd">        :param target: Either the vtk actor or its name </span>
<span class="sd">            or its index (an int from object.keys())</span>
<span class="sd">        :param allow_none: Whether an invalid target is accepted</span>
<span class="sd">            as clicking on nothing (to cancel the current selection)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">target</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_none</span> <span class="ow">and</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not select object with given key&#39;</span><span class="p">,</span> 
                            <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;Please use a name from this list&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selectable_key_by_id</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_void_click</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Case where an object was removed and the user wants to add it back</span>
            <span class="k">if</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">actors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_object_click</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">autofocus</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view_selected</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.get_selection_info"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_selection_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_selection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about the current selection</span>
<span class="sd">        :return: Preformatted multiline text and a dictionary of extra data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># We display a point relative to the origin set by the user</span>
                <span class="n">relative_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_relative_point</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">X: </span><span class="si">{</span><span class="n">relative_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Y: </span><span class="si">{</span><span class="n">relative_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Z: </span><span class="si">{</span><span class="n">relative_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s1"> value: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_value</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="Viewer.update_selection_info"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_selection_info">[docs]</a>    <span class="k">def</span> <span class="nf">update_selection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update text and point information for the current selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selection_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_marker_visible</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">SetInput</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_text_visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.draw_axes"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.draw_axes">[docs]</a>    <span class="k">def</span> <span class="nf">draw_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw axes around selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_assembly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_assembly</span><span class="p">,</span> <span class="n">render</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">]</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">]</span>
        <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes_assembly</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">,</span> <span class="n">hTitleRotation</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span> 
        <span class="n">xLabelRotation</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span> <span class="n">yLabelRotation</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span> <span class="n">zLabelRotation</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span> 
        <span class="n">xTitleRotation</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span> <span class="n">yTitleRotation</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span> <span class="n">zTitleRotation</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span>
        <span class="n">labelFont</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">titleFont</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">hTitleFont</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
        <span class="n">xyGrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yzGrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zxGrid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#buildRulerAxes(actor)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_assembly</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">set_outline_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show/hide the outline</span>
<span class="sd">        :param on: Visibility boolean. If None, the value from the model will be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>

<div class="viewcode-block" id="Viewer.draw_outline"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.draw_outline">[docs]</a>    <span class="k">def</span> <span class="nf">draw_outline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_hide_if_no_selection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the bounding box of the current selection.</span>
<span class="sd">        :param auto_hide_if_no_selection: Whether we hide the outline when there is no selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">auto_hide_if_no_selection</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_outline_visibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;volume&#39;</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">):</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkVolumeOutlineSource</span><span class="p">()</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">GenerateOutlineOn</span><span class="p">()</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">outline_color</span><span class="p">)</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">SetVolumeMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">mapper</span><span class="p">())</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="n">outline</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkOutlineFilter</span><span class="p">()</span>
            <span class="c1">#outline.GenerateOutlineOn()</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">polydata</span><span class="p">())</span>
            <span class="n">outline</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Update existing outline</span>
            <span class="n">pdm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span><span class="o">.</span><span class="n">mapper</span><span class="p">()</span>
            <span class="n">pdm</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
            <span class="n">pdm</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_outline_visibility</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create a new outline object</span>
            <span class="n">pdm</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
            <span class="n">pdm</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
            <span class="n">pdm</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

            <span class="n">outline_actor</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">pdm</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
            <span class="k">if</span> <span class="s1">&#39;volume&#39;</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">):</span>
                <span class="c1"># vtkVolumeOutlineSource doesn&#39;t account for the position of the object</span>
                <span class="c1"># so we have to move the outline here</span>
                <span class="n">outline_actor</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
            <span class="n">outline_actor</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">outline_actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">outline_opacity</span><span class="p">)</span>
            <span class="n">outline_actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">outline_color</span><span class="p">)</span>
            <span class="n">outline_actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetLineWidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">outline_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span> <span class="o">=</span> <span class="n">outline_actor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">outline_actor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_segments"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_segments">[docs]</a>    <span class="k">def</span> <span class="nf">add_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">end_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;Accent&#39;</span><span class="p">,</span> 
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Segments&#39;</span><span class="p">,</span> <span class="n">use_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">relative_end_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spherical_angles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a set of segments (lines made of two points). The difference with add_lines() </span>
<span class="sd">        is that you have more options like giving spherical angles and setting relative end points.</span>
<span class="sd">        :param points: 3D numpy array of points of length n</span>
<span class="sd">        :param end_points: 3D numpy array of points of length n</span>
<span class="sd">        :param line_width: Line width, defaults to 2px</span>
<span class="sd">        :param values: 1D list of length n, for one scalar value per line</span>
<span class="sd">        :param color_map: A color map, it can be a color map built by IBLViewer or </span>
<span class="sd">            a color map name (see vedo documentation), or a list of values, etc.</span>
<span class="sd">        :param name: Name to give to the object</span>
<span class="sd">        :param use_origin: Whether the current origin (not necessarily absolute 0) is used as offset</span>
<span class="sd">        :param add_to_scene: Whether the new lines are added to scene/plot and rendered</span>
<span class="sd">        :param relative_end_points: Whether the given end point is relative to the start point. False by default,</span>
<span class="sd">            except is spherical coordinates are given</span>
<span class="sd">        :param spherical_angles: 3D numpy array of spherical angle data of length n </span>
<span class="sd">            In case end_points is None, this replaces end_points by finding the relative</span>
<span class="sd">            coordinate to each start point with the given radius/depth, theta and phi</span>
<span class="sd">        :param radians: Whether the given spherical angle data is in radians or in degrees</span>
<span class="sd">        :return: Lines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The base assumption is that points is a 2D array, each row having a start and end point</span>
        <span class="c1"># but you may also pass a 1D list of positions for points and another 1D list of </span>
        <span class="c1"># size N positions for end_points. Alternatively, you may pass spherical angles for end points.</span>
        <span class="k">if</span> <span class="n">end_points</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spherical_angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relative_end_points</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">spherical_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spherical_angles</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">radians</span><span class="p">:</span>
                <span class="n">end_points</span> <span class="o">=</span> <span class="n">spherical_angles</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">vedo</span><span class="o">.</span><span class="n">spher2cart</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end_points</span> <span class="o">=</span> <span class="n">spherical_angles</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">spherical_degree_angles_to_xyz</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">relative_end_points</span><span class="p">:</span>
                <span class="n">end_points</span> <span class="o">+=</span> <span class="n">points</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">points</span><span class="p">,</span> <span class="n">end_points</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">end_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_points</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_points</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[add_segments() error] Mismatch between start and end points length. Only </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> segments shown.&#39;</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">end_points</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">line_width</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">use_origin</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_lines"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_lines">[docs]</a>    <span class="k">def</span> <span class="nf">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;Accent&#39;</span><span class="p">,</span> 
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Lines&#39;</span><span class="p">,</span> <span class="n">use_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a set of lines with given point sets</span>
<span class="sd">        :param points: List or 2D array of 3D coordinates</span>
<span class="sd">        :param line_width: Line width, defaults to 2px</span>
<span class="sd">        :param values: 1D list of length n, for one scalar value per line</span>
<span class="sd">        :param color_map: A color map, it can be a color map built by IBLViewer or </span>
<span class="sd">            a color map name (see vedo documentation), or a list of values, etc.</span>
<span class="sd">        :param name: Name to give to the object</span>
<span class="sd">        :param use_origin: Whether the current origin (not necessarily absolute 0) is used as offset</span>
<span class="sd">        :param add_to_scene: Whether the new lines are added to scene/plot and rendered</span>
<span class="sd">        :return: objects.Lines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_origin</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">origin</span>

        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
        
        <span class="n">lines</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Lines</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">lighting</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;cells&#39;</span><span class="p">,</span> <span class="n">arrayName</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

        <span class="c1"># This method renames the object with a suffix if a conflicting name is found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_object</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_to_scene</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span></div>
        
<div class="viewcode-block" id="Viewer.add_spheres"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_spheres">[docs]</a>    <span class="k">def</span> <span class="nf">add_spheres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;Accent&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Points&#39;</span><span class="p">,</span> 
                    <span class="n">use_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new spheres. This is a shortcut for add_points(screen_space=False)</span>
<span class="sd">        :param positions: 3D array of coordinates</span>
<span class="sd">        :param radius: List same length as positions of radii. The default size is 5um, or 5 pixels</span>
<span class="sd">            in case as_spheres is False.</span>
<span class="sd">        :param values: 1D array of values, one per neuron or a time series of such 1D arrays (numpy format)</span>
<span class="sd">        :param color_map: A color map, it can be a color map built by IBLViewer or </span>
<span class="sd">            a color map name (see vedo documentation), or a list of values, etc.</span>
<span class="sd">        :param name: All point neurons are grouped into one object, you can give it a custom name</span>
<span class="sd">        :param use_origin: Whether the current origin (not necessarily absolute 0) is used as offset</span>
<span class="sd">        :param add_to_scene: Whether the new lines are added to scene/plot and rendered</span>
<span class="sd">        :return: objects.Points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If you use obj.Spheres, you have to do it this way</span>
        <span class="c1">#spheres = obj.Spheres(positions, radius, color_map, **kwargs)</span>
        <span class="c1">#spheres.cmap(color_map, values)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> 
                <span class="n">use_origin</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Viewer.add_points"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_points">[docs]</a>    <span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;Accent&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Points&#39;</span><span class="p">,</span> 
                    <span class="n">screen_space</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new points, either as screen-space dots or as 3D spheres (see screen_space param)</span>
<span class="sd">        :param positions: 3D array of coordinates</span>
<span class="sd">        :param radius: List same length as positions of radii. The default size is 5um, or 5 pixels</span>
<span class="sd">            in case as_spheres is False.</span>
<span class="sd">        :param values: 1D array of values, one per neuron or a time series of such 1D arrays (numpy format)</span>
<span class="sd">        :param color_map: A color map, it can be a color map built by IBLViewer or </span>
<span class="sd">            a color map name (see vedo documentation), or a list of values, etc.</span>
<span class="sd">        :param name: All point neurons are grouped into one object, you can give it a custom name</span>
<span class="sd">        :param screen_space: Type of point, Defaults to True. If True then the points always occupy</span>
<span class="sd">            the same amount of pixels defined by the radius, this is the fastest method to display</span>
<span class="sd">            large amount of points. If False, then points are 3D spheres and you see them larger </span>
<span class="sd">            when you zoom closer to them with the camera.</span>
<span class="sd">        :param use_origin: Whether the current origin (not necessarily absolute 0) is used as offset</span>
<span class="sd">        :param add_to_scene: Whether the new lines are added to scene/plot and rendered</span>
<span class="sd">        :return: objects.Points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_origin</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">origin</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span>
        
        <span class="c1"># You cannot easily set a time series to vedo.Spheres()</span>
        <span class="c1"># so this one of the reasons why objects.Points exists</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">screen_space</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">lighting</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="c1"># This method renames the object with a suffix if a conflicting name is found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_object</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_to_scene</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">points</span></div>

<div class="viewcode-block" id="Viewer.add_mesh"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">mesh_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a surface mesh to the scene</span>
<span class="sd">        :param file_path: Mesh file path (any kind of file supported by vedo)</span>
<span class="sd">        :param mesh_name: Name of the mesh. If None, the file name will be used.</span>
<span class="sd">        :param use_origin: Whether the origin is used in positioning the mesh</span>
<span class="sd">        :param add_to_scene: Whether the new lines are added to scene/plot and rendered</span>
<span class="sd">        :return: Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_surface_mesh</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mesh_name</span><span class="p">,</span> <span class="n">use_origin</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_surface_mesh"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_surface_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">add_surface_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">mesh_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a surface mesh to the scene</span>
<span class="sd">        :param file_path: Mesh file path (any kind of file supported by vedo)</span>
<span class="sd">        :param mesh_name: Name of the mesh. If None, the file name will be used.</span>
<span class="sd">        :param use_origin: Whether the origin is used in positioning the mesh</span>
<span class="sd">        :param add_to_scene: Whether the new lines are added to scene/plot and rendered</span>
<span class="sd">        :return: Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_origin</span><span class="p">:</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">mesh_name</span> <span class="k">if</span> <span class="n">mesh_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">utils</span><span class="o">.</span><span class="n">split_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># This method renames the object with a suffix if a conflicting name is found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_object</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># There is a bug in VTK 9 that prevents clicking on transparent objects</span>
        <span class="c1"># as reported on vedo&#39;s tracker https://github.com/marcomusy/vedo/issues/291</span>
        <span class="c1"># The &quot;Force opaque fix&quot; below should be gone with the next VTK update hopefully.</span>
        <span class="c1"># In the meantime, we use this.</span>
        <span class="c1"># TODO: remove this when this bug is fixed in VTK</span>
        <span class="c1">#mesh.ForceOpaqueOn()</span>
        <span class="k">if</span> <span class="n">add_to_scene</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mesh</span></div>

<div class="viewcode-block" id="Viewer.add_volume"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_volume">[docs]</a>    <span class="k">def</span> <span class="nf">add_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> 
                    <span class="n">alpha_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a volume to the viewer with box clipping and slicing enabled by default</span>
<span class="sd">        :param data: Volume image data or a file_path</span>
<span class="sd">        :param resolution: Resoluton of the volume</span>
<span class="sd">        :param file_path: File path of the volume. If you don&#39;t provide an image volume data,</span>
<span class="sd">            then the file_path will be used to load the volume data</span>
<span class="sd">        :param color_map: Color map for the volume</span>
<span class="sd">        :param alpha_map: Alpha map for the volume. If None, it will assume that 0 values</span>
<span class="sd">            are transparent and maximum values are opaque</span>
<span class="sd">        :param select: Whether the volume is selected</span>
<span class="sd">        :param add_to_scene: Whether the volume is added to scene</span>
<span class="sd">        :param transpose: Transposition parameter. If None. nothing happens. If True, </span>
<span class="sd">            then the default IBL transposition is applied. You can provide your own, that is,</span>
<span class="sd">            a list of 3 elements to reorder the volume as desired.</span>
<span class="sd">        :return: VolumeController</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">VolumeModel</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">load_volume</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transpose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">transpose</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">compute_size</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">alpha_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alpha_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="c1">#alpha_map = np.flip(alpha_map)</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="n">VolumeController</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">add_to_scene</span><span class="o">=</span><span class="n">add_to_scene</span><span class="p">)</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">set_color_map</span><span class="p">(</span><span class="n">color_map</span><span class="p">,</span> <span class="n">alpha_map</span><span class="p">)</span>
        <span class="c1"># register_object is automatically called on view.actor within register_controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_controller</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">get_related_actors</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">select</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">actor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_selected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">controller</span></div>

<div class="viewcode-block" id="Viewer.remove_object"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.remove_object">[docs]</a>    <span class="k">def</span> <span class="nf">remove_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unregister</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove an object from the plot</span>
<span class="sd">        :param target: Target object</span>
<span class="sd">        :param unregister: Whether the object is also unregistered, which</span>
<span class="sd">            means that it&#39;s not in the list of objects anymore and cannot</span>
<span class="sd">            be recovered using select(object_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deselect</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
            <span class="n">deselect</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">deselect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_void_click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unregister</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unregister_object</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.toggle_menu"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_menu">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle menu and activate only one button in the set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_elements</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el_name</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">el_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">el_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_button_state</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_button_state</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_menu_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_menu_context">[docs]</a>    <span class="k">def</span> <span class="nf">set_menu_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button_name</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the context from the main menu buttons</span>
<span class="sd">        :param button_name: Which button is clicked</span>
<span class="sd">        :param context: What context to activate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">context</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">DEFAULT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_menu</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_menu</span><span class="p">(</span><span class="n">button_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.camera_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.camera_context">[docs]</a>    <span class="k">def</span> <span class="nf">camera_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set camera context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_context</span><span class="p">(</span><span class="s1">&#39;camera&#39;</span><span class="p">,</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">CAMERA</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.scene_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.scene_context">[docs]</a>    <span class="k">def</span> <span class="nf">scene_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set scene context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_context</span><span class="p">(</span><span class="s1">&#39;scene&#39;</span><span class="p">,</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">SCENE</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.data_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.data_context">[docs]</a>    <span class="k">def</span> <span class="nf">data_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set data context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_context</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">DATA</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.object_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.object_context">[docs]</a>    <span class="k">def</span> <span class="nf">object_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set object context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_context</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.time_series_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.time_series_context">[docs]</a>    <span class="k">def</span> <span class="nf">time_series_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set time series context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_context</span><span class="p">(</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">TIME_SERIES</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.export_context"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.export_context">[docs]</a>    <span class="k">def</span> <span class="nf">export_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set export context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_context</span><span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="n">UIModel</span><span class="o">.</span><span class="n">EXPORT</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_marker_type"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_marker_type">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_marker_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle marker type (between cross and sphere)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Cross3D</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_selection_marker</span><span class="p">(</span><span class="s1">&#39;sphere&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_selection_marker</span><span class="p">(</span><span class="s1">&#39;cross&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_selection_marker"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_selection_marker">[docs]</a>    <span class="k">def</span> <span class="nf">set_selection_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker_type</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">cross_thickness</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the selection marker type. Accepted values currently are &#39;cross&#39; or &#39;sphere&#39;</span>
<span class="sd">        :param marker_type: Marker type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#position = self.selection_marker.pos()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="p">,</span> <span class="n">render</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">marker_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Cross3D</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="n">cross_thickness</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Sphere</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">pickable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="p">,</span> <span class="n">render</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">lighting</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span></div>
        <span class="c1">#self.selection_marker.GetProperty().SetOpacity(0.5)</span>

<div class="viewcode-block" id="Viewer.initialize_vtk_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.initialize_vtk_ui">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_vtk_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a per-context VTK UI.</span>
<span class="sd">        :param x: Base screen-space x coordinate</span>
<span class="sd">        :param y: Base screen-space y coordinate (starts from the bottom in VTK)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed_submenu_x</span>
        <span class="k">if</span> <span class="n">sy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed_submenu_y</span>
        <span class="k">if</span> <span class="n">sw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed_slider_width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;camera&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_context</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">200</span><span class="p">],</span> <span class="s1">&#39;Camera&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;scene&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene_context</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">150</span><span class="p">],</span> <span class="s1">&#39;Scene&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_context</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;Object&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_context</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_context</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="s1">&#39;Export&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_camera_embed_ui</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_scene_embed_ui</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_object_embed_ui</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_data_embed_ui</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_export_embed_ui</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_camera_embed_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_camera_embed_ui">[docs]</a>    <span class="k">def</span> <span class="nf">add_camera_embed_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add camera-context UI</span>
<span class="sd">        :param x: Base X position</span>
<span class="sd">        :param y: Base Y position (0 is at the bottom of the screen)</span>
<span class="sd">        :param sw: Slider width</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">CAMERA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;anterior&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_anterior_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">120</span><span class="p">],</span> <span class="s1">&#39;Anterior&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;posterior&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_posterior_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">nc</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">120</span><span class="p">],</span> <span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;dorsal&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_dorsal_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">],</span> <span class="s1">&#39;Dorsal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;ventral&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_ventral_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">nc</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">],</span> <span class="s1">&#39;Ventral&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_left_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> <span class="s1">&#39;Left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_right_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">nc</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">40</span><span class="p">],</span> <span class="s1">&#39;Right&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_orthographic_view</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="s1">&#39;Orthographic&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># or better yet, group these buttons into a labelled collection? If this is any useful later on?</span>
        <span class="c1">#self.model.ui.register([b1, b2, b3, b4, b5, b6, b7], UIModel.CAMERA)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">CAMERA</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_scene_embed_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_scene_embed_ui">[docs]</a>    <span class="k">def</span> <span class="nf">add_scene_embed_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>  <span class="n">sw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add scene-context UI</span>
<span class="sd">        :param x: Base X position</span>
<span class="sd">        :param y: Base Y position (0 is at the bottom of the screen)</span>
<span class="sd">        :param sw: Slider width</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">SCENE</span><span class="p">)</span>
        <span class="n">s_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">slider_config</span>
        <span class="c1">#self.add_button(&#39;move_pivot&#39;, self.move_camera_pivot, [x, y + 90], &#39;Move camera pivot&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;previous_selection&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_previous_object</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_object_by_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">55</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;next_selection&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_next_object</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">sw</span><span class="o">+</span><span class="mi">80</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;autofocus&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_autofocus</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Autofocus: Off&#39;</span><span class="p">,</span> <span class="s1">&#39;Autofocus: On&#39;</span><span class="p">],</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;view_selected&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_selected</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">],</span> <span class="s1">&#39;Focus on selection&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;dark_mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_dark_mode</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">400</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Dark UI&#39;</span><span class="p">,</span> <span class="s1">&#39;Light UI&#39;</span><span class="p">],</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">dark_mode</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_marker</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">400</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Marker: Off&#39;</span><span class="p">,</span> <span class="s1">&#39;Marker: On&#39;</span><span class="p">],</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#self.add_button(&#39;clickable&#39;, self.toggle_pickable, [x, y], [&#39;Clickable: On&#39;, &#39;Clickable: Off&#39;], toggle=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;toggle_info&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_info</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">200</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Info overlay: Off&#39;</span><span class="p">,</span> <span class="s1">&#39;Info overlay: On&#39;</span><span class="p">],</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;toggle_outline&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_outline</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">200</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Bounding box: Off&#39;</span><span class="p">,</span> <span class="s1">&#39;Bounding box: On&#39;</span><span class="p">],</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#self.add_button(&#39;view_slices&#39;, self.toggle_view_slices, [x, y], [&quot;Hide slices&quot;, &quot;Show slices&quot;], True)</span>
        <span class="c1">#self.axes_button = self.add_button(self.toggle_axes_visibility, pos=(50, 0.78), [&quot;Show axes&quot;, &quot;Hide axes&quot;], True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">SCENE</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_object_embed_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_object_embed_ui">[docs]</a>    <span class="k">def</span> <span class="nf">add_object_embed_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add object-context UI</span>
<span class="sd">        :param x: Base X position</span>
<span class="sd">        :param y: Base Y position (0 is at the bottom of the screen)</span>
<span class="sd">        :param sw: Slider width</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">slider_config</span>
        <span class="c1"># TODO: add option to use same slicer for all objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">)</span>
        
        <span class="c1">#self.add_button(&#39;global_slicer&#39;, self.toggle_global_slicer, [x, y+145], [&#39;Global slicer: OFF&#39;, &#39;Global slicer: ON&#39;], toggle=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;box_widget&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_box_widget</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> <span class="s1">&#39;Cutter/Slicer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;remove_object&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_object</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">130</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;isosurface&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isosurface</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">280</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">])</span>
        <span class="c1">#self.add_slider(&#39;isosurface&#39;, self.update_isosurface, 0, 1200, 200, [x+2*sw+80, y-5, sw], precision=2, **s_kw)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;hollow_volume&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_hollow_mode</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">380</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> <span class="s1">&#39;Hollow regions&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_opacity</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;slices_opacity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_slices_opacity</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">sw</span><span class="o">+</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="c1">#self.add_button(&#39;slices_visibility&#39;, self.toggle_slices_visibility, [x, yb + 130], [&quot;Hide slices&quot;, &quot;Show slices&quot;])</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # Code for adding six sliders for box slicing.</span>
<span class="sd">        self.add_slider(&#39;-x&#39;, self.update_nx_slicer, -1, 0, 0, [x+sw+40, y+70, sw], oid=0, **s_kw)</span>
<span class="sd">        self.add_slider(&#39;+x&#39;, self.update_px_slicer, 0, 1, 0, [x, y+70, sw], oid=1, **s_kw)</span>

<span class="sd">        self.add_slider(&#39;-y&#39;, self.update_ny_slicer, -1, 0, 0, [x+sw+40, y+35, sw], oid=2, **s_kw)</span>
<span class="sd">        self.add_slider(&#39;+y&#39;, self.update_py_slicer, 0, 1, 0, [x, y+35, sw], oid=3, **s_kw)</span>

<span class="sd">        self.add_slider(&#39;-z&#39;, self.update_nz_slicer, -1, 0, 0, [x+sw+40, y, sw], oid=4, **s_kw)</span>
<span class="sd">        self.add_slider(&#39;+z&#39;, self.update_pz_slicer, 0, 1, 0, [x, y, sw], oid=5, **s_kw)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.add_data_embed_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_data_embed_ui">[docs]</a>    <span class="k">def</span> <span class="nf">add_data_embed_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data-context UI</span>
<span class="sd">        :param x: Base X position</span>
<span class="sd">        :param y: Base Y position (0 is at the bottom of the screen)</span>
<span class="sd">        :param sw: Slider width</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">DATA</span><span class="p">)</span>
        <span class="n">s_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">slider_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;data_time_series&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_time_series</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;play_time_series&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_time_series</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Play time series&#39;</span><span class="p">,</span> <span class="s1">&#39;Pause time series&#39;</span><span class="p">],</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;new_probe&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_probe</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;move_probe&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_probe</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">DATA</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Viewer.add_export_embed_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_export_embed_ui">[docs]</a>    <span class="k">def</span> <span class="nf">add_export_embed_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add export-context UI</span>
<span class="sd">        :param x: Base X position</span>
<span class="sd">        :param y: Base Y position (0 is at the bottom of the screen)</span>
<span class="sd">        :param sw: Slider width</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">slider_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">EXPORT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;export_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_image</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="s1">&#39;Export image&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="s1">&#39;export_turntable_video&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_turntable_video</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">150</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="s1">&#39;Export 360 video&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;video_duration&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_video_duration</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">video_duration</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">150</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">120</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="s1">&#39;Video duration (s)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;start_angle&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_video_start_angle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">150</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_slider</span><span class="p">(</span><span class="s1">&#39;end_angle&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_video_end_angle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">150</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">40</span><span class="p">,</span> <span class="n">sw</span><span class="p">],</span> <span class="o">**</span><span class="n">s_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_context</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">EXPORT</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_scene_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_scene_ui">[docs]</a>    <span class="k">def</span> <span class="nf">update_scene_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the scene-related UI</span>
<span class="sd">        :param context_elements: Current UI context elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">is_scene_context</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">got_value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">:</span>
                <span class="n">got_value</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">got_value</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.is_volume"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.is_volume">[docs]</a>    <span class="k">def</span> <span class="nf">is_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get whether the target object is a volume</span>
<span class="sd">        :param target: vtkActor. If None, the current selected object is used.</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.get_selection_opacity"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_selection_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">get_selection_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the opacity of the current selected object</span>
<span class="sd">        :return: Float or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opacity_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">opacity_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">GetOpacity</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
                <span class="n">opacity_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">get_opacity</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">opacity_value</span></div>

<div class="viewcode-block" id="Viewer.get_selection_slices_opacity"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_selection_slices_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">get_selection_slices_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the opacity of the current volume slices</span>
<span class="sd">        :return: Float or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slices_opacity_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="n">slices_opacity_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">get_slices_opacity</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">slices_opacity_value</span></div>

<div class="viewcode-block" id="Viewer.update_object_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_object_ui">[docs]</a>    <span class="k">def</span> <span class="nf">update_object_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the object mode UI</span>
<span class="sd">        :param context_elements: Current UI context elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">is_object_context</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">volume_mode</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s1">&#39;hollow_volume&#39;</span><span class="p">),</span> <span class="n">volume_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s1">&#39;view_region&#39;</span><span class="p">),</span> <span class="n">volume_mode</span><span class="p">)</span>

        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">)</span><span class="c1">#self.model.ui.get_element(&#39;opacity&#39;)</span>
        <span class="n">opacity_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selection_opacity</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">opacity_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">opacity_value</span><span class="p">)</span>

        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;slices_opacity&#39;</span><span class="p">)</span><span class="c1">#model.ui.get_element(&#39;slices_opacity&#39;)</span>
        <span class="n">slices_opacity_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selection_slices_opacity</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">slices_opacity_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">slices_opacity_value</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # Below code not necessary anymore, we keep it here as a reference</span>
<span class="sd">        # if you want to update sliders for slicing instead of using vtk widgets</span>
<span class="sd">        dimensions = utils.get_actor_dimensions(self.model.selection)</span>
<span class="sd">        for element_name in context_elements:</span>
<span class="sd">            element = context_elements[element_name]</span>
<span class="sd">            axis = None</span>
<span class="sd">            slicers = None</span>
<span class="sd">            try:</span>
<span class="sd">                axis = element.oid</span>
<span class="sd">                slicers = self.model.selection_controller.slicers</span>
<span class="sd">            except Exception:</span>
<span class="sd">                continue</span>
<span class="sd">            model = slicers.get(axis).model</span>
<span class="sd">            mod = axis % 2</span>
<span class="sd">            orientation = -1 if mod == 0 else 1</span>
<span class="sd">            if orientation == 1:</span>
<span class="sd">                min_v = 0</span>
<span class="sd">                max_v = dimensions[model.axis] * orientation</span>
<span class="sd">            else:</span>
<span class="sd">                min_v = dimensions[model.axis] * orientation</span>
<span class="sd">                max_v = 0</span>
<span class="sd">            rep = element.GetRepresentation()</span>
<span class="sd">            rep.SetMinimumValue(min_v)</span>
<span class="sd">            rep.SetMaximumValue(max_v)</span>
<span class="sd">            if model.value is not None:</span>
<span class="sd">                element.update(widget=element, value=model.value)</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Viewer.update_data_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_data_ui">[docs]</a>    <span class="k">def</span> <span class="nf">update_data_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update data UI</span>
<span class="sd">        :param context_elements: Current UI context elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">is_data_context</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">volume_mode</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s1">&#39;new_probe&#39;</span><span class="p">),</span> <span class="n">volume_mode</span><span class="p">)</span>

        <span class="n">probe_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_probe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="s1">&#39;move_probe&#39;</span><span class="p">),</span> <span class="n">probe_mode</span><span class="p">)</span>

        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_time_series&#39;</span><span class="p">)</span>
        <span class="n">current_value</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_series_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">slider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">slider</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">current_value</span><span class="p">)</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetMinimumValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetMaximumValue</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_color_bar</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.get_time_series_info"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_time_series_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_series_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of time series and id of the current one for a target.</span>
<span class="sd">        If None, then the current selection is used</span>
<span class="sd">        :param target: a vtk object</span>
<span class="sd">        :return: Int, Int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="c1"># Only volume object has a controller in iblviewer</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="c1">#self.model.selection_controller</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">luts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">current_value</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">luts</span><span class="o">.</span><span class="n">current_key_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">point_data</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span>
                <span class="c1">#name = target.polydata().GetPointData().GetArrayName()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Points</span><span class="p">):</span>
                    <span class="c1"># We use this method to ignore unwanted arrays that are automatically</span>
                    <span class="c1"># created by VTK</span>
                    <span class="n">max_value</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_number_of_arrays</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_value</span> <span class="o">=</span> <span class="n">point_data</span><span class="o">.</span><span class="n">GetNumberOfArrays</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">polydata</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span>
                <span class="n">current_name</span> <span class="o">=</span> <span class="n">polydata</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
                <span class="c1"># Forced to make a loop here in order to get the current id...</span>
                <span class="k">for</span> <span class="n">array_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_value</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">point_data</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">array_id</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="n">current_name</span><span class="p">:</span>
                        <span class="n">current_value</span> <span class="o">=</span> <span class="n">array_id</span>
                        <span class="k">break</span>
                <span class="c1">#current_value = point_data.GetAbstractArray(current_name)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">current_value</span><span class="p">,</span> <span class="n">max_value</span></div>

<div class="viewcode-block" id="Viewer.update_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_ui">[docs]</a>    <span class="k">def</span> <span class="nf">update_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the UI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_selection_info</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">got_selection</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_outline</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_changed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_point_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_color_bar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_color_bar_visibility</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">context_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_elements</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">context_changed</span><span class="p">:</span>
                <span class="n">default_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">get_elements</span><span class="p">(</span><span class="n">UIModel</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span>
                <span class="n">context_elements</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">default_elements</span><span class="p">)</span> <span class="c1"># concatenates dictionaries</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_ui_visibility</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">context_elements</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_scene_ui</span><span class="p">(</span><span class="n">context_elements</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_object_ui</span><span class="p">(</span><span class="n">context_elements</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_data_ui</span><span class="p">(</span><span class="n">context_elements</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_color_bar_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_color_bar_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_color_bar_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show or hide the color bar</span>
<span class="sd">        :param on: Visibility boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">on</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.draw_color_bar"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.draw_color_bar">[docs]</a>    <span class="k">def</span> <span class="nf">draw_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a color bar for the current selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_probe</span><span class="p">(</span><span class="n">selection</span><span class="p">):</span>
            <span class="n">controller</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">target_controller</span>
        <span class="k">if</span> <span class="n">controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;luts&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">luts</span><span class="o">.</span><span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lut</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">luts</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">scalar_lut</span>
        <span class="k">if</span> <span class="n">lut</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="n">lut</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ctf2lut</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default way to get a LUT for the scalar/color bar</span>
            <span class="n">lut</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">mapper</span><span class="p">()</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1">#if self.color_bar is not None:</span>
            <span class="c1">#self.set_color_bar_visibility(True)</span>
            <span class="c1">#self.plot.remove(self.color_bar, render=False)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">update_scalar_bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span><span class="p">,</span> <span class="n">lut</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_scalar_bar</span><span class="p">(</span><span class="n">lut</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span><span class="mf">0.04</span><span class="p">),</span> 
                                    <span class="n">font_color</span><span class="o">=</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">titleFontSize</span><span class="o">=</span><span class="n">ui</span><span class="o">.</span><span class="n">font_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span><span class="p">])</span></div>

<div class="viewcode-block" id="Viewer.clear_color_bar"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.clear_color_bar">[docs]</a>    <span class="k">def</span> <span class="nf">clear_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the color bar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_button_state"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_button_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_button_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the state of a button. For a toggle, True or False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;button&#39;</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.get_button_state"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_button_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_button_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the state of a button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;button&#39;</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">element</span><span class="o">.</span><span class="n">status</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.set_element_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_element_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_element_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a UI element&#39;s visibility</span>
<span class="sd">        :param element: a vtk2DActor or something like that (changes for sliders, texts, etc.)</span>
<span class="sd">        :param visible: Visible or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;slider&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">visible</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">EnabledOn</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">EnabledOff</span><span class="p">()</span>
            <span class="c1">#element.GetRepresentation().PickingManagedOn()</span>
        <span class="k">if</span> <span class="s1">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;button&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetPickable</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_element_color"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_element_color">[docs]</a>    <span class="k">def</span> <span class="nf">update_element_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a UI element&#39;s color</span>
<span class="sd">        :param element: a vtk2DActor or something like that (changes for sliders, texts, etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;slider&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">slider_config</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetLabelProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetTubeProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="c1">#rep.GetTubeProperty().SetOpacity(0.6)</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetSliderProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetSelectedProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)))</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetCapProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetTitleProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">slider_config</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span>
            <span class="n">element</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;button&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">toggle</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_config</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_config</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
            <span class="n">background_colors</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">statusIdx</span>
            <span class="n">element</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="n">element</span><span class="o">.</span><span class="n">bcolors</span> <span class="o">=</span> <span class="n">background_colors</span>
            <span class="n">element</span><span class="o">.</span><span class="n">textproperty</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">vedo</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">status</span><span class="p">]))</span>
            <span class="n">bcc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vedo</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">bcolors</span><span class="p">[</span><span class="n">status</span><span class="p">]))</span>
            <span class="n">element</span><span class="o">.</span><span class="n">textproperty</span><span class="o">.</span><span class="n">SetBackgroundColor</span><span class="p">(</span><span class="n">bcc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">showframe</span><span class="p">:</span>
                <span class="c1">#element.textproperty.FrameOn()</span>
                <span class="n">element</span><span class="o">.</span><span class="n">textproperty</span><span class="o">.</span><span class="n">SetFrameColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bcc</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s1">&#39;scalarbar&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">GetTitleTextProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">GetLabelTextProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_ui_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_ui_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_ui_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ui_button_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the UI visibility</span>
<span class="sd">        :param visible: Whether the UI is visible or not</span>
<span class="sd">        :param exceptions: Dictionary of objects that have to be the inverse of</span>
<span class="sd">            the given state</span>
<span class="sd">        :param ui_button_visible: Whether the UI button is still visible or not,</span>
<span class="sd">            so that the user can restore the UI by clicking on it.</span>
<span class="sd">            This is not necessary in case of Jupyter NB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="n">visible</span>

        <span class="n">all_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">all_elements</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_elements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="n">all_elements</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">visible</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">exceptions</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="ow">not</span> <span class="n">visible</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Viewer.add_text"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_text">[docs]</a>    <span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a 2D text on scene</span>
<span class="sd">        :param name: Name of the object</span>
<span class="sd">        :param text: Text string</span>
<span class="sd">        :param pos: Position on screen</span>
<span class="sd">        :param color: Color of the font</span>
<span class="sd">        :param justify: Type of justification</span>
<span class="sd">        :param context: Context to register this object to</span>
<span class="sd">        :return: Text2D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Text2D</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="n">justify</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">SetFontSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">font_size</span><span class="p">)</span>
        <span class="c1"># Assume absolute coordinates in pixels</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">GetPositionCoordinate</span><span class="p">()</span><span class="o">.</span><span class="n">SetCoordinateSystemToDisplay</span><span class="p">()</span>
            <span class="n">text</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="Viewer.add_button"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_button">[docs]</a>    <span class="k">def</span> <span class="nf">add_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a left-aligned button</span>
<span class="sd">        :param name: Button name</span>
<span class="sd">        :param event_handler: Event handler function</span>
<span class="sd">        :param pos: Screen-space position</span>
<span class="sd">        :param label: Button text label</span>
<span class="sd">        :param toggle: Whether it&#39;s a toggle button or not</span>
<span class="sd">        :return: Button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_config</span>
        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toggle_config</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">]</span> <span class="k">if</span> <span class="n">toggle</span> <span class="k">else</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">event_handler</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="c1"># Decorator that automatically changes the button state on click</span>
            <span class="k">def</span> <span class="nf">wrapped_event_handler</span><span class="p">():</span>
                <span class="n">button</span><span class="o">.</span><span class="n">switch</span><span class="p">()</span>
                <span class="n">event_handler</span><span class="p">()</span>
            <span class="n">button</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">wrapped_event_handler</span>
        <span class="c1">#button.actor.SetTextScaleModeToViewport()</span>
        <span class="n">button</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">GetTextProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetJustificationToLeft</span><span class="p">()</span>
        <span class="c1"># Assume absolute coordinates in pixels</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">button</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">GetActualPositionCoordinate</span><span class="p">()</span><span class="o">.</span><span class="n">SetCoordinateSystemToDisplay</span><span class="p">()</span>
            <span class="n">button</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">toggle</span> <span class="o">=</span> <span class="n">toggle</span>
        <span class="n">button</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">button</span></div>

<div class="viewcode-block" id="Viewer.get_slider_bounds"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.get_slider_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">get_slider_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get slider coordinates, releative to lower left corner of the window</span>
<span class="sd">        :param x: X position</span>
<span class="sd">        :param y: Y position</span>
<span class="sd">        :param length: Length of the slider</span>
<span class="sd">        :param horizontal: Whether the length is horizontal or vertical</span>
<span class="sd">        :return: np 2d array with min and max coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">length</span><span class="p">,</span> <span class="n">y</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">length</span><span class="p">]])</span></div>

<div class="viewcode-block" id="Viewer.add_slider"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_slider">[docs]</a>    <span class="k">def</span> <span class="nf">add_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> 
                    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">oid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a slider to the UI</span>
<span class="sd">        :param event_handler: Event handler function called when the slider is updated</span>
<span class="sd">        :param min_value: Min slider value</span>
<span class="sd">        :param max_value: Max slider value</span>
<span class="sd">        :param value: Default value</span>
<span class="sd">        :param size: Font size</span>
<span class="sd">        :param pos: Position in the UI as a tuple or list, see get_slider_bounds for details</span>
<span class="sd">        :param kwargs: Dictionary of kwargs, see vedo.addons.addSlider2D() for details</span>
<span class="sd">        :return: 2D Slider</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slider_bounds</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;showValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># Decorator for the event handler</span>
        <span class="k">def</span> <span class="nf">update_slider</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">slider</span><span class="o">.</span><span class="n">label_prefix</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span><span class="o">.</span><span class="n">SetInput</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">widget</span><span class="o">.</span><span class="n">last_value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event_handler</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">addSlider2D</span><span class="p">(</span><span class="n">update_slider</span><span class="p">,</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">SetAnimationModeToJump</span><span class="p">()</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        rep.SetLabelHeight(0.003 * size)</span>
<span class="sd">        rep.GetLabelProperty().SetFontSize(size)</span>
<span class="sd">        rep.SetTitleHeight(0.003 * size)</span>
<span class="sd">        rep.GetTitleProperty().SetFontSize(size)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">label_position</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.11</span><span class="p">]</span>
        <span class="c1"># Assume absolute coordinates in pixels</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetPoint1Coordinate</span><span class="p">()</span><span class="o">.</span><span class="n">SetCoordinateSystemToDisplay</span><span class="p">()</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetPoint2Coordinate</span><span class="p">()</span><span class="o">.</span><span class="n">SetCoordinateSystemToDisplay</span><span class="p">()</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetPoint1Coordinate</span><span class="p">()</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">rep</span><span class="o">.</span><span class="n">GetPoint2Coordinate</span><span class="p">()</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">label_position</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">27</span><span class="p">]</span>
            
        <span class="n">rep</span><span class="o">.</span><span class="n">SetSliderLength</span><span class="p">(</span><span class="mf">0.012</span><span class="p">)</span>
        <span class="n">rep</span><span class="o">.</span><span class="n">SetSliderWidth</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">rep</span><span class="o">.</span><span class="n">SetTubeWidth</span><span class="p">(</span><span class="mf">0.0025</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">oid</span>

        <span class="n">slider</span><span class="o">.</span><span class="n">update</span> <span class="o">=</span> <span class="n">update_slider</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">label_prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">slider</span><span class="o">.</span><span class="n">label_prefix</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">rep</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s1">&#39;selection_name&#39;</span><span class="p">,</span> <span class="n">slider</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">label_position</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_label&#39;</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_visibility</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets_reflection</span><span class="p">[</span><span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()]</span> <span class="o">=</span> <span class="n">slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">slider</span><span class="p">,</span> <span class="n">slider</span><span class="o">.</span><span class="n">label</span><span class="p">],</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slider</span></div>

<div class="viewcode-block" id="Viewer.slider_value"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.slider_value">[docs]</a>    <span class="k">def</span> <span class="nf">slider_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract method to get or set a value on a VTK slider element</span>
<span class="sd">        :param element_id: Element id (found in self.model.ui.get_elements().keys())</span>
<span class="sd">        :param value: Value of Z slice, defaults to 0.0</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :return: Float value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">context_element</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Viewer.clip_to_bounds"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.clip_to_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">clip_to_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds_obj</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clip a target object with the bounding box of another object</span>
<span class="sd">        :param bounds_obj: a vtkActor</span>
<span class="sd">        :param target: Target object. If None, the current selection is used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_actor_bounds</span><span class="p">(</span><span class="n">bounds_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Volume</span><span class="p">):</span>
            <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">controller</span><span class="o">.</span><span class="n">clip_to_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">set_clipping_planes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.isosurface"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.isosurface">[docs]</a>    <span class="k">def</span> <span class="nf">isosurface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volume_controller</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">split_meshes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remove_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate mesh(es) for a given value in a volume</span>
<span class="sd">        :param value: Value/label for which we want to generate an isosurface mesh</span>
<span class="sd">        :param volume_controller: Volume controller. If None, the current one is used.</span>
<span class="sd">        If the current one is None, then nothing happens.</span>
<span class="sd">        :param split_meshes: Whether manifold meshes are split if there are multiple ones</span>
<span class="sd">        :param remove_existing: Whether existing meshes are removed from the plot</span>
<span class="sd">        :return: List of meshes computed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">volume_controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volume_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span>
        <span class="k">if</span> <span class="n">volume_controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">remove_existing</span><span class="p">:</span>
            <span class="n">current_meshes</span> <span class="o">=</span> <span class="n">volume_controller</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">isosurfaces</span><span class="o">.</span><span class="n">current</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">current_meshes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">meshes</span> <span class="o">=</span> <span class="n">volume_controller</span><span class="o">.</span><span class="n">isosurface</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">split_meshes</span><span class="o">=</span><span class="n">split_meshes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">meshes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_object</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">meshes</span></div>

<div class="viewcode-block" id="Viewer.set_probe_position"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_probe_position">[docs]</a>    <span class="k">def</span> <span class="nf">set_probe_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pt2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the position of the current probe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pt1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="o">.</span><span class="n">SetPoint1</span><span class="p">(</span><span class="n">pt1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pt2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="o">.</span><span class="n">SetPoint2</span><span class="p">(</span><span class="n">pt2</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Viewer.add_probe"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_probe">[docs]</a>    <span class="k">def</span> <span class="nf">add_probe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new probe widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_line_widget</span><span class="p">()</span>
        <span class="n">event_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="n">event_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_current_probe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">probe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">probe_initial_point1</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">probe_initial_point2</span><span class="p">)</span>
            <span class="n">pt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="o">.</span><span class="n">GetPoint1</span><span class="p">()</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="o">.</span><span class="n">GetPoint2</span><span class="p">()</span>
            <span class="n">probe</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">add_probe</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_object</span><span class="p">(</span><span class="n">probe</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">probe</span><span class="p">,</span> <span class="n">probe</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">replace_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">set_current</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # If later interested in this, a generic approach to surface mesh data probing</span>
<span class="sd">        // Get the ID of the point that is closest to the query position</span>
<span class="sd">        vtkIdType id = locator-&gt;FindClosestPoint(pt);</span>
<span class="sd">        // Retrieve the first attribute value from this point</span>
<span class="sd">        double value = polyData-&gt;GetPointData()-&gt;GetScalars()-&gt;GetTuple(id, 0);</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Viewer.is_probe"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.is_probe">[docs]</a>    <span class="k">def</span> <span class="nf">is_probe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if an object is (the result of) a probe</span>
<span class="sd">        :param probe: Probe object</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">probe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">probe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">if</span> <span class="n">probe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">target</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">probe</span><span class="p">,</span> <span class="s1">&#39;target_controller&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">probe</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">probe</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">probe</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">target</span> <span class="ow">and</span> <span class="n">points</span></div>

<div class="viewcode-block" id="Viewer.update_current_probe"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_current_probe">[docs]</a>    <span class="k">def</span> <span class="nf">update_current_probe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the current probe</span>
<span class="sd">        :param widget: vtkLineWidget</span>
<span class="sd">        :param event: vtkEvent</span>
<span class="sd">        :param point1: Point 1, this will override the widget&#39;s point 1</span>
<span class="sd">        :param point2: Point 2, this will override the widget&#39;s point 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">point1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">point2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point1</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetPoint1</span><span class="p">()</span>
            <span class="n">point2</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetPoint2</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">current</span>
        <span class="n">volume_controller</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">target_controller</span>
        <span class="c1"># Probe method is within VolumeController</span>
        <span class="n">volume_controller</span><span class="o">.</span><span class="n">update_probe</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.edit_probe"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.edit_probe">[docs]</a>    <span class="k">def</span> <span class="nf">edit_probe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Edit/move an existing probe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">probe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">probe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="k">if</span> <span class="n">probe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_probe</span><span class="p">(</span><span class="n">probe</span><span class="p">):</span>
            <span class="c1"># The event handler in this case will refer to the active probe in</span>
            <span class="c1"># self.model.probes.current so we have to set it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">set_current</span><span class="p">(</span><span class="n">probe</span><span class="p">)</span> <span class="c1"># or probe.name works too</span>
            <span class="n">event_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_current_probe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">probe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="n">probe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span> 
                                            <span class="n">probe</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">probe</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.clear_line_widget"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.clear_line_widget">[docs]</a>    <span class="k">def</span> <span class="nf">clear_line_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the active line widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span></div>
            <span class="c1">#self.line_widget.RemoveObservers(&#39;InteractionEvent&#39;)</span>
            <span class="c1">#self.plot.widgets.remove(self.line_widget)</span>

<div class="viewcode-block" id="Viewer.toggle_box_widget"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_box_widget">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_box_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle box widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_box_widget</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_box_widget</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="Viewer.add_box_widget"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.add_box_widget">[docs]</a>    <span class="k">def</span> <span class="nf">add_box_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a box widget for clipping the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_box_widget</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event_handler</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
                <span class="n">event_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">box_widget_update</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">box_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.clear_box_widget"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.clear_box_widget">[docs]</a>    <span class="k">def</span> <span class="nf">clear_box_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the active box widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span><span class="o">.</span><span class="n">RemoveObservers</span><span class="p">(</span><span class="s1">&#39;InteractionEvent&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box_widget</span> <span class="o">=</span> <span class="kc">None</span></div>
        
<div class="viewcode-block" id="Viewer.update_px_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_px_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">update_px_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for Slicer on +X axis</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Value of X slice, defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_value</span><span class="p">(</span><span class="s1">&#39;+x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">update_slicer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span></div>
    
<div class="viewcode-block" id="Viewer.update_nx_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_nx_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">update_nx_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for Slicer on -X axis</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Value of X slice, defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_value</span><span class="p">(</span><span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">update_slicer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.update_py_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_py_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">update_py_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for Slicer on +Y axis</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Value of Y slice, defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_value</span><span class="p">(</span><span class="s1">&#39;+y&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">update_slicer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.update_ny_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_ny_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">update_ny_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for Slicer on -Y axis</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Value of Y slice, defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_value</span><span class="p">(</span><span class="s1">&#39;-y&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">update_slicer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.update_pz_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_pz_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">update_pz_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for Slicer on +Z axis</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Value of Z slice, defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_value</span><span class="p">(</span><span class="s1">&#39;+z&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">update_slicer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.update_nz_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_nz_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">update_nz_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for Slicer on -Z axis</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Value of Z slice, defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_value</span><span class="p">(</span><span class="s1">&#39;-z&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">update_slicer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.toggle_slices"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_slices">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle slicers visibility</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">slices_visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">slices_visible</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">toggle_slices_visibility</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>
    
<div class="viewcode-block" id="Viewer.toggle_global_slicer"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_global_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_global_slicer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle global slicer mode</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.model.global_slicer = current_slicer</span>
<span class="sd">        try:</span>
<span class="sd">            for key in self.objects:</span>
<span class="sd">                obj = self.objects[key]</span>
<span class="sd">                obj.mapper().SetClippingPlanes(self.model.global_slicer)</span>
<span class="sd">        except Exception:</span>
<span class="sd">            pass</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="Viewer.set_camera"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_camera">[docs]</a>    <span class="k">def</span> <span class="nf">set_camera</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">camera_distance</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: make it possible to store and assign a camera transformation matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCamera</span><span class="p">()</span>
        <span class="c1"># Define the quaternion in vtk, note the swapped order</span>
        <span class="c1"># w,x,y,z instead of x,y,z,w</span>
        <span class="n">quat_vtk</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkQuaterniond</span><span class="p">(</span><span class="n">quat</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">quat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">quat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">quat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">quat_vtk</span><span class="o">.</span><span class="n">ToMatrix3x3</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
        <span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">camera_distance</span><span class="p">]</span>

        <span class="n">camera</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">up</span><span class="p">))</span>
        <span class="n">camera</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">p_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">position</span>
        <span class="n">camera</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="o">*</span><span class="n">p_new</span><span class="p">)</span>
        <span class="n">camera</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="o">*</span><span class="n">position</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">camera</span></div>

<div class="viewcode-block" id="Viewer.update_camera"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_camera">[docs]</a>    <span class="k">def</span> <span class="nf">update_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_up</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the camera frustrum</span>
<span class="sd">        :param normal: View normal</span>
<span class="sd">        :param view_up: Up axis normal</span>
<span class="sd">        :param scale_factor: Scale factor to make the camera closer to the target</span>
<span class="sd">        Smaller values than 1 make the target closer to the camera.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">camera_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span>
        <span class="k">if</span> <span class="n">camera_model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">camera_model</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">view_up</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">camera_model</span><span class="o">.</span><span class="n">view_up</span> <span class="o">=</span> <span class="n">view_up</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="o">*</span><span class="n">camera_model</span><span class="o">.</span><span class="n">view_up</span><span class="p">)</span>

        <span class="n">focal_point</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">focal_point</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_actor_center</span><span class="p">(</span><span class="n">camera_model</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">camera_model</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>   
                    <span class="n">focal_point</span> <span class="o">=</span> <span class="n">camera_model</span><span class="o">.</span><span class="n">target</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">focal_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">focal_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">target_dimensions</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_actor_dimensions</span><span class="p">(</span><span class="n">camera_model</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">target_dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_distance</span>
        <span class="n">max_dim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target_dimensions</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">GetViewPlaneNormal</span><span class="p">()</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">GetParallelProjection</span><span class="p">():</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">max_dim</span> <span class="o">*</span> <span class="n">camera_model</span><span class="o">.</span><span class="n">distance_factor</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">scale_factor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">max_dim</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">scale_factor</span>

        <span class="c1"># Update orthographic scale too so that it&#39;s synced with perspective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">SetParallelScale</span><span class="p">(</span><span class="n">distance</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">)</span>
        
        <span class="c1">#self.plot.camera.SetDistance(0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal_point</span><span class="p">)</span>
        <span class="n">camera_position</span> <span class="o">=</span> <span class="n">focal_point</span> <span class="o">-</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">camera_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">SetClippingRange</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span></div>

<div class="viewcode-block" id="Viewer.toggle_orthographic_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_orthographic_view">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_orthographic_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle orthographic/perspective views</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_ortho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">GetParallelProjection</span><span class="p">()</span>
        <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">useParallelProjection</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">is_ortho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">SetParallelProjection</span><span class="p">(</span><span class="ow">not</span> <span class="n">is_ortho</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.set_left_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_left_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_left_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set left sagittal view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Z_UP</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_right_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_right_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_right_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set right sagittal view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Z_UP</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_anterior_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_anterior_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_anterior_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set anterior coronal view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Z_UP</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_posterior_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_posterior_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_posterior_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set posterior coronal view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Z_UP</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_dorsal_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_dorsal_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_dorsal_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set dorsal axial view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Y_UP</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_ventral_view"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_ventral_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_ventral_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set ventral axial view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Y_UP</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_autofocus"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_autofocus">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the camera target to the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">autofocus</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">autofocus</span></div>

<div class="viewcode-block" id="Viewer.view_selected"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.view_selected">[docs]</a>    <span class="k">def</span> <span class="nf">view_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the camera target to the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">camera_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span>
        <span class="k">if</span> <span class="n">camera_model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">camera_model</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.move_camera_pivot"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.move_camera_pivot">[docs]</a>    <span class="k">def</span> <span class="nf">move_camera_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Focus the camera on the current selection point</span>
<span class="sd">        :param point: Point to focus on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">camera_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">current</span>
        <span class="k">if</span> <span class="n">camera_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">camera_model</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Viewer.toggle_ui"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_ui">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle user interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ui_visibility</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_hollow_mode"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_hollow_mode">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_hollow_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle hollow volume visualization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">toggle_hollow</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.toggle_info"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_info">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle visibility of information about current selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">common_value</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span> <span class="o">=</span> <span class="n">common_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_marker_visible</span> <span class="o">=</span> <span class="n">common_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span> <span class="o">=</span> <span class="n">common_value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_marker_visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_bar</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_outline"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_outline">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_outline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle outline visibility</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_outline_visibility</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_outline_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_outline_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_outline_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set outline visibility</span>
<span class="sd">        :param on: Visibility boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_outline_visible</span> <span class="o">=</span> <span class="n">on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">on</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_marker"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_marker">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle visibility of the marker</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_marker_visibility</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_marker_visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_marker_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_marker_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_marker_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set marker visibility</span>
<span class="sd">        :param on: Visibility boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_marker_visible</span> <span class="o">=</span> <span class="n">on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">on</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_info_text"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_info_text">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_info_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle visibility of the marker</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_info_text_visibility</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_text_visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.set_info_text_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_info_text_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_info_text_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set info text visibility</span>
<span class="sd">        :param on: Visibility boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_text_visible</span> <span class="o">=</span> <span class="n">on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">on</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_color_bar"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_color_bar">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Togggle the color bar visibility</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_color_bar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color_bar_visibility</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.set_info_visibility"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_info_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_info_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">actors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_color_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the visibility of info data</span>
<span class="sd">        :param visible: Whether info data is visible or not</span>
<span class="sd">        :param actors: Any desired actors to be made visible/invisible</span>
<span class="sd">        :param update_color_bar: Whether this method also affects the color bar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_info_visible</span> <span class="o">=</span> <span class="n">visible</span>
        <span class="k">if</span> <span class="n">update_color_bar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span> <span class="o">=</span> <span class="n">visible</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_color_bar_visible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_color_bar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_color_bar_visibility</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">actors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actors</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_info</span><span class="p">]</span>
        <span class="n">actors</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_marker</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">actor</span> <span class="ow">in</span> <span class="n">actors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.select_object_by_name"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.select_object_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">select_object_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Viewer.select_previous_object"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.select_previous_object">[docs]</a>    <span class="k">def</span> <span class="nf">select_previous_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select the next object in the list of selectable objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">)</span>
        <span class="nb">repr</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">repr</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="nb">repr</span><span class="o">.</span><span class="n">GetMinimumValue</span><span class="p">()</span>
        <span class="n">previous_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">previous_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.select_object_by_id"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.select_object_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">select_object_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select object by id (order in which objects were registered in this app)</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: Object id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.select_next_object"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.select_next_object">[docs]</a>    <span class="k">def</span> <span class="nf">select_next_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select the next object in the list of selectable objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">)</span>
        <span class="nb">repr</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">repr</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="nb">repr</span><span class="o">.</span><span class="n">GetMaximumValue</span><span class="p">()</span>
        <span class="n">next_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">next_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_pickable"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_pickable">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_pickable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle the clickable state of an object</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: 0 for disabled, 1 for enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>       
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pickable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">pickable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">pickable</span><span class="p">(</span><span class="ow">not</span> <span class="n">pickable</span><span class="p">)</span>
            <span class="n">actors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">get_related_actors</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">actor</span> <span class="ow">in</span> <span class="n">actors</span><span class="p">:</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">pickable</span><span class="p">(</span><span class="ow">not</span> <span class="n">pickable</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_opacity"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">update_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the alpha unit of the current volume, making it more or less transparent</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: alpha unit value. If none given by the event, the value defaults to 1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">set_opacity</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">alpha</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_slices_opacity"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_slices_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">update_slices_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the opacity of the current volume slices</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        :param value: alpha unit value. If none given by the event, the value defaults to 1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span><span class="o">.</span><span class="n">set_slices_opacity</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.play_time_series"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.play_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">play_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Play/pause time series</span>
<span class="sd">        :param widget: Widget instance (given by the event caller)</span>
<span class="sd">        :param event: Event (given by the event caller)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">animation_playing</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">animation_playing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">timer_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">DestroyTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">timer_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">animation_playing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">timer_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">CreateRepeatingTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">playback_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.previous_time_series"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.previous_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">previous_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Previous time series</span>
<span class="sd">        :param offset: Offset integer. If negative, then it&#39;s like using next_time_series()</span>
<span class="sd">        :param loop: Whether next() goes to 0 when it reached the end of the time series or not</span>
<span class="sd">        :return: Returns whether the next time series is valid (within range of the time series)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># TODO: handle the case where the last value could be invalid if selection changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_time_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_time_series_value</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.next_time_series"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.next_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">next_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Next time series</span>
<span class="sd">        :param offset: Offset integer, can be negative to go backwards</span>
<span class="sd">        :param loop: Whether next() goes to 0 when it reached the end of the time series or not</span>
<span class="sd">        :return: Returns whether the next time series is valid (within range of the time series)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_time_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_time_series_value</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>

        <span class="c1"># TODO: below code would require that the slider min-max is set on object selection</span>
        <span class="k">return</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time_series&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetMinimumValue</span><span class="p">())</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetMaximumValue</span><span class="p">())</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">new_value</span> <span class="o">&gt;</span> <span class="n">max_value</span> <span class="ow">and</span> <span class="n">loop</span><span class="p">:</span>
            <span class="c1"># Reached the end, playing from 0</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="n">min_value</span>
        <span class="k">elif</span> <span class="n">new_value</span> <span class="o">&lt;</span> <span class="n">min_value</span> <span class="ow">and</span> <span class="n">loop</span><span class="p">:</span>
            <span class="c1"># Playing backwards</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="n">max_value</span>

        <span class="n">slider</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_time_series</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">new_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loop</span> <span class="ow">or</span> <span class="p">(</span><span class="n">min_value</span> <span class="o">&lt;=</span> <span class="n">new_value</span> <span class="o">&lt;=</span> <span class="n">max_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_time_series"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">update_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the time series</span>
<span class="sd">        :param widget: The slider widget (optional)</span>
<span class="sd">        :param event: The slider event (optional)</span>
<span class="sd">        :param value: The value to set. If None, then the slider value</span>
<span class="sd">            is used, if it&#39;s given as widget param</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_time_series</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: See if it&#39;s worth implementing transfer functions tweening in order to let</span>
<span class="sd">        the user see a gradual change between steps in a time series instead of a jump. Probably</span>
<span class="sd">        quite far down in the list of features.</span>
<span class="sd">        if value is None:</span>
<span class="sd">            lut = self.model.lut</span>
<span class="sd">            index, next_lut = self.model.get_lut_and_id(self.model.lut_id+1)</span>
<span class="sd">            tweened_tf = LUTModel()</span>
<span class="sd">            tweened_rgb = utils.blend_maps(lut.color_map, next_lut.color_map, self.model.time)</span>
<span class="sd">            tweened_alpha = utils.blend_maps(lut.alpha_map, next_lut.alpha_map, self.model.time)</span>
<span class="sd">            tweened_tf.set_color_and_alpha(tweened_rgb, tweened_alpha)</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Viewer.set_time_series"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.set_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">set_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the time series for the current selected object</span>
<span class="sd">        :param value: The given time step</span>
<span class="sd">        :param force_update: Whether an update is forced even if the</span>
<span class="sd">            given value is the same as the existing time step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time_series_value</span> <span class="o">==</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_update</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time_series_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span>
        <span class="c1"># TODO: handle case where value == string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Lines</span><span class="p">):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cell_data</span><span class="p">,</span> <span class="s1">&#39;GetArrayNames&#39;</span><span class="p">):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">cell_data</span><span class="o">.</span><span class="n">GetArrayNames</span><span class="p">()</span>
                <span class="c1">#name = actor.scalars_prefix + str(value)</span>
                <span class="c1">#point_data.SetActiveScalars(names[value])</span>
                <span class="c1"># Necessary for utils.Points in sphere mode (non screen-space)</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">mapper</span><span class="p">()</span><span class="o">.</span><span class="n">SelectColorArray</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Points</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">scalars_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">SetActiveScalars</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># Necessary for utils.Points in sphere mode (non screen-space)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">mapper</span><span class="p">()</span><span class="o">.</span><span class="n">SelectColorArray</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">scalars_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">polydata</span><span class="p">()</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">SetActiveScalars</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="n">controller</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">luts</span><span class="o">.</span><span class="n">set_current</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_lut_update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_color_bar</span><span class="p">()</span></div>
        <span class="c1">#elif isinstance(actor, vedo.Assembly):</span>
        <span class="c1">#elif isinstance(actor, vedo.Picture),</span>
        <span class="c1">#elif isinstance(actor, vtk.vtkActor2D)</span>

<div class="viewcode-block" id="Viewer.assign_scalars"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.assign_scalars">[docs]</a>    <span class="k">def</span> <span class="nf">assign_scalars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scalar_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">make_active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign a new data set and a color map to a target</span>
<span class="sd">        min_value=None, max_value=None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span>
        <span class="k">if</span> <span class="n">selected_view</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selected_view</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="n">volume_model</span> <span class="o">=</span> <span class="n">selected_view</span><span class="o">.</span><span class="n">model</span>
            <span class="n">lut_model</span> <span class="o">=</span> <span class="n">volume_model</span><span class="o">.</span><span class="n">build_lut</span><span class="p">(</span><span class="n">scalar_map</span><span class="p">,</span> <span class="n">scalar_range</span><span class="p">,</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">make_active</span><span class="o">=</span><span class="n">make_active</span><span class="p">)</span>
            <span class="n">selected_view</span><span class="o">.</span><span class="n">set_color_map</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">make_active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_lut_update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ui</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">lut_model</span></div>

<div class="viewcode-block" id="Viewer.handle_lut_update"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.handle_lut_update">[docs]</a>    <span class="k">def</span> <span class="nf">handle_lut_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the view with the given or current transfer function</span>
<span class="sd">        :param lut_model: A LUTModel (whose table property is a vtkLookupTable) </span>
<span class="sd">            to set on the current volume. If None, the current one will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">selection_controller</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">luts</span><span class="o">.</span><span class="n">current</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">view</span><span class="o">.</span><span class="n">set_color_map</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Viewer.animation_callback"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.animation_callback">[docs]</a>    <span class="k">def</span> <span class="nf">animation_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        You may override this function according to your needs</span>
<span class="sd">        :param progress: ratio of total animation (from 0.0 to 1.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.update_video_duration"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_video_duration">[docs]</a>    <span class="k">def</span> <span class="nf">update_video_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the video duration</span>
<span class="sd">        :param widget: The slider widget (optional)</span>
<span class="sd">        :param event: The slider event (optional)</span>
<span class="sd">        :param value: The value to set. If None, then the slider value</span>
<span class="sd">            is used, if it&#39;s given as widget param</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">video_duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_video_start_angle"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_video_start_angle">[docs]</a>    <span class="k">def</span> <span class="nf">update_video_start_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the video start angle</span>
<span class="sd">        :param widget: The slider widget (optional)</span>
<span class="sd">        :param event: The slider event (optional)</span>
<span class="sd">        :param value: The value to set. If None, then the slider value</span>
<span class="sd">        is used, if it&#39;s given as widget param</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">video_start_angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.update_video_end_angle"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.update_video_end_angle">[docs]</a>    <span class="k">def</span> <span class="nf">update_video_end_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the video end angle</span>
<span class="sd">        :param widget: The slider widget (optional)</span>
<span class="sd">        :param event: The slider event (optional)</span>
<span class="sd">        :param value: The value to set. If None, then the slider value</span>
<span class="sd">            is used, if it&#39;s given as widget param</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">video_end_angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.toggle_volumetric_lod"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.toggle_volumetric_lod">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_volumetric_lod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle volumetric LOD (subsampling)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumetric_lod</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">interactive_volume_subsampling</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.volumetric_lod"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.volumetric_lod">[docs]</a>    <span class="k">def</span> <span class="nf">volumetric_lod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable or disable volumetric LOD subsampling.</span>
<span class="sd">        Turn this on when you want faster interactive visualizations</span>
<span class="sd">        :param on: Whether volumetric subsampling is activated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">interactive_volume_subsampling</span> <span class="o">==</span> <span class="n">on</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">interactive_volume_subsampling</span> <span class="o">=</span> <span class="n">on</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="p">:</span>
            <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controllers_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">VolumeController</span><span class="p">):</span>
                <span class="n">controller</span><span class="o">.</span><span class="n">set_interactive_subsampling</span><span class="p">(</span><span class="n">on</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.export_image"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.export_image">[docs]</a>    <span class="k">def</span> <span class="nf">export_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;iblviewer.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the current image to a file</span>
<span class="sd">        :param file_name: File name with extension. PNG by default</span>
<span class="sd">        :param width: Width in pixels. If None, the width of the window is used.</span>
<span class="sd">        :param height: Height in pixels. If None, the height of the window is used.</span>
<span class="sd">        :param scale: Scale factor to make the image larger. Defaults to 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ui_visibility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ui_visibility</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">ui_button_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ui_visibility</span><span class="p">(</span><span class="n">ui_visibility</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.export_turntable_video"><a class="viewcode-back" href="../../_autosummary/iblviewer.application.html#iblviewer.application.Viewer.export_turntable_video">[docs]</a>    <span class="k">def</span> <span class="nf">export_turntable_video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;iblviewer.mp4&#39;</span><span class="p">,</span> <span class="n">start_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                <span class="n">end_angle</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a sagittal turntable video of the viewer.</span>
<span class="sd">        :param file_name: File name</span>
<span class="sd">        :param start_angle: Start angle</span>
<span class="sd">        :param end_angle: End angle. If it&#39;s the same value as start angle, then 360 is added</span>
<span class="sd">        :param duration: Duration of the video</span>
<span class="sd">        :param fps: Frames per second, defaults to 25</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">start_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_angle&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">end_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end_angle&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;video_duration&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="c1">#if start_angle is None or end_angle is None or duration is None or fps is None:</span>
            <span class="c1">#return</span>
        <span class="k">if</span> <span class="n">start_angle</span> <span class="o">==</span> <span class="n">end_angle</span><span class="p">:</span>
            <span class="n">end_angle</span> <span class="o">+=</span> <span class="mi">360</span>

        <span class="n">video</span> <span class="o">=</span> <span class="n">vedo</span><span class="o">.</span><span class="n">Video</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>
        
        <span class="c1"># Disable volumetric LOD for video-making</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumetric_lod</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">ui_visibility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ui_visibility</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">ui_button_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span>
        <span class="n">angle_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_angle</span> <span class="o">-</span> <span class="n">start_angle</span><span class="p">)</span> <span class="o">/</span> <span class="n">end</span>
        <span class="c1">#axes = [0, 1, 2]</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">angle_step</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Z_DOWN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_callback</span><span class="p">(</span><span class="n">step</span> <span class="o">/</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
            <span class="n">video</span><span class="o">.</span><span class="n">addFrame</span><span class="p">()</span>
        
        <span class="c1"># Disable volumetric LOD for video-making</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumetric_lod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">interactive_volume_subsampling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ui_visibility</span><span class="p">(</span><span class="n">ui_visibility</span><span class="p">)</span>
        <span class="n">video</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    TODO: record a video from offscreen buffer</span>
<span class="sd">    def record_video(self):</span>
<span class="sd">        video = Video(video_file_path, fps=fps, duration=duration)</span>
<span class="sd">        self.show(interactive=False, resetcam=False)</span>
<span class="sd">        video.addFrame()</span>
<span class="sd">        video.close()</span>
<span class="sd">    &#39;&#39;&#39;</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>