<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>brainbox.processing &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="brainbox.quality" href="brainbox.quality.html" />
    <link rel="prev" title="brainbox.population.decode" href="brainbox.population.decode.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataJoint</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_introduction.html">Introduction to DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_public.html">Publicly available IBL data via Datajoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_credentials.html">DataJoint credentials for internal IBL users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_intro/dj_intro.html">Datajoint Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_basics/dj_basics.html">Exploring the IBL Data Pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ibllib.html">ibllib</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="brainbox.html">brainbox</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="brainbox.atlas.html">brainbox.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.behavior.html">brainbox.behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.core.html">brainbox.core</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.ephys_plots.html">brainbox.ephys_plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.io.html">brainbox.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.lfp.html">brainbox.lfp</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.metrics.html">brainbox.metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.modeling.html">brainbox.modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.plot.html">brainbox.plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.plot_base.html">brainbox.plot_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.population.html">brainbox.population</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">brainbox.processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.quality.html">brainbox.quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.singlecell.html">brainbox.singlecell</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.spike_features.html">brainbox.spike_features</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.task.html">brainbox.task</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.tests.html">brainbox.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.video.html">brainbox.video</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iblviewer.html">iblviewer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Detailed Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../010_api_reference.html">API Reference</a> &raquo;</li>
          <li><a href="brainbox.html">brainbox</a> &raquo;</li>
      <li>brainbox.processing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/brainbox.processing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="module-brainbox.processing">
<span id="brainbox-processing"></span><h1>brainbox.processing<a class="headerlink" href="#module-brainbox.processing" title="Permalink to this headline"></a></h1>
<p>Processes data from one form into another, e.g. taking spike times and binning them into
non-overlapping bins and convolving spike times with a gaussian kernel.</p>
<p class="rubric">Functions</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.processing.bin_spikes" title="brainbox.processing.bin_spikes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bin_spikes</span></code></a></p></td>
<td><p>Wrapper for bincount2D which is intended to take in a TimeSeries object of spike times and cluster identities and spit out spike counts in bins of a specified width binsize, also in another TimeSeries object.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.processing.bincount2D" title="brainbox.processing.bincount2D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bincount2D</span></code></a></p></td>
<td><p>Computes a 2D histogram by aggregating values in a 2D array.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.processing.compute_cluster_average" title="brainbox.processing.compute_cluster_average"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_cluster_average</span></code></a></p></td>
<td><p>Quickish way to compute the average of some quantity across spikes in each cluster given quantity for each spike</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.processing.filter_units" title="brainbox.processing.filter_units"><code class="xref py py-obj docutils literal notranslate"><span class="pre">filter_units</span></code></a></p></td>
<td><p>Filters units according to some parameters. <a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs are the keyword parameters used to filter the units.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.processing.get_units_bunch" title="brainbox.processing.get_units_bunch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_units_bunch</span></code></a></p></td>
<td><p>Returns a bunch, where the bunch keys are keys from <cite>spks</cite> with labels of spike information (e.g.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.processing.sync" title="brainbox.processing.sync"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sync</span></code></a></p></td>
<td><p>Function for resampling a single or multiple time series to a single, evenly-spaced, delta t between observations.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="brainbox.processing.sync">
<span class="sig-name descname"><span class="pre">sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">times</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeseries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offsets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'zero'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fillval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/processing.html#sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.processing.sync" title="Permalink to this definition"></a></dt>
<dd><p>Function for resampling a single or multiple time series to a single, evenly-spaced, delta t
between observations. Uses interpolation to find values.</p>
<p>Can be used on raw numpy arrays of timestamps and values using the ‘times’ and ‘values’ kwargs
and/or on brainbox.core.TimeSeries objects passed to the ‘timeseries’ kwarg. If passing both
TimeSeries objects and numpy arrays, the offsets passed should be for the TS objects first and
then the numpy arrays.</p>
<p>Uses scipy’s interpolation library to perform interpolation.
See scipy.interp1d for more information regarding interp and fillval parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dt</strong> (<em>float</em>) – Separation of points which the output timeseries will be sampled at</p></li>
<li><p><strong>timeseries</strong> (<em>tuple of TimeSeries objects</em><em>, or </em><em>a single TimeSeries object.</em>) – A group of time series to perform alignment or a single time series.
Must have time stamps.</p></li>
<li><p><strong>times</strong> (<em>np.ndarray</em><em> or </em><em>list of np.ndarrays</em>) – time stamps for the observations in ‘values’]</p></li>
<li><p><strong>values</strong> (<em>np.ndarray</em><em> or </em><em>list of np.ndarrays</em>) – observations corresponding to the timestamps in ‘times’</p></li>
<li><p><strong>offsets</strong> (<em>tuple of floats</em><em>, </em><em>optional</em>) – tuple of offsets for time stamps of each time series. Offsets for passed
TimeSeries objects first, then offsets for passed numpy arrays. defaults to None</p></li>
<li><p><strong>interp</strong> (<em>str</em>) – Type of interpolation to use. Refer to scipy.interpolate.interp1d for possible
values, defaults to np.nan</p></li>
<li><p><strong>fillval</strong> – Fill values to use when interpolating outside of range of data. See interp1d
for possible values, defaults to np.nan</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TimeSeries object with each row representing synchronized values of all
input TimeSeries. Will carry column names from input time series if all of them have column
names.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.processing.bincount2D">
<span class="sig-name descname"><span class="pre">bincount2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ybin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/processing.html#bincount2D"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.processing.bincount2D" title="Permalink to this definition"></a></dt>
<dd><p>Computes a 2D histogram by aggregating values in a 2D array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – values to bin along the 2nd dimension (c-contiguous)</p></li>
<li><p><strong>y</strong> – values to bin along the 1st dimension</p></li>
<li><p><strong>xbin</strong> – scalar: bin size along 2nd dimension
0: aggregate according to unique values
array: aggregate according to exact values (count reduce operation)</p></li>
<li><p><strong>ybin</strong> – scalar: bin size along 1st dimension
0: aggregate according to unique values
array: aggregate according to exact values (count reduce operation)</p></li>
<li><p><strong>xlim</strong> – (optional) 2 values (array or list) that restrict range along 2nd dimension</p></li>
<li><p><strong>ylim</strong> – (optional) 2 values (array or list) that restrict range along 1st dimension</p></li>
<li><p><strong>weights</strong> – (optional) defaults to None, weights to apply to each value for aggregation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>3 numpy arrays MAP [ny,nx] image, xscale [nx], yscale [ny]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.processing.compute_cluster_average">
<span class="sig-name descname"><span class="pre">compute_cluster_average</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spike_clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spike_var</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/processing.html#compute_cluster_average"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.processing.compute_cluster_average" title="Permalink to this definition"></a></dt>
<dd><p>Quickish way to compute the average of some quantity across spikes in each cluster given
quantity for each spike</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spike_clusters</strong> – cluster idx of each spike</p></li>
<li><p><strong>spike_var</strong> – variable of each spike (e.g spike amps or spike depths)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>cluster id, average of quantity for each cluster, no. of spikes per cluster</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.processing.bin_spikes">
<span class="sig-name descname"><span class="pre">bin_spikes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spikes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binsize</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/processing.html#bin_spikes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.processing.bin_spikes" title="Permalink to this definition"></a></dt>
<dd><p>Wrapper for bincount2D which is intended to take in a TimeSeries object of spike times
and cluster identities and spit out spike counts in bins of a specified width binsize, also in
another TimeSeries object. Can either return a TS object with each row labeled with the
corresponding interval or the value of the left edge of the bin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spikes</strong> (<em>TimeSeries object with 'clusters' column and timestamps</em>) – Spike times and cluster identities of sorted spikes</p></li>
<li><p><strong>binsize</strong> (<em>float</em>) – Width of the non-overlapping bins in which to bin spikes</p></li>
<li><p><strong>interval_indices</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to use intervals as the time stamps for binned spikes, rather
than the left edge value of the bins, defaults to False</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object with 2D array of shape T x N, for T timesteps and N clusters, and the
associated time stamps.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>TimeSeries object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.processing.get_units_bunch">
<span class="sig-name descname"><span class="pre">get_units_bunch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spks_b</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/processing.html#get_units_bunch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.processing.get_units_bunch" title="Permalink to this definition"></a></dt>
<dd><p>Returns a bunch, where the bunch keys are keys from <cite>spks</cite> with labels of spike information
(e.g. unit IDs, times, features, etc.), and the values for each key are arrays with values for
each unit: these arrays are ordered and can be indexed by unit id.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spks_b</strong> (<em>bunch</em>) – A spikes bunch containing fields with spike information (e.g. unit IDs, times, features,
etc.) for all spikes.</p></li>
<li><p><strong>features</strong> (<em>list of strings</em><em> (</em><em>optional positional arg</em><em>)</em>) – A list of names of labels of spike information (which must be keys in <cite>spks</cite>) that specify
which labels to return as keys in <cite>units</cite>. If not provided, all keys in <cite>spks</cite> are returned
as keys in <cite>units</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>units_b</strong> – A bunch with keys of labels of spike information (e.g. cluster IDs, times, features, etc.)
whose values are arrays that hold values for each unit. The arrays for each key are ordered
by unit ID.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bunch</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>1) Create a units bunch given a spikes bunch, and get the amps for unit #4 from the units
bunch.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">brainbox</span> <span class="k">as</span> <span class="nn">bb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">alf.io</span> <span class="k">as</span> <span class="nn">aio</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibllib.ephys.spikes</span> <span class="k">as</span> <span class="nn">e_spks</span>
<span class="go">(*Note, if there is no &#39;alf&#39; directory, make &#39;alf&#39; directory from &#39;ks2&#39; output directory):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_spks</span><span class="o">.</span><span class="n">ks2_to_alf</span><span class="p">(</span><span class="n">path_to_ks_out</span><span class="p">,</span> <span class="n">path_to_alf_out</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spks_b</span> <span class="o">=</span> <span class="n">aio</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">path_to_alf_out</span><span class="p">,</span> <span class="s1">&#39;spikes&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">units_b</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">get_units_bunch</span><span class="p">(</span><span class="n">spks_b</span><span class="p">)</span>
<span class="go"># Get amplitudes for unit 4.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amps</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;amps&#39;</span><span class="p">][</span><span class="s1">&#39;4&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>TODO add computation time estimate?</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.processing.filter_units">
<span class="sig-name descname"><span class="pre">filter_units</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">units_b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/processing.html#filter_units"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.processing.filter_units" title="Permalink to this definition"></a></dt>
<dd><p>Filters units according to some parameters. <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs are the keyword parameters used to filter
the units.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>units_b</strong> (<em>bunch</em>) – A bunch with keys of labels of spike information (e.g. cluster IDs, times, features, etc.)
whose values are arrays that hold values for each unit. The arrays for each key are ordered
by unit ID.</p></li>
<li><p><strong>t</strong> (<em>float</em>) – Duration of time over which to calculate the firing rate and false positive rate.</p></li>
<li><p><strong>Parameters</strong> (<em>Keyword</em>) – </p></li>
<li><p><strong>------------------</strong> – </p></li>
<li><p><strong>min_amp</strong> (<em>float</em>) – The minimum mean amplitude (in V) of the spikes in the unit. Default value is 50e-6.</p></li>
<li><p><strong>min_fr</strong> (<em>float</em>) – The minimum firing rate (in Hz) of the unit. Default value is 0.5.</p></li>
<li><p><strong>max_fpr</strong> (<em>float</em>) – The maximum false positive rate of the unit (using the fp formula in Hill et al. (2011)
J Neurosci 31: 8699-8705). Default value is 0.2.</p></li>
<li><p><strong>rp</strong> (<em>float</em>) – The refractory period (in s) of the unit. Used to calculate <cite>max_fp</cite>. Default value is
0.002.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>filt_units</strong> – The ids of the filtered units.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#brainbox.processing.get_units_bunch" title="brainbox.processing.get_units_bunch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_units_bunch</span></code></a></p>
</div>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><dl>
<dt>Filter units according to the default parameters.</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">brainbox</span> <span class="k">as</span> <span class="nn">bb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">alf.io</span> <span class="k">as</span> <span class="nn">aio</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ibllib.ephys.spikes</span> <span class="k">as</span> <span class="nn">e_spks</span>
<span class="go">(*Note, if there is no &#39;alf&#39; directory, make &#39;alf&#39; directory from &#39;ks2&#39; output directory):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_spks</span><span class="o">.</span><span class="n">ks2_to_alf</span><span class="p">(</span><span class="n">path_to_ks_out</span><span class="p">,</span> <span class="n">path_to_alf_out</span><span class="p">)</span>
<span class="go"># Get a spikes bunch, units bunch, and filter the units.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spks_b</span> <span class="o">=</span> <span class="n">aio</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">path_to_alf_out</span><span class="p">,</span> <span class="s1">&#39;spikes&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">units_b</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">get_units_bunch</span><span class="p">(</span><span class="n">spks_b</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">,</span> <span class="s1">&#39;amps&#39;</span><span class="p">,</span> <span class="s1">&#39;clusters&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span> <span class="o">=</span> <span class="n">spks_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">spks_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_units</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">filter_units</span><span class="p">(</span><span class="n">units_b</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
<p>2) Filter units with no minimum amplitude, a minimum firing rate of 1 Hz, and a max false
positive rate of 0.2, given a refractory period of 2 ms.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_units</span>  <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">filter_units</span><span class="p">(</span><span class="n">units_b</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">min_amp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_fr</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>TODO: <cite>units_b</cite> input arg could eventually be replaced by <cite>clstrs_b</cite> if the required metrics</dt><dd><p>are in <cite>clstrs_b[‘metrics’]</cite></p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="brainbox.population.decode.html" class="btn btn-neutral float-left" title="brainbox.population.decode" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="brainbox.quality.html" class="btn btn-neutral float-right" title="brainbox.quality" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>