<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ibllib.io.extractors.video_motion &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ibllib.io.extractors.widefield" href="ibllib.io.extractors.widefield.html" />
    <link rel="prev" title="ibllib.io.extractors.training_wheel" href="ibllib.io.extractors.training_wheel.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_download.html">Download the public datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ibllib.html">ibllib</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ibllib.atlas.html">ibllib.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.ephys.html">ibllib.ephys</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.exceptions.html">ibllib.exceptions</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="ibllib.io.html">ibllib.io</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="ibllib.io.extractors.html">ibllib.io.extractors</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.ffmpeg.html">ibllib.io.ffmpeg</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.flags.html">ibllib.io.flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.globus.html">ibllib.io.globus</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.misc.html">ibllib.io.misc</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.npy_header.html">ibllib.io.npy_header</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.raw_daq_loaders.html">ibllib.io.raw_daq_loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.raw_data_loaders.html">ibllib.io.raw_data_loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.session_params.html">ibllib.io.session_params</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.video.html">ibllib.io.video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.misc.html">ibllib.misc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.oneibl.html">ibllib.oneibl</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.pipes.html">ibllib.pipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.plots.html">ibllib.plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.qc.html">ibllib.qc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.tests.html">ibllib.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.time.html">ibllib.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="brainbox.html">brainbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="iblatlas.html">iblatlas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../010_api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="ibllib.html">ibllib</a></li>
          <li class="breadcrumb-item"><a href="ibllib.io.html">ibllib.io</a></li>
          <li class="breadcrumb-item"><a href="ibllib.io.extractors.html">ibllib.io.extractors</a></li>
      <li class="breadcrumb-item active">ibllib.io.extractors.video_motion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/ibllib.io.extractors.video_motion.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ibllib.io.extractors.video_motion">
<span id="ibllib-io-extractors-video-motion"></span><h1>ibllib.io.extractors.video_motion<a class="headerlink" href="#module-ibllib.io.extractors.video_motion" title="Link to this heading"></a></h1>
<p>A module for aligning the wheel motion with the rotary encoder.  Currently used by the camera QC
in order to check timestamp alignment.</p>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.video_motion.find_nearest" title="ibllib.io.extractors.video_motion.find_nearest"><code class="xref py py-obj docutils literal notranslate"><span class="pre">find_nearest</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.video_motion.MotionAlignment" title="ibllib.io.extractors.video_motion.MotionAlignment"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MotionAlignment</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession" title="ibllib.io.extractors.video_motion.MotionAlignmentFullSession"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MotionAlignmentFullSession</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.find_nearest">
<span class="sig-name descname"><span class="pre">find_nearest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#find_nearest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.find_nearest" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">MotionAlignment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eid=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log=&lt;Logger</span> <span class="pre">ibllib.io.extractors.video_motion</span> <span class="pre">(INFO)&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment.roi">
<span class="sig-name descname"><span class="pre">roi</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'body':</span> <span class="pre">((402,</span> <span class="pre">481),</span> <span class="pre">(31,</span> <span class="pre">103)),</span> <span class="pre">'left':</span> <span class="pre">((800,</span> <span class="pre">1020),</span> <span class="pre">(233,</span> <span class="pre">1096)),</span> <span class="pre">'right':</span> <span class="pre">((426,</span> <span class="pre">510),</span> <span class="pre">(104,</span> <span class="pre">545))}</span></em><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment.roi" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment.align_all_trials">
<span class="sig-name descname"><span class="pre">align_all_trials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignment.align_all_trials"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment.align_all_trials" title="Link to this definition"></a></dt>
<dd><p>Align all wheel motion for all trials</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment.set_roi">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">set_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">video_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignment.set_roi"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment.set_roi" title="Link to this definition"></a></dt>
<dd><p>Manually set the ROIs for a given set of videos
TODO Improve docstring
TODO A method for setting ROIs by label</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment.load_data">
<span class="sig-name descname"><span class="pre">load_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignment.load_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment.load_data" title="Link to this definition"></a></dt>
<dd><p>Load wheel, trial and camera timestamp data
:return: wheel, trials</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment.align_motion">
<span class="sig-name descname"><span class="pre">align_motion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(-inf,</span> <span class="pre">inf)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'left'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignment.align_motion"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment.align_motion" title="Link to this definition"></a></dt>
<dd><p>Align video to the wheel using cross-correlation of the video motion signal and the rotary
encoder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>period</strong> (<em>(</em><em>float</em><em>, </em><em>float</em><em>)</em>) – The time period over which to do the alignment.</p></li>
<li><p><strong>side</strong> (<em>{'left'</em><em>, </em><em>'right'}</em>) – With which camera to perform the alignment.</p></li>
<li><p><strong>sd_thresh</strong> (<em>float</em>) – For plotting where the motion energy goes above this standard deviation threshold.</p></li>
<li><p><strong>display</strong> (<em>bool</em>) – When true, displays the aligned wheel motion energy along with the rotary encoder
signal.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>int</em> – Frame offset, i.e. by how many frames the video was shifted to match the rotary encoder
signal.  Negative values mean the video was shifted backwards with respect to the wheel
timestamps.</p></li>
<li><p><em>float</em> – The peak cross-correlation.</p></li>
<li><p><em>numpy.ndarray</em> – The motion energy used in the cross-correlation, i.e. the frame difference for the
period given.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignment.plot_alignment">
<span class="sig-name descname"><span class="pre">plot_alignment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">energy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignment.plot_alignment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignment.plot_alignment" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">MotionAlignmentFullSession</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.load_data">
<span class="sig-name descname"><span class="pre">load_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nidq'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">location</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.load_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.load_data" title="Link to this definition"></a></dt>
<dd><p>Loads relevant data from disk to perform motion alignment</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> – type of sync used, ‘nidq’ or ‘bpod’</p></li>
<li><p><strong>location</strong> – where the code is being run, if location=’SDSC’, the dataset uuids are removed
when loading the data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.get_roi_mask">
<span class="sig-name descname"><span class="pre">get_roi_mask</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.get_roi_mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.get_roi_mask" title="Link to this definition"></a></dt>
<dd><p>Compute the region of interest mask for a given camera. This corresponds to a box in the video that we will
use to compute the wheel motion energy
:return:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.find_contaminated_frames">
<span class="sig-name descname"><span class="pre">find_contaminated_frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">video_frames</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.find_contaminated_frames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.find_contaminated_frames" title="Link to this definition"></a></dt>
<dd><p>Finds frames in the video that have artefacts such as the mouse’s paw or a human hand. In order to determine
frames with contamination an Otsu thresholding is applied to each frame to detect the artefact from the
background image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>video_frames</strong> – np array of video frames (nframes, nwidth, nheight)</p></li>
<li><p><strong>thresold</strong> – threshold to differentiate artefact from background</p></li>
<li><p><strong>normalise</strong> – whether to normalise the threshold values for each frame to the baseline</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>mask of frames that are contaminated</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.compute_motion_energy">
<span class="sig-name descname"><span class="pre">compute_motion_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.compute_motion_energy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.compute_motion_energy" title="Link to this definition"></a></dt>
<dd><p>Computes the video motion energy for frame indexes between first and last. This function is written to be run
in a parallel fashion jusing joblib.parallel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>first</strong> – first frame index of frame interval to consider</p></li>
<li><p><strong>last</strong> – last frame index of frame interval to consider</p></li>
<li><p><strong>wg</strong> – WindowGenerator</p></li>
<li><p><strong>iw</strong> – iteration of the WindowGenerator</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.compute_shifts">
<span class="sig-name descname"><span class="pre">compute_shifts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">times</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.compute_shifts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.compute_shifts" title="Link to this definition"></a></dt>
<dd><p>Compute the cross-correlation between the video motion energy and the wheel velocity to find the mismatch
between the camera ttls and the video frames. This function is written to run in a parallel manner using
joblib.parallel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>times</strong> – the times of the video frames across the whole session (ttls)</p></li>
<li><p><strong>me</strong> – the video motion energy computed across the whole session</p></li>
<li><p><strong>first</strong> – first time idx to consider</p></li>
<li><p><strong>last</strong> – last time idx to consider</p></li>
<li><p><strong>wg</strong> – WindowGenerator</p></li>
<li><p><strong>iw</strong> – iteration of the WindowGenerator</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.clean_shifts">
<span class="sig-name descname"><span class="pre">clean_shifts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.clean_shifts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.clean_shifts" title="Link to this definition"></a></dt>
<dd><p>Removes artefacts from the computed shifts across time. We assume that the shifts should never increase
over time and that the jump between consecutive shifts shouldn’t be greater than 1</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – computed shifts</p></li>
<li><p><strong>n</strong> – condition to apply</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.qc_shifts">
<span class="sig-name descname"><span class="pre">qc_shifts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shifts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shifts_filt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.qc_shifts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.qc_shifts" title="Link to this definition"></a></dt>
<dd><p>Compute qc values for the wheel alignment. We consider 4 things
1. The number of camera ttl values that are missing (when we have less ttls than video frames)
2. The number of shifts that have nan values, this means the video motion energy computation
3. The number of large jumps (&gt;10) between the computed shifts
4. The number of jumps (&gt;1) between the shifts after they have been cleaned</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shifts</strong> – np.array of shifts over session</p></li>
<li><p><strong>shifts_filt</strong> – np.array of shifts after being cleaned over session</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.extract_times">
<span class="sig-name descname"><span class="pre">extract_times</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shifts_filt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_shifts</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.extract_times"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.extract_times" title="Link to this definition"></a></dt>
<dd><p>Extracts new camera times after applying the computed shifts across the session</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shifts_filt</strong> – filtered shifts computed across session</p></li>
<li><p><strong>t_shifts</strong> – time point of computed shifts</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.single_cluster_raster">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">single_cluster_raster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spike_times</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dividers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.single_cluster_raster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.single_cluster_raster" title="Link to this definition"></a></dt>
<dd><p>Compute and plot trial aligned spike rasters and psth</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spike_times</strong> – times of variable</p></li>
<li><p><strong>events</strong> – trial times to align to</p></li>
<li><p><strong>trial_idx</strong> – trial idx to sort by</p></li>
<li><p><strong>dividers</strong> – </p></li>
<li><p><strong>colors</strong> – </p></li>
<li><p><strong>labels</strong> – </p></li>
<li><p><strong>weights</strong> – </p></li>
<li><p><strong>fr</strong> – </p></li>
<li><p><strong>norm</strong> – </p></li>
<li><p><strong>axs</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.plot_with_behavior">
<span class="sig-name descname"><span class="pre">plot_with_behavior</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.plot_with_behavior"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.plot_with_behavior" title="Link to this definition"></a></dt>
<dd><p>Makes a summary figure of the alignment when behaviour data is available
:return:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.plot_without_behavior">
<span class="sig-name descname"><span class="pre">plot_without_behavior</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.plot_without_behavior"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.plot_without_behavior" title="Link to this definition"></a></dt>
<dd><p>Makes a summary figure of the alignment when behaviour data is not available
:return:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.video_motion.MotionAlignmentFullSession.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/video_motion.html#MotionAlignmentFullSession.process"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.video_motion.MotionAlignmentFullSession.process" title="Link to this definition"></a></dt>
<dd><p>Main function used to apply the video motion wheel alignment to the camera times. This function does the
following
1. Computes the video motion energy across the whole session (computed in windows and parallelised)
2. Computes the shift that should be applied to the camera times across the whole session by computing</p>
<blockquote>
<div><p>the cross correlation between the video motion energy and the wheel speed (computed in
overlapping windows and parallelised)</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Removes artefacts from the computed shifts</p></li>
<li><p>Computes the qc for the wheel alignment</p></li>
<li><p>Extracts the new camera times using the shifts computed from the video wheel alignment</p></li>
<li><p>If upload is True, creates a summary plot of the alignment and uploads the figure to the relevant session</p></li>
</ol>
<blockquote>
<div><p>on alyx</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ibllib.io.extractors.training_wheel.html" class="btn btn-neutral float-left" title="ibllib.io.extractors.training_wheel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ibllib.io.extractors.widefield.html" class="btn btn-neutral float-right" title="ibllib.io.extractors.widefield" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>