<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ibllib.pipes.ephys_alignment &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=17142d56" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ibllib.pipes.ephys_preprocessing" href="ibllib.pipes.ephys_preprocessing.html" />
    <link rel="prev" title="ibllib.pipes.dynamic_pipeline" href="ibllib.pipes.dynamic_pipeline.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_download.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_download.html#Explore-and-download-data-using-the-ONE-api">Explore and download data using the ONE-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_screen_stimulus.html">Computing the stimulus position using the wheel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ibllib.html">ibllib</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ibllib.atlas.html">ibllib.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.ephys.html">ibllib.ephys</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.exceptions.html">ibllib.exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.io.html">ibllib.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.misc.html">ibllib.misc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.oneibl.html">ibllib.oneibl</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="ibllib.pipes.html">ibllib.pipes</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.html#ibllib.pipes.assign_task"><code class="docutils literal notranslate"><span class="pre">assign_task()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.audio_tasks.html">ibllib.pipes.audio_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.base_tasks.html">ibllib.pipes.base_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.behavior_tasks.html">ibllib.pipes.behavior_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.dynamic_pipeline.html">ibllib.pipes.dynamic_pipeline</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">ibllib.pipes.ephys_alignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.ephys_preprocessing.html">ibllib.pipes.ephys_preprocessing</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.ephys_tasks.html">ibllib.pipes.ephys_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.histology.html">ibllib.pipes.histology</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.local_server.html">ibllib.pipes.local_server</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.mesoscope_tasks.html">ibllib.pipes.mesoscope_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.misc.html">ibllib.pipes.misc</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.photometry_tasks.html">ibllib.pipes.photometry_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.purge_rig_data.html">ibllib.pipes.purge_rig_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.remote_server.html">ibllib.pipes.remote_server</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.scan_fix_passive_files.html">ibllib.pipes.scan_fix_passive_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.sync_tasks.html">ibllib.pipes.sync_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.tasks.html">ibllib.pipes.tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.training_preprocessing.html">ibllib.pipes.training_preprocessing</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.training_status.html">ibllib.pipes.training_status</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.transfer_rig_data.html">ibllib.pipes.transfer_rig_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.video_tasks.html">ibllib.pipes.video_tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.widefield_tasks.html">ibllib.pipes.widefield_tasks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.plots.html">ibllib.plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.qc.html">ibllib.qc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.tests.html">ibllib.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.time.html">ibllib.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="brainbox.html">brainbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="iblatlas.html">iblatlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="iblutil.html">iblutil</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../010_api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="ibllib.html">ibllib</a></li>
          <li class="breadcrumb-item"><a href="ibllib.pipes.html">ibllib.pipes</a></li>
      <li class="breadcrumb-item active">ibllib.pipes.ephys_alignment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/ibllib.pipes.ephys_alignment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ibllib.pipes.ephys_alignment">
<span id="ibllib-pipes-ephys-alignment"></span><h1>ibllib.pipes.ephys_alignment<a class="headerlink" href="#module-ibllib.pipes.ephys_alignment" title="Link to this heading"></a></h1>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.pipes.ephys_alignment.EphysAlignment" title="ibllib.pipes.ephys_alignment.EphysAlignment"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EphysAlignment</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">EphysAlignment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_picks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chn_depths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track_prev</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_prev</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">brain_atlas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">speedy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_insertion_track">
<span class="sig-name descname"><span class="pre">get_insertion_track</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_picks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">speedy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_insertion_track"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_insertion_track" title="Link to this definition"></a></dt>
<dd><p>Extends probe trajectory from bottom of brain to upper bound of allen atlas</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>xyz_picks</strong> (<em>np.array</em><em>(</em><em>(</em><em>n</em><em>, </em><em>3</em><em>)</em><em>) </em><em>- n: no.</em><em> of </em><em>unique points</em>) – points defining probe trajectory in 3D space (xyz)</p>
</dd>
<dt class="field-even">Return xyz_track<span class="colon">:</span></dt>
<dd class="field-even"><p>points defining extended trajectory in 3D space (xyz)</p>
</dd>
<dt class="field-odd">Return track_extent<span class="colon">:</span></dt>
<dd class="field-odd"><p>cumulative distance between two extremes of xyz_track (bottom of</p>
</dd>
</dl>
<p>brain and top of atlas) offset by distance to probe tip
:type track_extent: np.array((2))</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_track_and_feature">
<span class="sig-name descname"><span class="pre">get_track_and_feature</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_track_and_feature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_track_and_feature" title="Link to this definition"></a></dt>
<dd><p>Return track, feature and xyz_track variables</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.feature2track">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">feature2track</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.feature2track"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.feature2track" title="Link to this definition"></a></dt>
<dd><p>Estimate new values of trk according to interpolated fit between feature and track space</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trk</strong> (<em>np.array</em>) – points in track space to convert feature space</p></li>
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>) </em><em>n_lines: no.</em><em> of </em><em>user reference lines</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
</ul>
</dd>
<dt class="field-even">Return fcn(trk)<span class="colon">:</span></dt>
<dd class="field-even"><p>interpolated values of trk</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.track2feature">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">track2feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ft</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.track2feature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.track2feature" title="Link to this definition"></a></dt>
<dd><p>Estimate new values of ft according to interpolated fit between track and feature space</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ft</strong> (<em>np.array</em>) – points in feature space to convert track space</p></li>
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>) </em><em>n_lines: no.</em><em> of </em><em>user reference lines</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
</ul>
</dd>
<dt class="field-even">Return fcn(ft)<span class="colon">:</span></dt>
<dd class="field-even"><p>interpolated values of ft</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.feature2track_lin">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">feature2track_lin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.feature2track_lin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.feature2track_lin" title="Link to this definition"></a></dt>
<dd><p>Estimate new values of trk according to linear fit between feature and track space, only
implemented if no. of reference points &gt;= 3</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trk</strong> (<em>np.array</em>) – points in track space to convert feature space</p></li>
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>) </em><em>n_lines: no.</em><em> of </em><em>user reference lines</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
</ul>
</dd>
<dt class="field-even">Return fcn(trk)<span class="colon">:</span></dt>
<dd class="field-even"><p>linear fit values of trk</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_uniform">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">adjust_extremes_uniform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.adjust_extremes_uniform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_uniform" title="Link to this definition"></a></dt>
<dd><p>Change the value of the first and last reference points (non user chosen points) such
that coordinates outside user picked regions are left unchanged</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>) </em><em>n_lines: no.</em><em> of </em><em>user reference lines</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
</ul>
</dd>
<dt class="field-even">Return track<span class="colon">:</span></dt>
<dd class="field-even"><p>reference coordinates in track space with first and last value adjusted</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_linear">
<span class="sig-name descname"><span class="pre">adjust_extremes_linear</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extend_feature</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.adjust_extremes_linear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_linear" title="Link to this definition"></a></dt>
<dd><p>Change the value of the first and last reference points (non user chosen points) such
that coordinates outside user picked regions have a linear fit applied</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
<li><p><strong>extend_feature</strong> (<em>float</em>) – amount to extend extreme coordinates before applying linear fit</p></li>
</ul>
</dd>
<dt class="field-even">Return feature<span class="colon">:</span></dt>
<dd class="field-even"><p>reference coordinates in feature space with first and last value adjusted</p>
</dd>
<dt class="field-odd">Return track<span class="colon">:</span></dt>
<dd class="field-odd"><p>reference coordinates in track space with first and last value adjusted</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.scale_histology_regions">
<span class="sig-name descname"><span class="pre">scale_histology_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.scale_histology_regions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.scale_histology_regions" title="Link to this definition"></a></dt>
<dd><p>Recompute locations of brain region boundaries using interpolated fit based on reference
lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>) </em><em>n_lines: no.</em><em> of </em><em>user reference lines</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
</ul>
</dd>
<dt class="field-even">Return region<span class="colon">:</span></dt>
<dd class="field-even"><p>new coordinates of histology boundaries after applying interpolation</p>
</dd>
<dt class="field-odd">Return region_label<span class="colon">:</span></dt>
<dd class="field-odd"><p>new coordinates of histology labels positions after applying
interpolation</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_histology_regions">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_histology_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth_coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">brain_atlas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_histology_regions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_histology_regions" title="Link to this definition"></a></dt>
<dd><p>Find all brain regions and their boundaries along the depth of probe or track</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xyz_coords</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_points</em><em>, </em><em>3</em><em>)</em><em>) </em><em>n_points: no.</em><em> of </em><em>points</em>) – 3D coordinates of points along probe or track</p></li>
<li><p><strong>depth_coords</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_points</em><em>)</em><em>)</em>) – depth along probe or track where each xyz_coord is located</p></li>
</ul>
</dd>
<dt class="field-even">Return region<span class="colon">:</span></dt>
<dd class="field-even"><p>coordinates bounding each brain region</p>
</dd>
<dt class="field-odd">Return region_label<span class="colon">:</span></dt>
<dd class="field-odd"><p>label for each brain region and coordinate of where to place label</p>
</dd>
<dt class="field-even">Return region_colour<span class="colon">:</span></dt>
<dd class="field-even"><p>allen atlas rgb colour for each brain region along track</p>
</dd>
<dt class="field-odd">Return region_id<span class="colon">:</span></dt>
<dd class="field-odd"><p>allen atlas id for each brain region along track</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_nearest_boundary">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_nearest_boundary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allen</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">brain_atlas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_nearest_boundary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_nearest_boundary" title="Link to this definition"></a></dt>
<dd><p>Finds distance to closest neighbouring brain region along trajectory. For each point in
xyz_coords computes the plane passing through point and perpendicular to trajectory and
finds all brain regions that lie in that plane up to a given distance extent from specified
point. Additionally, if requested, computes distance between the parents of regions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xyz_coords</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_points</em><em>, </em><em>3</em><em>)</em><em>) </em><em>n_points: no.</em><em> of </em><em>points</em>) – 3D coordinates of points along probe or track</p></li>
<li><p><strong>allen</strong> – dataframe containing allen info. Loaded from allen_structure_tree in</p></li>
</ul>
</dd>
</dl>
<p>ibllib/atlas
:type allen: pandas Dataframe
:param extent: extent of plane in each direction from origin in (um)
:type extent: float
:param steps: no. of steps to discretise plane into
:type steps: int
:param parent: Whether to also compute nearest distance between parents of regions
:type parent: bool
:return nearest_bound: dict containing results
:type nearest_bound: dict</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.arrange_into_regions">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">arrange_into_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">depth_coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region_colours</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.arrange_into_regions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.arrange_into_regions" title="Link to this definition"></a></dt>
<dd><p>Arrange output from get_nearest_boundary into a form that can be plot using pyqtgraph or
matplotlib</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>depth_coords</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_points</em><em>)</em><em>)</em>) – depth along probe or track where each point is located</p></li>
<li><p><strong>region_ids</strong> – brain region id at each depth along probe</p></li>
<li><p><strong>distance</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_points</em><em>)</em><em>)</em>) – distance to nearest boundary in plane at each point</p></li>
<li><p><strong>region_colours</strong> (<em>list</em><em> of </em><em>strings len</em><em>(</em><em>n_points</em><em>)</em>) – allen atlas hex colour for each region id</p></li>
</ul>
</dd>
<dt class="field-even">Return all_x<span class="colon">:</span></dt>
<dd class="field-even"><p>dist values for each region along probe track</p>
</dd>
<dt class="field-odd">Return all_y<span class="colon">:</span></dt>
<dd class="field-odd"><p>depth values for each region along probe track</p>
</dd>
<dt class="field-even">Return all_colour<span class="colon">:</span></dt>
<dd class="field-even"><p>colour assigned to each region along probe track</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_scale_factor">
<span class="sig-name descname"><span class="pre">get_scale_factor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">region</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region_orig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_scale_factor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_scale_factor" title="Link to this definition"></a></dt>
<dd><p>Find how much each brain region has been scaled following interpolation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>region</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_bound</em><em>, </em><em>2</em><em>)</em><em>) </em><em>n_bound: no.</em><em> of </em><em>histology boundaries</em>) – scaled histology boundaries</p>
</dd>
<dt class="field-even">Return scaled_region<span class="colon">:</span></dt>
<dd class="field-even"><p>regions that have unique scaling applied</p>
</dd>
<dt class="field-odd">Return scale_factor<span class="colon">:</span></dt>
<dd class="field-odd"><p>scale factor applied to each scaled region</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_channel_locations">
<span class="sig-name descname"><span class="pre">get_channel_locations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_channel_locations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_channel_locations" title="Link to this definition"></a></dt>
<dd><p>Gets 3d coordinates from a depth along the electrophysiology feature. 2 steps
1) interpolate from the electrophys features depths space to the probe depth space
2) interpolate from the probe depth space to the true 3D coordinates
if depths is not provided, defaults to channels local coordinates depths</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_brain_locations">
<span class="sig-name descname"><span class="pre">get_brain_locations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz_channels</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_brain_locations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_brain_locations" title="Link to this definition"></a></dt>
<dd><p>Finds the brain regions from 3D coordinates of electrode locations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>xyz_channels</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_elec</em><em>, </em><em>3</em><em>)</em><em>) </em><em>n_elec: no.</em><em> of </em><em>electrodes</em><em> (</em><em>384</em><em>)</em>) – 3D coordinates of electrodes on probe</p>
</dd>
<dt class="field-even">Return brain_regions<span class="colon">:</span></dt>
<dd class="field-even"><p>brain region object for each electrode</p>
</dd>
</dl>
<p>:type dict</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.pipes.ephys_alignment.EphysAlignment.get_perp_vector">
<span class="sig-name descname"><span class="pre">get_perp_vector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_perp_vector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_perp_vector" title="Link to this definition"></a></dt>
<dd><p>Finds the perpendicular vector along the trajectory at the depth of reference lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_lines + 2</em><em>)</em><em>) </em><em>n_lines: no.</em><em> of </em><em>user reference lines</em>) – reference coordinates in feature space (ephys plots)</p></li>
<li><p><strong>track</strong> (<em>np.array</em><em>(</em><em>(</em><em>n_line+2</em><em>)</em><em>)</em>) – reference coordinates in track space (histology track)</p></li>
</ul>
</dd>
<dt class="field-even">Return slice_lines<span class="colon">:</span></dt>
<dd class="field-even"><p>coordinates of perpendicular lines</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ibllib.pipes.dynamic_pipeline.html" class="btn btn-neutral float-left" title="ibllib.pipes.dynamic_pipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ibllib.pipes.ephys_preprocessing.html" class="btn btn-neutral float-right" title="ibllib.pipes.ephys_preprocessing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>