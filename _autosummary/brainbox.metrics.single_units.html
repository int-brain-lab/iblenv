<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>brainbox.metrics.single_units &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="brainbox.plot" href="brainbox.plot.html" />
    <link rel="prev" title="brainbox.metrics.electrode_drift" href="brainbox.metrics.electrode_drift.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataJoint</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_introduction.html">Introduction to DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_public.html">Publicly available IBL data via Datajoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_credentials.html">DataJoint credentials for internal IBL users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html#information-and-troubleshooting">Information and troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_intro/dj_intro.html">Datajoint Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_basics/dj_basics.html">Exploring the IBL Data Pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ibllib.html">ibllib</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="brainbox.html">brainbox</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="brainbox.atlas.html">brainbox.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.behavior.html">brainbox.behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.core.html">brainbox.core</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.ephys_plots.html">brainbox.ephys_plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.io.html">brainbox.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.lfp.html">brainbox.lfp</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="brainbox.metrics.html">brainbox.metrics</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="brainbox.metrics.electrode_drift.html">brainbox.metrics.electrode_drift</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">brainbox.metrics.single_units</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.plot.html">brainbox.plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.plot_base.html">brainbox.plot_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.population.html">brainbox.population</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.processing.html">brainbox.processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.quality.html">brainbox.quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.singlecell.html">brainbox.singlecell</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.spike_features.html">brainbox.spike_features</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.task.html">brainbox.task</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.tests.html">brainbox.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="brainbox.video.html">brainbox.video</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../010_api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="brainbox.html">brainbox</a></li>
          <li class="breadcrumb-item"><a href="brainbox.metrics.html">brainbox.metrics</a></li>
      <li class="breadcrumb-item active">brainbox.metrics.single_units</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/brainbox.metrics.single_units.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="module-brainbox.metrics.single_units">
<span id="brainbox-metrics-single-units"></span><h1>brainbox.metrics.single_units<a class="headerlink" href="#module-brainbox.metrics.single_units" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>Computes metrics for assessing quality of single units.</p>
<p>Run the following to set-up the workspace to run the docstring examples:
&gt;&gt;&gt; import brainbox as bb
&gt;&gt;&gt; import one.alf.io as aio
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; import matplotlib.pyplot as plt
&gt;&gt;&gt; import ibllib.ephys.spikes as e_spks
# (<a href="#id1"><span class="problematic" id="id2">*</span></a>Note, if there is no ‚Äòalf‚Äô directory, make ‚Äòalf‚Äô directory from ‚Äòks2‚Äô output directory):
&gt;&gt;&gt; e_spks.ks2_to_alf(path_to_ks_out, path_to_alf_out)
# Load the alf spikes bunch and clusters bunch, and get a units bunch.
&gt;&gt;&gt; spks_b = aio.load_object(path_to_alf_out, ‚Äòspikes‚Äô)
&gt;&gt;&gt; clstrs_b = aio.load_object(path_to_alf_out, ‚Äòclusters‚Äô)
&gt;&gt;&gt; units_b = bb.processing.get_units_bunch(spks_b)  # may take a few mins to compute</p>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.average_drift" title="brainbox.metrics.single_units.average_drift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">average_drift</span></code></a></p></td>
<td><p>Computes the cumulative drift (normalized by the total number of spikes) of a spike feature array.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.compute_labels" title="brainbox.metrics.single_units.compute_labels"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_labels</span></code></a></p></td>
<td><p>From a dataframe or a dictionary of unit metrics, compute a lablel</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.contamination" title="brainbox.metrics.single_units.contamination"><code class="xref py py-obj docutils literal notranslate"><span class="pre">contamination</span></code></a></p></td>
<td><p>An estimate of the contamination of the unit (i.e.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.contamination_alt" title="brainbox.metrics.single_units.contamination_alt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">contamination_alt</span></code></a></p></td>
<td><p>An estimate of the contamination of the unit (i.e.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.firing_rate_coeff_var" title="brainbox.metrics.single_units.firing_rate_coeff_var"><code class="xref py py-obj docutils literal notranslate"><span class="pre">firing_rate_coeff_var</span></code></a></p></td>
<td><p>Computes the coefficient of variation of the firing rate: the ratio of the standard deviation to the mean.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.firing_rate_fano_factor" title="brainbox.metrics.single_units.firing_rate_fano_factor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">firing_rate_fano_factor</span></code></a></p></td>
<td><p>Computes the fano factor of the firing rate: the ratio of the variance to the mean.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.missed_spikes_est" title="brainbox.metrics.single_units.missed_spikes_est"><code class="xref py py-obj docutils literal notranslate"><span class="pre">missed_spikes_est</span></code></a></p></td>
<td><p>Computes the approximate fraction of spikes missing from a spike feature distribution for a given unit, assuming the distribution is symmetric.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.noise_cutoff" title="brainbox.metrics.single_units.noise_cutoff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">noise_cutoff</span></code></a></p></td>
<td><p>A new metric to determine whether a unit's amplitude distribution is cut off (at floor), without assuming a Gaussian distribution.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.pres_ratio" title="brainbox.metrics.single_units.pres_ratio"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pres_ratio</span></code></a></p></td>
<td><p>Computes the presence ratio of spike counts: the number of bins where there is at least one spike, over the total number of bins, given a specified bin width.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.ptp_over_noise" title="brainbox.metrics.single_units.ptp_over_noise"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ptp_over_noise</span></code></a></p></td>
<td><p>For specified channels, for specified timestamps, computes the mean (peak-to-peak amplitudes / the MADs of the background noise).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.quick_unit_metrics" title="brainbox.metrics.single_units.quick_unit_metrics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">quick_unit_metrics</span></code></a></p></td>
<td><p>Computes single unit metrics from only the spike times, amplitudes, and depths for a set of units.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.slidingRP_viol" title="brainbox.metrics.single_units.slidingRP_viol"><code class="xref py py-obj docutils literal notranslate"><span class="pre">slidingRP_viol</span></code></a></p></td>
<td><p>A binary metric which determines whether there is an acceptable level of refractory period violations by using a sliding refractory period:</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.spike_sorting_metrics" title="brainbox.metrics.single_units.spike_sorting_metrics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spike_sorting_metrics</span></code></a></p></td>
<td><p>Computes: -   cell level metrics (cf quick_unit_metrics) -   label the metrics according to quality thresholds -   estimates drift as a function of time</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.unit_stability" title="brainbox.metrics.single_units.unit_stability"><code class="xref py py-obj docutils literal notranslate"><span class="pre">unit_stability</span></code></a></p></td>
<td><p>Computes the probability that the empirical spike feature distribution(s), for specified feature(s), for all units, comes from a specific theoretical distribution, based on a specified statistical test.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#brainbox.metrics.single_units.wf_similarity" title="brainbox.metrics.single_units.wf_similarity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">wf_similarity</span></code></a></p></td>
<td><p>Computes a unit normalized spatiotemporal similarity score between two sets of waveforms.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.unit_stability">
<span class="sig-name descname"><span class="pre">unit_stability</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">units_b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feat_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['amps']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'norm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ks'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#unit_stability"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.unit_stability" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes the probability that the empirical spike feature distribution(s), for specified
feature(s), for all units, comes from a specific theoretical distribution, based on a specified
statistical test. Also computes the coefficients of variation of the spike feature(s) for all
units.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>units_b</strong> (<em>bunch</em>) ‚Äì A units bunch containing fields with spike information (e.g. cluster IDs, times, features,
etc.) for all units.</p></li>
<li><p><strong>units</strong> (<em>array-like</em><em> (</em><em>optional</em><em>)</em>) ‚Äì A subset of all units for which to create the bar plot. (If <cite>None</cite>, all units are used)</p></li>
<li><p><strong>feat_names</strong> (<em>list</em><em> of </em><em>strings</em><em> (</em><em>optional</em><em>)</em>) ‚Äì A list of names of spike features that can be found in <cite>spks</cite> to specify which features to
use for calculating unit stability.</p></li>
<li><p><strong>dist</strong> (<em>string</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The type of hypothetical null distribution for which the empirical spike feature
distributions are presumed to belong to.</p></li>
<li><p><strong>test</strong> (<em>string</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The statistical test used to compute the probability that the empirical spike feature
distributions come from <cite>dist</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>p_vals_b</strong> (<em>bunch</em>) ‚Äì A bunch with <cite>feat_names</cite> as keys, containing a ndarray with p-values (the probabilities
that the empirical spike feature distribution for each unit comes from <cite>dist</cite> based on
<cite>test</cite>) for each unit for all <cite>feat_names</cite>.</p></li>
<li><p><strong>cv_b</strong> (<em>bunch</em>) ‚Äì A bunch with <cite>feat_names</cite> as keys, containing a ndarray with the coefficients of variation
of each unit‚Äôs empirical spike feature distribution for all features.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot.feat_vars</span></code></p>
</div>
<p class="rubric">Examples</p>
<p>1) Compute 1) the p-values obtained from running a one-sample ks test on the spike amplitudes
for each unit, and 2) the variances of the empirical spike amplitudes distribution for each
unit. Create a histogram of the variances of the spike amplitudes for each unit, color-coded by
depth of channel of max amplitudes. Get cluster IDs of those units which have variances greater
than 50.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p_vals_b</span><span class="p">,</span> <span class="n">variances_b</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">unit_stability</span><span class="p">(</span><span class="n">units_b</span><span class="p">)</span>
<span class="go"># Plot histograms of variances color-coded by depth of channel of max amplitudes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">feat_vars</span><span class="p">(</span><span class="n">units_b</span><span class="p">,</span> <span class="n">feat_name</span><span class="o">=</span><span class="s1">&#39;amps&#39;</span><span class="p">)</span>
<span class="go"># Get all unit IDs which have amps variance &gt; 50</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">variances_b</span><span class="p">[</span><span class="s1">&#39;amps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bad_units</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">var_vals</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.missed_spikes_est">
<span class="sig-name descname"><span class="pre">missed_spikes_est</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spks_per_bin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_num_bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#missed_spikes_est"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.missed_spikes_est" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes the approximate fraction of spikes missing from a spike feature distribution for a
given unit, assuming the distribution is symmetric.
Inspired by metric described in Hill et al. (2011) J Neurosci 31: 8699-8705.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feat</strong> (<em>ndarray</em>) ‚Äì The spikes‚Äô feature values (e.g. amplitudes)</p></li>
<li><p><strong>spks_per_bin</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The number of spikes per bin from which to compute the spike feature histogram.</p></li>
<li><p><strong>sigma</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The standard deviation for the gaussian kernel used to compute the pdf from the spike
feature histogram.</p></li>
<li><p><strong>min_num_bins</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The minimum number of bins used to compute the spike feature histogram.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>fraction_missing</strong> (<em>float</em>) ‚Äì The fraction of missing spikes (0-0.5). <a href="#id3"><span class="problematic" id="id4">*</span></a>Note: If more than 50% of spikes are missing, an
accurate estimate isn‚Äôt possible.</p></li>
<li><p><strong>pdf</strong> (<em>ndarray</em>) ‚Äì The computed pdf of the spike feature histogram.</p></li>
<li><p><strong>cutoff_idx</strong> (<em>int</em>) ‚Äì The index for <cite>pdf</cite> at which point <cite>pdf</cite> is no longer symmetrical around the peak. (This
is returned for plotting purposes).</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot.feat_cutoff</span></code></p>
</div>
<p class="rubric">Examples</p>
<p>1) Determine the fraction of spikes missing from unit 1 based on the recorded unit‚Äôs spike
amplitudes, assuming the distribution of the unit‚Äôs spike amplitudes is symmetric.</p>
<blockquote>
<div><p># Get unit 1 amplitudes from a unit bunch, and compute fraction spikes missing.
&gt;&gt;&gt; feat = units_b[‚Äòamps‚Äô][‚Äò1‚Äô]
&gt;&gt;&gt; fraction_missing = bb.plot.feat_cutoff(feat)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.wf_similarity">
<span class="sig-name descname"><span class="pre">wf_similarity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wf1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wf2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#wf_similarity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.wf_similarity" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes a unit normalized spatiotemporal similarity score between two sets of waveforms.
This score is based on how waveform shape correlates for each pair of spikes between the
two sets of waveforms across space and time. The shapes of the arrays of the two sets of
waveforms must be equal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wf1</strong> (<em>ndarray</em>) ‚Äì An array of shape (#spikes, #samples, #channels).</p></li>
<li><p><strong>wf2</strong> (<em>ndarray</em>) ‚Äì An array of shape (#spikes, #samples, #channels).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>s</strong> ‚Äì The unit normalized spatiotemporal similarity score.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">io.extract_waveforms</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">plot.single_unit_wf_comp</span></code></p>
</div>
<p class="rubric">Examples</p>
<p>1) Compute the similarity between the first and last 100 waveforms for unit1, across the 20
channels around the channel of max amplitude.</p>
<blockquote>
<div><p># Get the channels around the max amp channel for the unit, two sets of timestamps for the
# unit, and the two corresponding sets of waveforms for those two sets of timestamps.
# Then compute <cite>s</cite>.
&gt;&gt;&gt; max_ch = clstrs_b[‚Äòchannels‚Äô][1]
&gt;&gt;&gt; if max_ch &lt; 10:  # take only channels greater than <cite>max_ch</cite>.
&gt;&gt;&gt;     ch = np.arange(max_ch, max_ch + 20)
&gt;&gt;&gt; elif (max_ch + 10) &gt; 385:  # take only channels less than <cite>max_ch</cite>.
&gt;&gt;&gt;    ch = np.arange(max_ch - 20, max_ch)
&gt;&gt;&gt; else:  # take <cite>n_c_ch</cite> around <cite>max_ch</cite>.
&gt;&gt;&gt;     ch = np.arange(max_ch - 10, max_ch + 10)
&gt;&gt;&gt; ts1 = units_b[‚Äòtimes‚Äô][‚Äò1‚Äô][:100]
&gt;&gt;&gt; ts2 = units_b[‚Äòtimes‚Äô][‚Äò1‚Äô][-100:]
&gt;&gt;&gt; wf1 = bb.io.extract_waveforms(path_to_ephys_file, ts1, ch)
&gt;&gt;&gt; wf2 = bb.io.extract_waveforms(path_to_ephys_file, ts2, ch)
&gt;&gt;&gt; s = bb.metrics.wf_similarity(wf1, wf2)</p>
</div></blockquote>
<p>TODO check <cite>s</cite> calculation:
take median of waveforms
xcorr all waveforms with median, and divide by autocorr of all waveforms
profile
for two sets of units: xcorr(cl1, cl2) / (sqrt autocorr(cl1) * autocorr(cl2))</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.firing_rate_coeff_var">
<span class="sig-name descname"><span class="pre">firing_rate_coeff_var</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_win</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fr_win</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#firing_rate_coeff_var"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.firing_rate_coeff_var" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes the coefficient of variation of the firing rate: the ratio of the standard
deviation to the mean.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>ndarray</em>) ‚Äì The spike timestamps from which to compute the firing rate.</p></li>
<li><p><strong>hist_win</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The time window (in s) to use for computing spike counts.</p></li>
<li><p><strong>fr_win</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The time window (in s) to use as a moving slider to compute the instantaneous firing rate.</p></li>
<li><p><strong>n_bins</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The number of bins in which to compute a coefficient of variation of the firing rate.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>cv</strong> (<em>float</em>) ‚Äì The mean coefficient of variation of the firing rate of the <cite>n_bins</cite> number of coefficients
computed.</p></li>
<li><p><strong>cvs</strong> (<em>ndarray</em>) ‚Äì The coefficients of variation of the firing for each bin of <cite>n_bins</cite>.</p></li>
<li><p><strong>fr</strong> (<em>ndarray</em>) ‚Äì The instantaneous firing rate over time (in hz).</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">singlecell.firing_rate</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">plot.firing_rate</span></code></p>
</div>
<p class="rubric">Examples</p>
<p>1) Compute the coefficient of variation of the firing rate for unit 1 from the time of its
first to last spike, and compute the coefficient of variation of the firing rate for unit 2
from the first to second minute.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts_1</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts_2</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ts_2</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ts_2</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">fr</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">firing_rate_coeff_var</span><span class="p">(</span><span class="n">ts_1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv_2</span><span class="p">,</span> <span class="n">cvs_2</span><span class="p">,</span> <span class="n">fr_2</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">firing_rate_coeff_var</span><span class="p">(</span><span class="n">ts_2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.firing_rate_fano_factor">
<span class="sig-name descname"><span class="pre">firing_rate_fano_factor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_win</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fr_win</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#firing_rate_fano_factor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.firing_rate_fano_factor" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes the fano factor of the firing rate: the ratio of the variance to the mean.
(Almost identical to coeff. of variation)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>ndarray</em>) ‚Äì The spike timestamps from which to compute the firing rate.</p></li>
<li><p><strong>hist_win</strong> (<em>float</em>) ‚Äì The time window (in s) to use for computing spike counts.</p></li>
<li><p><strong>fr_win</strong> (<em>float</em>) ‚Äì The time window (in s) to use as a moving slider to compute the instantaneous firing rate.</p></li>
<li><p><strong>n_bins</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The number of bins in which to compute a fano factor of the firing rate.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>ff</strong> (<em>float</em>) ‚Äì The mean fano factor of the firing rate of the <cite>n_bins</cite> number of factors
computed.</p></li>
<li><p><strong>ffs</strong> (<em>ndarray</em>) ‚Äì The fano factors of the firing for each bin of <cite>n_bins</cite>.</p></li>
<li><p><strong>fr</strong> (<em>ndarray</em>) ‚Äì The instantaneous firing rate over time (in hz).</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">singlecell.firing_rate</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">plot.firing_rate</span></code></p>
</div>
<p class="rubric">Examples</p>
<p>1) Compute the fano factor of the firing rate for unit 1 from the time of its
first to last spike, and compute the fano factor of the firing rate for unit 2
from the first to second minute.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts_1</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts_2</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ts_2</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ts_2</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ff</span><span class="p">,</span> <span class="n">ffs</span><span class="p">,</span> <span class="n">fr</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">firing_rate_fano_factor</span><span class="p">(</span><span class="n">ts_1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ff_2</span><span class="p">,</span> <span class="n">ffs_2</span><span class="p">,</span> <span class="n">fr_2</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">firing_rate_fano_factor</span><span class="p">(</span><span class="n">ts_2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.average_drift">
<span class="sig-name descname"><span class="pre">average_drift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">times</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#average_drift"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.average_drift" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes the cumulative drift (normalized by the total number of spikes) of a spike feature
array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>feat</strong> (<em>ndarray</em>) ‚Äì The spike feature values from which to compute the maximum drift.
Usually amplitudes</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>cd</strong> ‚Äì The cumulative drift of the unit.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">max_drift</span></code></p>
</div>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><dl>
<dt>Get the cumulative depth drift for unit 1.</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unit_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spks_b</span><span class="p">[</span><span class="s1">&#39;clusters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depths</span> <span class="o">=</span> <span class="n">spks_b</span><span class="p">[</span><span class="s1">&#39;depths&#39;</span><span class="p">][</span><span class="n">unit_idxs</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amps</span> <span class="o">=</span> <span class="n">spks_b</span><span class="p">[</span><span class="s1">&#39;amps&#39;</span><span class="p">][</span><span class="n">unit_idxs</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depth_cd</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cum_drift</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amp_cd</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cum_drift</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.pres_ratio">
<span class="sig-name descname"><span class="pre">pres_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hist_win</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#pres_ratio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.pres_ratio" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes the presence ratio of spike counts: the number of bins where there is at least one
spike, over the total number of bins, given a specified bin width.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>ndarray</em>) ‚Äì The spike timestamps from which to compute the presence ratio.</p></li>
<li><p><strong>hist_win</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The time window (in s) to use for computing the presence ratio.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>pr</strong> (<em>float</em>) ‚Äì The presence ratio.</p></li>
<li><p><strong>spks_bins</strong> (<em>ndarray</em>) ‚Äì The number of spks in each bin.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot.pres_ratio</span></code></p>
</div>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><dl>
<dt>Compute the presence ratio for unit 1, given a window of 10 s.</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span><span class="p">,</span> <span class="n">pr_bins</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">pres_ratio</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.ptp_over_noise">
<span class="sig-name descname"><span class="pre">ptp_over_noise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ephys_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_ch_probe</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">385</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">car</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#ptp_over_noise"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.ptp_over_noise" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>For specified channels, for specified timestamps, computes the mean (peak-to-peak amplitudes /
the MADs of the background noise).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ephys_file</strong> (<em>string</em>) ‚Äì The file path to the binary ephys data.</p></li>
<li><p><strong>ts</strong> (<em>ndarray_like</em>) ‚Äì The timestamps (in s) of the spikes.</p></li>
<li><p><strong>ch</strong> (<em>ndarray_like</em>) ‚Äì The channels on which to extract the waveforms.</p></li>
<li><p><strong>t</strong> (<em>numeric</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The time (in ms) of the waveforms to extract to compute the ptp.</p></li>
<li><p><strong>sr</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The sampling rate (in hz) that the ephys data was acquired at.</p></li>
<li><p><strong>n_ch_probe</strong> (<em>int</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The number of channels of the recording.</p></li>
<li><p><strong>car</strong> (<em>bool</em><em> (</em><em>optional</em><em>)</em>) ‚Äì A flag to perform common-average-referencing before extracting waveforms.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ptp_sigma</strong> ‚Äì An array containing the mean ptp_over_noise values for the specified <cite>ts</cite> and <cite>ch</cite>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>1) Compute ptp_over_noise for all spikes on 20 channels around the channel of max amplitude
for unit 1.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_ch</span> <span class="o">=</span> <span class="n">max_ch</span> <span class="o">=</span> <span class="n">clstrs_b</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">max_ch</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># take only channels greater than `max_ch`.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_ch</span><span class="p">,</span> <span class="n">max_ch</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">elif</span> <span class="p">(</span><span class="n">max_ch</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">385</span><span class="p">:</span>  <span class="c1"># take only channels less than `max_ch`.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_ch</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="n">max_ch</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">else</span><span class="p">:</span>  <span class="c1"># take `n_c_ch` around `max_ch`.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_ch</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">max_ch</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">ptp_over_noise</span><span class="p">(</span><span class="n">ephys_file</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.contamination_alt">
<span class="sig-name descname"><span class="pre">contamination_alt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.002</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#contamination_alt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.contamination_alt" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>An estimate of the contamination of the unit (i.e. a pseudo false positive measure) based on
the number of spikes, number of isi violations, and time between the first and last spike.
(see Hill et al. (2011) J Neurosci 31: 8699-8705).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>ndarray_like</em>) ‚Äì The timestamps (in s) of the spikes.</p></li>
<li><p><strong>rp</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The refractory period (in s).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ce</strong> ‚Äì An estimate of the fraction of contamination.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#brainbox.metrics.single_units.contamination_alt" title="brainbox.metrics.single_units.contamination_alt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">contamination_alt</span></code></a></p>
</div>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><dl>
<dt>Compute contamination estimate for unit 1.</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ce</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">contamination</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.contamination">
<span class="sig-name descname"><span class="pre">contamination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.002</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_isi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#contamination"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.contamination" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>An estimate of the contamination of the unit (i.e. a pseudo false positive measure) based on
the number of spikes, number of isi violations, and time between the first and last spike.
(see Hill et al. (2011) J Neurosci 31: 8699-8705).</p>
<p>Modified by Dan Denman from cortex-lab/sortingQuality GitHub by Nick Steinmetz.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>ndarray_like</em>) ‚Äì The timestamps (in s) of the spikes.</p></li>
<li><p><strong>min_time</strong> (<em>float</em>) ‚Äì The minimum time (in s) that a potential spike occurred.</p></li>
<li><p><strong>max_time</strong> (<em>float</em>) ‚Äì The maximum time (in s) that a potential spike occurred.</p></li>
<li><p><strong>rp</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The refractory period (in s).</p></li>
<li><p><strong>min_isi</strong> (<em>float</em><em> (</em><em>optional</em><em>)</em>) ‚Äì The minimum interspike-interval (in s) for counting duplicate spikes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>ce</strong> (<em>float</em>) ‚Äì An estimate of the contamination.
A perfect unit has a ce = 0
A unit with some contamination has a ce &lt; 0.5
A unit with lots of contamination has a ce &gt; 1.0</p></li>
<li><p><strong>num_violations</strong> (<em>int</em>) ‚Äì The total number of isi violations.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#brainbox.metrics.single_units.contamination" title="brainbox.metrics.single_units.contamination"><code class="xref py py-obj docutils literal notranslate"><span class="pre">contamination</span></code></a></p>
</div>
<p class="rubric">Examples</p>
<p>1) Compute contamination estimate for unit 1, with a minimum isi for counting duplicate
spikes of 0.1 ms.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ce</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">contamination_alt</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">min_isi</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.slidingRP_viol">
<span class="sig-name descname"><span class="pre">slidingRP_viol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bin_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">acceptThresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#slidingRP_viol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.slidingRP_viol" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>A binary metric which determines whether there is an acceptable level of
refractory period violations by using a sliding refractory period:</p>
<p>This takes into account the firing rate of the neuron and computes a
maximum acceptable level of contamination at different possible values of
the refractory period. If the unit has less than the maximum contamination
at any of the possible values of the refractory period, the unit passes.</p>
<p>A neuron will always fail this metric for very low firing rates, and thus
this metric takes into account both firing rate and refractory period
violations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>ndarray_like</em>) ‚Äì The timestamps (in s) of the spikes.</p></li>
<li><p><strong>bin_size</strong> (<em>float</em>) ‚Äì The size of binning for the autocorrelogram.</p></li>
<li><p><strong>thresh</strong> (<em>float</em>) ‚Äì <dl class="simple">
<dt>Spike rate used to generate poisson distribution (to compute maximum</dt><dd><p>acceptable contamination, see _max_acceptable_cont)</p>
</dd>
</dl>
</p></li>
<li><p><strong>acceptThresh</strong> (<em>float</em>) ‚Äì <dl class="simple">
<dt>The fraction of contamination we are willing to accept (default value</dt><dd><p>set to 0.1, or 10% contamination)</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>didpass</strong> ‚Äì 0 if unit didn‚Äôt pass
1 if unit did pass</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#brainbox.metrics.single_units.contamination" title="brainbox.metrics.single_units.contamination"><code class="xref py py-obj docutils literal notranslate"><span class="pre">contamination</span></code></a></p>
</div>
<p class="rubric">Examples</p>
<p>1) Compute whether a unit has too much refractory period contamination at
any possible value of a refractory period, for a 0.25 ms bin, with a
threshold of 10% acceptable contamination</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">units_b</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">didpass</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">slidingRP_viol</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="go">                                        acceptThresh=0.1)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.noise_cutoff">
<span class="sig-name descname"><span class="pre">noise_cutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">amps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantile_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nc_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#noise_cutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.noise_cutoff" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>A new metric to determine whether a unit‚Äôs amplitude distribution is cut off
(at floor), without assuming a Gaussian distribution.
This metric takes the amplitude distribution, computes the mean and std
of an upper quartile of the distribution, and determines how many standard
deviations away from that mean a lower quartile lies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>amps</strong> (<em>ndarray_like</em>) ‚Äì The amplitudes (in uV) of the spikes.</p></li>
<li><p><strong>quantile_length</strong> (<em>float</em>) ‚Äì The size of the upper quartile of the amplitude distribution.</p></li>
<li><p><strong>n_bins</strong> (<em>int</em>) ‚Äì The number of bins used to compute a histogram of the amplitude
distribution.</p></li>
<li><p><strong>n_low_bins</strong> (<em>int</em>) ‚Äì <dl class="simple">
<dt>The number of bins used in the lower part of the distribution (where</dt><dd><p>cutoff is determined).</p>
</dd>
<dt>nc_threshold: float</dt><dd><p>the noise cutoff result has to be lower than this for a neuron to fail</p>
</dd>
</dl>
</p></li>
<li><p><strong>percent_threshold</strong> (<em>float</em>) ‚Äì the first bin has to be greater than percent_threshold for neuron the to fail</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>cutoff</strong> ‚Äì Number of standard deviations that the lower mean is outside of the
mean of the upper quartile.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#brainbox.metrics.single_units.missed_spikes_est" title="brainbox.metrics.single_units.missed_spikes_est"><code class="xref py py-obj docutils literal notranslate"><span class="pre">missed_spikes_est</span></code></a></p>
</div>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><dl>
<dt>Compute whether a unit‚Äôs amplitude distribution is cut off</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">amps</span> <span class="o">=</span> <span class="n">spks_b</span><span class="p">[</span><span class="s1">&#39;amps&#39;</span><span class="p">][</span><span class="n">unit_idxs</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">noise_cutoff</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="n">quantile_length</span><span class="o">=</span><span class="mf">.25</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.spike_sorting_metrics">
<span class="sig-name descname"><span class="pre">spike_sorting_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">times</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'RPslide_thresh':</span> <span class="pre">0.1,</span> <span class="pre">'acceptable_contamination':</span> <span class="pre">0.1,</span> <span class="pre">'bin_size':</span> <span class="pre">0.25,</span> <span class="pre">'med_amp_thresh_uv':</span> <span class="pre">50,</span> <span class="pre">'min_isi':</span> <span class="pre">0.0001,</span> <span class="pre">'missed_spikes_est':</span> <span class="pre">{'min_num_bins':</span> <span class="pre">50,</span> <span class="pre">'sigma':</span> <span class="pre">4,</span> <span class="pre">'spks_per_bin':</span> <span class="pre">10},</span> <span class="pre">'noise_cutoff':</span> <span class="pre">{'n_bins':</span> <span class="pre">100,</span> <span class="pre">'nc_threshold':</span> <span class="pre">5,</span> <span class="pre">'percent_threshold':</span> <span class="pre">0.1,</span> <span class="pre">'quantile_length':</span> <span class="pre">0.25},</span> <span class="pre">'presence_window':</span> <span class="pre">10,</span> <span class="pre">'refractory_period':</span> <span class="pre">0.0015}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#spike_sorting_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.spike_sorting_metrics" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes:
-   cell level metrics (cf quick_unit_metrics)
-   label the metrics according to quality thresholds
-   estimates drift as a function of time</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>times</strong> ‚Äì vector of spike times</p></li>
<li><p><strong>clusters</strong> ‚Äì </p></li>
<li><p><strong>amplitudes</strong> ‚Äì </p></li>
<li><p><strong>depths</strong> ‚Äì </p></li>
<li><p><strong>(</strong><strong>optional</strong><strong>)</strong> (<em>cluster_ids</em>) ‚Äì set of clusters (if None the output datgrame will match
the unique set of clusters represented in spike clusters)</p></li>
<li><p><strong>params</strong> ‚Äì dict (optional) parameters for qc computation (
see constant at the top of the module for default values and keys)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>data_frame of metrics (cluster records, columns are qc attributes)|</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dictionary of recording qc (keys ‚Äòtime_scale‚Äô and ‚Äòdrift_um‚Äô)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.quick_unit_metrics">
<span class="sig-name descname"><span class="pre">quick_unit_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spike_clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spike_times</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spike_amps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spike_depths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'RPslide_thresh':</span> <span class="pre">0.1,</span> <span class="pre">'acceptable_contamination':</span> <span class="pre">0.1,</span> <span class="pre">'bin_size':</span> <span class="pre">0.25,</span> <span class="pre">'med_amp_thresh_uv':</span> <span class="pre">50,</span> <span class="pre">'min_isi':</span> <span class="pre">0.0001,</span> <span class="pre">'missed_spikes_est':</span> <span class="pre">{'min_num_bins':</span> <span class="pre">50,</span> <span class="pre">'sigma':</span> <span class="pre">4,</span> <span class="pre">'spks_per_bin':</span> <span class="pre">10},</span> <span class="pre">'noise_cutoff':</span> <span class="pre">{'n_bins':</span> <span class="pre">100,</span> <span class="pre">'nc_threshold':</span> <span class="pre">5,</span> <span class="pre">'percent_threshold':</span> <span class="pre">0.1,</span> <span class="pre">'quantile_length':</span> <span class="pre">0.25},</span> <span class="pre">'presence_window':</span> <span class="pre">10,</span> <span class="pre">'refractory_period':</span> <span class="pre">0.0015}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbounds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#quick_unit_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.quick_unit_metrics" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>Computes single unit metrics from only the spike times, amplitudes, and
depths for a set of units.</p>
<dl class="simple">
<dt>Metrics computed:</dt><dd><p>‚Äòamp_max‚Äô,
‚Äòamp_min‚Äô,
‚Äòamp_median‚Äô,
‚Äòamp_std_dB‚Äô,
‚Äòcontamination‚Äô,
‚Äòcontamination_alt‚Äô,
‚Äòdrift‚Äô,
‚Äòmissed_spikes_est‚Äô,
‚Äònoise_cutoff‚Äô,
‚Äòpresence_ratio‚Äô,
‚Äòpresence_ratio_std‚Äô,
‚ÄòslidingRP_viol‚Äô,
‚Äòspike_count‚Äô</p>
</dd>
</dl>
<section id="parameters-see-the-metrics-params-constant">
<h2>Parameters (see the METRICS_PARAMS constant)<a class="headerlink" href="#parameters-see-the-metrics-params-constant" title="Permalink to this heading">ÔÉÅ</a></h2>
<dl class="simple">
<dt>spike_clusters<span class="classifier">ndarray_like</span></dt><dd><p>A vector of the unit ids for a set of spikes.</p>
</dd>
<dt>spike_times<span class="classifier">ndarray_like</span></dt><dd><p>A vector of the timestamps for a set of spikes.</p>
</dd>
<dt>spike_amps<span class="classifier">ndarray_like</span></dt><dd><p>A vector of the amplitudes for a set of spikes.</p>
</dd>
<dt>spike_depths<span class="classifier">ndarray_like</span></dt><dd><p>A vector of the depths for a set of spikes.</p>
</dd>
</dl>
<p>clusters_id: (optional) lists of cluster ids. If not all clusters are represented in the
spikes_clusters (ie. cluster has no spike), this will ensure the output size is consistent
with the input arrays.
tbounds: (optional) list or 2 elements array containing a time-selection to perform the</p>
<blockquote>
<div><p>metrics computation on.</p>
</div></blockquote>
<dl class="simple">
<dt>params<span class="classifier">dict (optional)</span></dt><dd><dl class="simple">
<dt>Parameters used for computing some of the metrics in the function:</dt><dd><dl class="simple">
<dt>‚Äòpresence_window‚Äô: float</dt><dd><p>The time window (in s) used to look for spikes when computing the presence ratio.</p>
</dd>
<dt>‚Äòrefractory_period‚Äô: float</dt><dd><p>The refractory period used when computing isi violations and the contamination
estimate.</p>
</dd>
<dt>‚Äòmin_isi‚Äô: float</dt><dd><p>The minimum interspike-interval (in s) for counting duplicate spikes when computing
the contamination estimate.</p>
</dd>
<dt>‚Äòspks_per_bin_for_missed_spks_est‚Äô: int</dt><dd><p>The number of spikes per bin used to compute the spike amplitude pdf for a unit,
when computing the missed spikes estimate.</p>
</dd>
<dt>‚Äòstd_smoothing_kernel_for_missed_spks_est‚Äô: float</dt><dd><p>The standard deviation for the gaussian kernel used to compute the spike amplitude
pdf for a unit, when computing the missed spikes estimate.</p>
</dd>
<dt>‚Äòmin_num_bins_for_missed_spks_est‚Äô: int</dt><dd><p>The minimum number of bins used to compute the spike amplitude pdf for a unit,
when computing the missed spikes estimate.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">returns</dt>
<dd class="field-odd"><p><strong>r</strong> ‚Äì A bunch whose keys are the computed spike metrics.</p>
</dd>
<dt class="field-even">rtype</dt>
<dd class="field-even"><p>bunch</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function is called by <cite>ephysqc.unit_metrics_ks2</cite> which is called by <cite>spikes.ks2_to_alf</cite>
during alf extraction of an ephys dataset in the ibl ephys extraction pipeline.</p>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><dl>
<dt>Compute quick metrics from a ks2 output directory:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ibllib.ephys.ephysqc</span> <span class="kn">import</span> <span class="n">phy_model_from_ks2_path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">phy_model_from_ks2_path</span><span class="p">(</span><span class="n">path_to_ks2_out</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cluster_ids</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">spike_clusters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">spike_times</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amps</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">amplitudes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depths</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">depths</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">quick_unit_metrics</span><span class="p">(</span><span class="n">cluster_ids</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">depths</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="brainbox.metrics.single_units.compute_labels">
<span class="sig-name descname"><span class="pre">compute_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'RPslide_thresh':</span> <span class="pre">0.1,</span> <span class="pre">'acceptable_contamination':</span> <span class="pre">0.1,</span> <span class="pre">'bin_size':</span> <span class="pre">0.25,</span> <span class="pre">'med_amp_thresh_uv':</span> <span class="pre">50,</span> <span class="pre">'min_isi':</span> <span class="pre">0.0001,</span> <span class="pre">'missed_spikes_est':</span> <span class="pre">{'min_num_bins':</span> <span class="pre">50,</span> <span class="pre">'sigma':</span> <span class="pre">4,</span> <span class="pre">'spks_per_bin':</span> <span class="pre">10},</span> <span class="pre">'noise_cutoff':</span> <span class="pre">{'n_bins':</span> <span class="pre">100,</span> <span class="pre">'nc_threshold':</span> <span class="pre">5,</span> <span class="pre">'percent_threshold':</span> <span class="pre">0.1,</span> <span class="pre">'quantile_length':</span> <span class="pre">0.25},</span> <span class="pre">'presence_window':</span> <span class="pre">10,</span> <span class="pre">'refractory_period':</span> <span class="pre">0.0015}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_details</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/brainbox/metrics/single_units.html#compute_labels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#brainbox.metrics.single_units.compute_labels" title="Permalink to this definition">ÔÉÅ</a></dt>
<dd><p>From a dataframe or a dictionary of unit metrics, compute a lablel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> ‚Äì dictionary or pandas dataframe containing unit qcs</p></li>
<li><p><strong>return_details</strong> ‚Äì False (returns a full dictionary of metrics)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>vector of proportion of qcs passed between 0 and 1, where 1 denotes an all pass</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="brainbox.metrics.electrode_drift.html" class="btn btn-neutral float-left" title="brainbox.metrics.electrode_drift" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="brainbox.plot.html" class="btn btn-neutral float-right" title="brainbox.plot" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>