<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ibllib.io.extractors.ephys_fpga &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=17142d56" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS" href="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS.html" />
    <link rel="prev" title="ibllib.io.extractors.default_channel_maps" href="ibllib.io.extractors.default_channel_maps.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_repro_ephys.html">Data Release - Reproducible Ephys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_download.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_download.html#Explore-and-download-data-using-the-ONE-api">Explore and download data using the ONE-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_screen_stimulus.html">Computing the stimulus position using the wheel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ibllib.html">ibllib</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ibllib.atlas.html">ibllib.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.ephys.html">ibllib.ephys</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.exceptions.html">ibllib.exceptions</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="ibllib.io.html">ibllib.io</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="ibllib.io.extractors.html">ibllib.io.extractors</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.ffmpeg.html">ibllib.io.ffmpeg</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.flags.html">ibllib.io.flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.misc.html">ibllib.io.misc</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.npy_header.html">ibllib.io.npy_header</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.raw_daq_loaders.html">ibllib.io.raw_daq_loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.raw_data_loaders.html">ibllib.io.raw_data_loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.session_params.html">ibllib.io.session_params</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.video.html">ibllib.io.video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.misc.html">ibllib.misc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.oneibl.html">ibllib.oneibl</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.pipes.html">ibllib.pipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.plots.html">ibllib.plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.qc.html">ibllib.qc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.tests.html">ibllib.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.time.html">ibllib.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="brainbox.html">brainbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="iblatlas.html">iblatlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="iblutil.html">iblutil</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../010_api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="ibllib.html">ibllib</a></li>
          <li class="breadcrumb-item"><a href="ibllib.io.html">ibllib.io</a></li>
          <li class="breadcrumb-item"><a href="ibllib.io.extractors.html">ibllib.io.extractors</a></li>
      <li class="breadcrumb-item active">ibllib.io.extractors.ephys_fpga</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/ibllib.io.extractors.ephys_fpga.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ibllib.io.extractors.ephys_fpga">
<span id="ibllib-io-extractors-ephys-fpga"></span><h1>ibllib.io.extractors.ephys_fpga<a class="headerlink" href="#module-ibllib.io.extractors.ephys_fpga" title="Link to this heading"></a></h1>
<p>Data extraction from raw FPGA output.</p>
<p>The behaviour extraction happens in the following stages:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The NI DAQ events are extracted into a map of event times and TTL polarities.</p></li>
<li><p>The Bpod trial events are extracted from the raw Bpod data, depending on the task protocol.</p></li>
<li><p>As protocols may be chained together within a given recording, the period of a given task
protocol is determined using the ‘spacer’ DAQ signal (see <cite>get_protocol_period</cite>).</p></li>
<li><p>Physical behaviour events such as stim on and reward time are separated out by TTL length or
sequence within the trial.</p></li>
<li><p>The Bpod clock is sync’d with the FPGA using one of the extracted trial events.</p></li>
<li><p>The Bpod software events are then converted to FPGA time.</p></li>
</ol>
</div></blockquote>
<p class="rubric">Examples</p>
<p>For simple extraction, use the FPGATrials class:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">extractor</span> <span class="o">=</span> <span class="n">FpgaTrials</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trials</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>Sync extraction in this module only supports FPGA data acquired with an NI DAQ as part of a
Neuropixels recording system, however a sync and channel map extracted from a different DAQ format
can be passed to the FpgaTrials class.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">For</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">TODO</span></code></p>
</div>
<p class="rubric">Module attributes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS.html#ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS" title="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SYNC_BATCH_SIZE_SECS</span></code></a></p></td>
<td><p>Number of samples to read at once in bin file for sync.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="ibllib.io.extractors.ephys_fpga.WHEEL_RADIUS_CM.html#ibllib.io.extractors.ephys_fpga.WHEEL_RADIUS_CM" title="ibllib.io.extractors.ephys_fpga.WHEEL_RADIUS_CM"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WHEEL_RADIUS_CM</span></code></a></p></td>
<td><p>The radius of the wheel used in the task.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="ibllib.io.extractors.ephys_fpga.WHEEL_TICKS.html#ibllib.io.extractors.ephys_fpga.WHEEL_TICKS" title="ibllib.io.extractors.ephys_fpga.WHEEL_TICKS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WHEEL_TICKS</span></code></a></p></td>
<td><p>The number of encoder pulses per channel for one complete rotation.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="ibllib.io.extractors.ephys_fpga.BPOD_FPGA_DRIFT_THRESHOLD_PPM.html#ibllib.io.extractors.ephys_fpga.BPOD_FPGA_DRIFT_THRESHOLD_PPM" title="ibllib.io.extractors.ephys_fpga.BPOD_FPGA_DRIFT_THRESHOLD_PPM"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BPOD_FPGA_DRIFT_THRESHOLD_PPM</span></code></a></p></td>
<td><p>Throws an error if Bpod to FPGA clock drift is higher than this value.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="ibllib.io.extractors.ephys_fpga.CHMAPS.html#ibllib.io.extractors.ephys_fpga.CHMAPS" title="ibllib.io.extractors.ephys_fpga.CHMAPS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CHMAPS</span></code></a></p></td>
<td><p>The default channel indices corresponding to various devices for different recording systems.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.data_for_keys" title="ibllib.io.extractors.ephys_fpga.data_for_keys"><code class="xref py py-obj docutils literal notranslate"><span class="pre">data_for_keys</span></code></a></p></td>
<td><p>Check keys exist in 'data' dict and contain values other than None.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.extract_all" title="ibllib.io.extractors.ephys_fpga.extract_all"><code class="xref py py-obj docutils literal notranslate"><span class="pre">extract_all</span></code></a></p></td>
<td><p>For the IBL ephys task, reads ephys binary file and extract:</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.extract_sync" title="ibllib.io.extractors.ephys_fpga.extract_sync"><code class="xref py py-obj docutils literal notranslate"><span class="pre">extract_sync</span></code></a></p></td>
<td><p>Reads ephys binary file (s) and extract sync within the binary file folder Assumes ephys data is within a <cite>raw_ephys_data</cite> folder</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.extract_wheel_sync" title="ibllib.io.extractors.ephys_fpga.extract_wheel_sync"><code class="xref py py-obj docutils literal notranslate"><span class="pre">extract_wheel_sync</span></code></a></p></td>
<td><p>Extract wheel positions and times from sync fronts dictionary for all 16 channels.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.get_ibl_sync_map" title="ibllib.io.extractors.ephys_fpga.get_ibl_sync_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_ibl_sync_map</span></code></a></p></td>
<td><p>Gets default channel map for the version/binary file type combination</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.get_main_probe_sync" title="ibllib.io.extractors.ephys_fpga.get_main_probe_sync"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_main_probe_sync</span></code></a></p></td>
<td><p>From 3A or 3B multiprobe session, returns the main probe (3A) or nidq sync pulses with the attached channel map (default chmap if none)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.get_protocol_period" title="ibllib.io.extractors.ephys_fpga.get_protocol_period"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_protocol_period</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.get_sync_and_chn_map" title="ibllib.io.extractors.ephys_fpga.get_sync_and_chn_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_sync_and_chn_map</span></code></a></p></td>
<td><p>Return sync and channel map for session based on collection where main sync is stored.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.get_sync_fronts" title="ibllib.io.extractors.ephys_fpga.get_sync_fronts"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_sync_fronts</span></code></a></p></td>
<td><p>Return the sync front polarities and times for a given channel.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.get_wheel_positions" title="ibllib.io.extractors.ephys_fpga.get_wheel_positions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_wheel_positions</span></code></a></p></td>
<td><p>Gets the wheel position from synchronisation pulses</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.load_channel_map" title="ibllib.io.extractors.ephys_fpga.load_channel_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load_channel_map</span></code></a></p></td>
<td><p>Load syncing channel map for session path and collection</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.load_sync" title="ibllib.io.extractors.ephys_fpga.load_sync"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load_sync</span></code></a></p></td>
<td><p>Load sync files from session path and collection.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials" title="ibllib.io.extractors.ephys_fpga.FpgaTrials"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FpgaTrials</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation" title="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FpgaTrialsHabituation</span></code></a></p></td>
<td><p>Extract habituationChoiceWorld trial events from an NI DAQ.</p></td>
</tr>
</tbody>
</table>
<dl class="py data">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS">
<span class="sig-name descname"><span class="pre">SYNC_BATCH_SIZE_SECS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">100</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS" title="Link to this definition"></a></dt>
<dd><p>Number of samples to read at once in bin file for sync.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.WHEEL_RADIUS_CM">
<span class="sig-name descname"><span class="pre">WHEEL_RADIUS_CM</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.WHEEL_RADIUS_CM" title="Link to this definition"></a></dt>
<dd><p>The radius of the wheel used in the task. A value of 1 ensures units remain in radians.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.WHEEL_TICKS">
<span class="sig-name descname"><span class="pre">WHEEL_TICKS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1024</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.WHEEL_TICKS" title="Link to this definition"></a></dt>
<dd><p>The number of encoder pulses per channel for one complete rotation.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.BPOD_FPGA_DRIFT_THRESHOLD_PPM">
<span class="sig-name descname"><span class="pre">BPOD_FPGA_DRIFT_THRESHOLD_PPM</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">150</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.BPOD_FPGA_DRIFT_THRESHOLD_PPM" title="Link to this definition"></a></dt>
<dd><p>Throws an error if Bpod to FPGA clock drift is higher than this value.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.CHMAPS">
<span class="sig-name descname"><span class="pre">CHMAPS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'3A':</span> <span class="pre">{'ap':</span> <span class="pre">{'audio':</span> <span class="pre">15,</span> <span class="pre">'body_camera':</span> <span class="pre">4,</span> <span class="pre">'bpod':</span> <span class="pre">7,</span> <span class="pre">'frame2ttl':</span> <span class="pre">12,</span> <span class="pre">'left_camera':</span> <span class="pre">2,</span> <span class="pre">'right_camera':</span> <span class="pre">3,</span> <span class="pre">'rotary_encoder_0':</span> <span class="pre">13,</span> <span class="pre">'rotary_encoder_1':</span> <span class="pre">14}},</span> <span class="pre">'3B':</span> <span class="pre">{'ap':</span> <span class="pre">{'imec_sync':</span> <span class="pre">6},</span> <span class="pre">'nidq':</span> <span class="pre">{'audio':</span> <span class="pre">7,</span> <span class="pre">'body_camera':</span> <span class="pre">2,</span> <span class="pre">'bpod':</span> <span class="pre">16,</span> <span class="pre">'frame2ttl':</span> <span class="pre">4,</span> <span class="pre">'imec_sync':</span> <span class="pre">3,</span> <span class="pre">'laser':</span> <span class="pre">17,</span> <span class="pre">'laser_ttl':</span> <span class="pre">18,</span> <span class="pre">'left_camera':</span> <span class="pre">0,</span> <span class="pre">'right_camera':</span> <span class="pre">1,</span> <span class="pre">'rotary_encoder_0':</span> <span class="pre">5,</span> <span class="pre">'rotary_encoder_1':</span> <span class="pre">6}}}</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.CHMAPS" title="Link to this definition"></a></dt>
<dd><p>The default channel indices corresponding to various devices for different recording systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.data_for_keys">
<span class="sig-name descname"><span class="pre">data_for_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#data_for_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.data_for_keys" title="Link to this definition"></a></dt>
<dd><p>Check keys exist in ‘data’ dict and contain values other than None.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.get_ibl_sync_map">
<span class="sig-name descname"><span class="pre">get_ibl_sync_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ef</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#get_ibl_sync_map"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.get_ibl_sync_map" title="Link to this definition"></a></dt>
<dd><p>Gets default channel map for the version/binary file type combination</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ef</strong> – ibllib.io.spikeglx.glob_ephys_file dictionary with field ‘ap’ or ‘nidq’</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>channel map dictionary</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.get_sync_fronts">
<span class="sig-name descname"><span class="pre">get_sync_fronts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_nb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#get_sync_fronts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.get_sync_fronts" title="Link to this definition"></a></dt>
<dd><p>Return the sync front polarities and times for a given channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – ‘polarities’ of fronts detected on sync trace for all 16 channels and their ‘times’.</p></li>
<li><p><strong>channel_nb</strong> (<em>int</em>) – The integer corresponding to the desired sync channel.</p></li>
<li><p><strong>tmin</strong> (<em>float</em>) – The minimum time from which to extract the sync pulses.</p></li>
<li><p><strong>tmax</strong> (<em>float</em>) – The maximum time up to which we extract the sync pulses.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Channel times and polarities.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="iblutil.util.html#iblutil.util.Bunch" title="iblutil.util.Bunch">Bunch</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.extract_wheel_sync">
<span class="sig-name descname"><span class="pre">extract_wheel_sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#extract_wheel_sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.extract_wheel_sync" title="Link to this definition"></a></dt>
<dd><p>Extract wheel positions and times from sync fronts dictionary for all 16 channels.
Output position is in radians, mathematical convention.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – ‘polarities’ of fronts detected on sync trace for all 16 chans and their ‘times’</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – Map of channel names and their corresponding index.  Default to constant.</p></li>
<li><p><strong>tmin</strong> (<em>float</em>) – The minimum time from which to extract the sync pulses.</p></li>
<li><p><strong>tmax</strong> (<em>float</em>) – The maximum time up to which we extract the sync pulses.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>numpy.array</em> – Wheel timestamps in seconds.</p></li>
<li><p><em>numpy.array</em> – Wheel positions in radians.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.extract_sync">
<span class="sig-name descname"><span class="pre">extract_sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ephys_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">namespace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'spikeglx'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#extract_sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.extract_sync" title="Link to this definition"></a></dt>
<dd><p>Reads ephys binary file (s) and extract sync within the binary file folder
Assumes ephys data is within a <cite>raw_ephys_data</cite> folder</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> – ‘/path/to/subject/yyyy-mm-dd/001’</p></li>
<li><p><strong>overwrite</strong> – Bool on re-extraction, forces overwrite instead of loading existing files</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of sync dictionaries</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.get_wheel_positions">
<span class="sig-name descname"><span class="pre">get_wheel_positions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#get_wheel_positions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.get_wheel_positions" title="Link to this definition"></a></dt>
<dd><p>Gets the wheel position from synchronisation pulses</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses and
the corresponding channel numbers.</p></li>
<li><p><strong>chmap</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – A map of channel names and their corresponding indices.</p></li>
<li><p><strong>tmin</strong> (<em>float</em>) – The minimum time from which to extract the sync pulses.</p></li>
<li><p><strong>tmax</strong> (<em>float</em>) – The maximum time up to which we extract the sync pulses.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>Bunch</em> – A dictionary with keys (‘timestamps’, ‘position’), containing the wheel event timestamps and
position in radians</p></li>
<li><p><em>Bunch</em> – A dictionary of detected movement times with keys (‘intervals’, ‘peakAmplitude’, ‘peakVelocity_times’).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.get_main_probe_sync">
<span class="sig-name descname"><span class="pre">get_main_probe_sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bin_exists</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#get_main_probe_sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.get_main_probe_sync" title="Link to this definition"></a></dt>
<dd><p>From 3A or 3B multiprobe session, returns the main probe (3A) or nidq sync pulses
with the attached channel map (default chmap if none)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The absolute session path, i.e. ‘/path/to/subject/yyyy-mm-dd/nnn’.</p></li>
<li><p><strong>bin_exists</strong> (<em>bool</em>) – Whether there is a .bin file present.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>one.alf.io.AlfBunch</em> – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses and
the corresponding channel numbers.</p></li>
<li><p><em>dict</em> – A map of channel names and their corresponding indices.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.get_protocol_period">
<span class="sig-name descname"><span class="pre">get_protocol_period</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_sync</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#get_protocol_period"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.get_protocol_period" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The absolute session path, i.e. ‘/path/to/subject/yyyy-mm-dd/nnn’.</p></li>
<li><p><strong>protocol_number</strong> (<em>int</em>) – The order that the protocol was run in.</p></li>
<li><p><strong>bpod_sync</strong> (<em>dict</em>) – The sync times and polarities for Bpod BNC1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>float</em> – The time of the detected spacer for the protocol number.</p></li>
<li><p><em>float, None</em> – The time of the next detected spacer or None if this is the last protocol run.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">FpgaTrials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_extractor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="ibllib.io.extractors.base.html#ibllib.io.extractors.base.BaseExtractor" title="ibllib.io.extractors.base.BaseExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseExtractor</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.save_names">
<span class="sig-name descname"><span class="pre">save_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('_ibl_trials.goCueTrigger_times.npy',</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">'_ibl_trials.stimOff_times.npy',</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">'_ibl_trials.quiescencePeriod.npy',</span> <span class="pre">'_ibl_trials.table.pqt',</span> <span class="pre">'_ibl_wheel.timestamps.npy',</span> <span class="pre">'_ibl_wheel.position.npy',</span> <span class="pre">'_ibl_wheelMoves.intervals.npy',</span> <span class="pre">'_ibl_wheelMoves.peakAmplitude.npy')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.save_names" title="Link to this definition"></a></dt>
<dd><p>The filenames of each extracted dataset, or None if array should not be saved.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.var_names">
<span class="sig-name descname"><span class="pre">var_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('goCueTrigger_times',</span> <span class="pre">'stimOnTrigger_times',</span> <span class="pre">'stimOffTrigger_times',</span> <span class="pre">'stimFreezeTrigger_times',</span> <span class="pre">'errorCueTrigger_times',</span> <span class="pre">'errorCue_times',</span> <span class="pre">'itiIn_times',</span> <span class="pre">'stimFreeze_times',</span> <span class="pre">'stimOff_times',</span> <span class="pre">'valveOpen_times',</span> <span class="pre">'phase',</span> <span class="pre">'position',</span> <span class="pre">'quiescence',</span> <span class="pre">'table',</span> <span class="pre">'wheel_timestamps',</span> <span class="pre">'wheel_position',</span> <span class="pre">'wheelMoves_intervals',</span> <span class="pre">'wheelMoves_peakAmplitude')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.var_names" title="Link to this definition"></a></dt>
<dd><p>A list of names for the extracted variables. These become the returned output keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.bpod_rsync_fields">
<span class="sig-name descname"><span class="pre">bpod_rsync_fields</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('intervals',</span> <span class="pre">'response_times',</span> <span class="pre">'goCueTrigger_times',</span> <span class="pre">'stimOnTrigger_times',</span> <span class="pre">'stimOffTrigger_times',</span> <span class="pre">'stimFreezeTrigger_times',</span> <span class="pre">'errorCueTrigger_times')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.bpod_rsync_fields" title="Link to this definition"></a></dt>
<dd><p>Fields from Bpod extractor that we want to re-sync to FPGA.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.bpod_fields">
<span class="sig-name descname"><span class="pre">bpod_fields</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('feedbackType',</span> <span class="pre">'choice',</span> <span class="pre">'rewardVolume',</span> <span class="pre">'contrastLeft',</span> <span class="pre">'contrastRight',</span> <span class="pre">'probabilityLeft',</span> <span class="pre">'phase',</span> <span class="pre">'position',</span> <span class="pre">'quiescence')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.bpod_fields" title="Link to this definition"></a></dt>
<dd><p>Fields from bpod extractor that we want to save.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.sync_field">
<span class="sig-name descname"><span class="pre">sync_field</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'intervals_0'</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.sync_field" title="Link to this definition"></a></dt>
<dd><p>The trial event to synchronize (must be present in extracted trials).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.bpod">
<span class="sig-name descname"><span class="pre">bpod</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.bpod" title="Link to this definition"></a></dt>
<dd><p>The Bpod out TTLs recorded on the DAQ. Used in the QC viewer plot.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict of numpy.array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.load_sync">
<span class="sig-name descname"><span class="pre">load_sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync_collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raw_ephys_data'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.load_sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.load_sync" title="Link to this definition"></a></dt>
<dd><p>Load the DAQ sync and channel map data.</p>
<p>This method may be subclassed for novel DAQ systems. The sync must contain the following
keys: ‘times’ - an array timestamps in seconds; ‘polarities’ - an array of {-1, 1}
corresponding to TTL LOW and TTL HIGH, respectively; ‘channels’ - an array of ints
corresponding to channel number.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync_collection</strong> (<em>str</em>) – The session subdirectory where the sync data are located.</p></li>
<li><p><strong>kwargs</strong> – Optional arguments used by subclass methods.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>one.alf.io.AlfBunch</em> – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses
and the corresponding channel numbers.</p></li>
<li><p><em>dict</em> – A map of channel names and their corresponding indices.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.build_trials">
<span class="sig-name descname"><span class="pre">build_trials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.build_trials"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.build_trials" title="Link to this definition"></a></dt>
<dd><p>Extract task related event times from the sync.</p>
<p>The trial start times are the shortest Bpod TTLs and occur at the start of the trial. The
first trial start TTL of the session is longer and must be handled differently. The trial
start TTL is used to assign the other trial events to each trial.</p>
<p>The trial end is the end of the so-called ‘ITI’ Bpod event TTL (classified as the longest
of the three Bpod event TTLs). Go cue audio TTLs are the shorter of the two expected audio
tones. The first of these after each trial start is taken to be the go cue time. Error
tones are longer audio TTLs and assigned as the last of such occurrence after each trial
start. The valve open Bpod TTLs are medium-length, the last of which is used for each trial.
The feedback times are times of either valve open or error tone as there should be only one
such event per trial.</p>
<p>The stimulus times are taken from the frame2ttl events (with improbably high frequency TTLs
removed): the first TTL after each trial start is assumed to be the stim onset time; the
second to last and last are taken as the stimulus freeze and offset times, respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – ‘polarities’ of fronts detected on sync trace for all 16 chans and their ‘times’</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – Map of channel names and their corresponding index.  Default to constant.</p></li>
<li><p><strong>display</strong> (<em>bool</em><em>, </em><em>matplotlib.pyplot.Axes</em>) – Show the full session sync pulses display.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A map of trial event timestamps.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.get_wheel_positions">
<span class="sig-name descname"><span class="pre">get_wheel_positions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.get_wheel_positions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.get_wheel_positions" title="Link to this definition"></a></dt>
<dd><p>Extract wheel and wheelMoves objects.</p>
<p>This method is called by the main extract method and may be overloaded by subclasses.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.get_stimulus_update_times">
<span class="sig-name descname"><span class="pre">get_stimulus_update_times</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.get_stimulus_update_times"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.get_stimulus_update_times" title="Link to this definition"></a></dt>
<dd><p>Extract stimulus update times from sync.</p>
<p>Gets the stimulus times from the frame2ttl channel and cleans the signal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses
and the corresponding channel numbers.</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – A map of channel names and their corresponding indices. Must contain a ‘frame2ttl’ key.</p></li>
<li><p><strong>display</strong> (<em>bool</em>) – If true, plots the input TTLs and the cleaned output.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary with keys {‘times’, ‘polarities’} containing stimulus TTL fronts.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.get_audio_event_times">
<span class="sig-name descname"><span class="pre">get_audio_event_times</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">audio_event_ttls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.get_audio_event_times"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.get_audio_event_times" title="Link to this definition"></a></dt>
<dd><p>Extract audio times from sync.</p>
<p>Gets the TTL times from the ‘audio’ channel, cleans the signal, and classifies each TTL
event by length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses
and the corresponding channel numbers.</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – A map of channel names and their corresponding indices. Must contain an ‘audio’ key.</p></li>
<li><p><strong>audio_event_ttls</strong> (<em>dict</em>) – A map of event names to (min, max) TTL length.</p></li>
<li><p><strong>display</strong> (<em>bool</em>) – If true, plots the input TTLs and the cleaned output.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>dict</em> – A dictionary with keys {‘times’, ‘polarities’} containing audio TTL fronts.</p></li>
<li><p><em>dict</em> – A dictionary of events (from <cite>audio_event_ttls</cite>) and their intervals as an Nx2 array.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.get_bpod_event_times">
<span class="sig-name descname"><span class="pre">get_bpod_event_times</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_event_ttls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.get_bpod_event_times"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.get_bpod_event_times" title="Link to this definition"></a></dt>
<dd><p>Extract Bpod times from sync.</p>
<p>Gets the Bpod TTL times from the sync ‘bpod’ channel and classifies each TTL event by
length. NB: The first trial has an abnormal trial_start TTL that is usually mis-assigned.
This method accounts for this.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses
and the corresponding channel numbers. Must contain a ‘bpod’ key.</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – A map of channel names and their corresponding indices.</p></li>
<li><p><strong>bpod_event_ttls</strong> (<em>dict</em><em> of </em><em>tuple</em>) – A map of event names to (min, max) TTL length.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>dict</em> – A dictionary with keys {‘times’, ‘polarities’} containing Bpod TTL fronts.</p></li>
<li><p><em>dict</em> – A dictionary of events (from <cite>bpod_event_ttls</cite>) and their intervals as an Nx2 array.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrials.sync_bpod_clock">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">sync_bpod_clock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bpod_trials</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fpga_trials</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_field</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrials.sync_bpod_clock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials.sync_bpod_clock" title="Link to this definition"></a></dt>
<dd><p>Sync the Bpod clock to FPGA one using the provided trial event.</p>
<p>It assumes that <cite>sync_field</cite> is in both <cite>fpga_trials</cite> and <cite>bpod_trials</cite>. Syncing on both
intervals is not supported so to sync on trial start times, <cite>sync_field</cite> should be
‘intervals_0’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bpod_trials</strong> (<em>dict</em>) – A dictionary of extracted Bpod trial events.</p></li>
<li><p><strong>fpga_trials</strong> (<em>dict</em>) – A dictionary of TTL events extracted from FPGA sync (see <cite>extract_behaviour_sync</cite>
method).</p></li>
<li><p><strong>sync_field</strong> (<em>str</em>) – The trials key to use for syncing clocks. For intervals (i.e. Nx2 arrays) append the
column index, e.g. ‘intervals_0’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>function</em> – Interpolation function such that f(timestamps_bpod) = timestamps_fpga.</p></li>
<li><p><em>float</em> – The clock drift in parts per million.</p></li>
<li><p><em>numpy.array of int</em> – The indices of the Bpod trial events in the FPGA trial events array.</p></li>
<li><p><em>numpy.array of int</em> – The indices of the FPGA trial events in the Bpod trial events array.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – The key <cite>sync_field</cite> was not found in either the <cite>bpod_trials</cite> or <cite>fpga_trials</cite> dicts.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">FpgaTrialsHabituation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_extractor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrialsHabituation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#ibllib.io.extractors.ephys_fpga.FpgaTrials" title="ibllib.io.extractors.ephys_fpga.FpgaTrials"><code class="xref py py-class docutils literal notranslate"><span class="pre">FpgaTrials</span></code></a></p>
<p>Extract habituationChoiceWorld trial events from an NI DAQ.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.save_names">
<span class="sig-name descname"><span class="pre">save_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('_ibl_trials.stimCenter_times.npy',</span> <span class="pre">'_ibl_trials.feedbackType.npy',</span> <span class="pre">'_ibl_trials.rewardVolume.npy',</span> <span class="pre">'_ibl_trials.stimOff_times.npy',</span> <span class="pre">'_ibl_trials.contrastLeft.npy',</span> <span class="pre">'_ibl_trials.contrastRight.npy',</span> <span class="pre">'_ibl_trials.feedback_times.npy',</span> <span class="pre">'_ibl_trials.stimOn_times.npy',</span> <span class="pre">'_ibl_trials.stimOnTrigger_times.npy',</span> <span class="pre">'_ibl_trials.intervals.npy',</span> <span class="pre">'_ibl_trials.goCue_times.npy',</span> <span class="pre">'_ibl_trials.goCueTrigger_times.npy',</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None,</span> <span class="pre">None)</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.save_names" title="Link to this definition"></a></dt>
<dd><p>The filenames of each extracted dataset, or None if array should not be saved.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.var_names">
<span class="sig-name descname"><span class="pre">var_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('stimCenter_times',</span> <span class="pre">'feedbackType',</span> <span class="pre">'rewardVolume',</span> <span class="pre">'stimOff_times',</span> <span class="pre">'contrastLeft',</span> <span class="pre">'contrastRight',</span> <span class="pre">'feedback_times',</span> <span class="pre">'stimOn_times',</span> <span class="pre">'stimOnTrigger_times',</span> <span class="pre">'intervals',</span> <span class="pre">'goCue_times',</span> <span class="pre">'goCueTrigger_times',</span> <span class="pre">'itiIn_times',</span> <span class="pre">'stimOffTrigger_times',</span> <span class="pre">'stimCenterTrigger_times',</span> <span class="pre">'position',</span> <span class="pre">'phase')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.var_names" title="Link to this definition"></a></dt>
<dd><p>A list of names for the extracted variables. These become the returned output keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.bpod_rsync_fields">
<span class="sig-name descname"><span class="pre">bpod_rsync_fields</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('intervals',</span> <span class="pre">'stimOn_times',</span> <span class="pre">'feedback_times',</span> <span class="pre">'stimCenterTrigger_times',</span> <span class="pre">'goCue_times',</span> <span class="pre">'itiIn_times',</span> <span class="pre">'stimOffTrigger_times',</span> <span class="pre">'stimOff_times',</span> <span class="pre">'stimCenter_times',</span> <span class="pre">'stimOnTrigger_times',</span> <span class="pre">'goCueTrigger_times')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.bpod_rsync_fields" title="Link to this definition"></a></dt>
<dd><p>Fields from Bpod extractor that we want to re-sync to FPGA.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.bpod_fields">
<span class="sig-name descname"><span class="pre">bpod_fields</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('feedbackType',</span> <span class="pre">'rewardVolume',</span> <span class="pre">'contrastLeft',</span> <span class="pre">'contrastRight',</span> <span class="pre">'position',</span> <span class="pre">'phase')</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.bpod_fields" title="Link to this definition"></a></dt>
<dd><p>Fields from Bpod extractor that we want to save.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.sync_field">
<span class="sig-name descname"><span class="pre">sync_field</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'feedback_times'</span></em><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.sync_field" title="Link to this definition"></a></dt>
<dd><p>The trial event to synchronize (must be present in extracted trials).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.get_bpod_event_times">
<span class="sig-name descname"><span class="pre">get_bpod_event_times</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpod_event_ttls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrialsHabituation.get_bpod_event_times"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.get_bpod_event_times" title="Link to this definition"></a></dt>
<dd><p>Extract Bpod times from sync.</p>
<p>Currently (at least v8.12 and below) there is no trial start or end TTL, only an ITI pulse.
Also the first trial pulse is incorrectly assigned due to its abnormal length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses
and the corresponding channel numbers. Must contain a ‘bpod’ key.</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – A map of channel names and their corresponding indices.</p></li>
<li><p><strong>bpod_event_ttls</strong> (<em>dict</em><em> of </em><em>tuple</em>) – A map of event names to (min, max) TTL length.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>dict</em> – A dictionary with keys {‘times’, ‘polarities’} containing Bpod TTL fronts.</p></li>
<li><p><em>dict</em> – A dictionary of events (from <cite>bpod_event_ttls</cite>) and their intervals as an Nx2 array.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.build_trials">
<span class="sig-name descname"><span class="pre">build_trials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#FpgaTrialsHabituation.build_trials"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.FpgaTrialsHabituation.build_trials" title="Link to this definition"></a></dt>
<dd><p>Extract task related event times from the sync.</p>
<p>This is called by the superclass <cite>_extract</cite> method.  The key difference here is that the
<cite>trial_start</cite> LOW-&gt;HIGH is the trial end, and HIGH-&gt;LOW is trial start.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> (<em>dict</em>) – ‘polarities’ of fronts detected on sync trace for all 16 chans and their ‘times’</p></li>
<li><p><strong>chmap</strong> (<em>dict</em>) – Map of channel names and their corresponding index.  Default to constant.</p></li>
<li><p><strong>display</strong> (<em>bool</em><em>, </em><em>matplotlib.pyplot.Axes</em>) – Show the full session sync pulses display.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A map of trial event timestamps.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.extract_all">
<span class="sig-name descname"><span class="pre">extract_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raw_ephys_data'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task_collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raw_behavior_data'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#extract_all"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.extract_all" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>For the IBL ephys task, reads ephys binary file and extract:</dt><dd><ul class="simple">
<li><p>sync</p></li>
<li><p>wheel</p></li>
<li><p>behaviour</p></li>
</ul>
</dd>
</dl>
<p>These <cite>extract_all</cite> functions should be deprecated as they make assumptions about hardware
parameters.  Additionally the FpgaTrials class now automatically loads DAQ sync files, extracts
the Bpod trials, and returns a dict instead of a tuple. Therefore this function is entirely
redundant. See the examples for the correct way to extract NI DAQ behaviour sessions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The absolute session path, i.e. ‘/path/to/subject/yyyy-mm-dd/nnn’.</p></li>
<li><p><strong>sync_collection</strong> (<em>str</em>) – The session subdirectory where the sync data are located.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – If true, save the extracted files to save_path.</p></li>
<li><p><strong>task_collection</strong> (<em>str</em>) – The location of the behaviour protocol data.</p></li>
<li><p><strong>save_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The save location of the extracted files, defaults to the alf directory of the session path.</p></li>
<li><p><strong>protocol_number</strong> (<em>int</em>) – The order that the protocol was run in.</p></li>
<li><p><strong>**kwargs</strong> – Optional extractor keyword arguments.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>list</em> – The extracted data.</p></li>
<li><p><em>list of pathlib.Path, None</em> – If save is True, a list of file paths to the extracted data.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.get_sync_and_chn_map">
<span class="sig-name descname"><span class="pre">get_sync_and_chn_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_collection</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#get_sync_and_chn_map"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.get_sync_and_chn_map" title="Link to this definition"></a></dt>
<dd><p>Return sync and channel map for session based on collection where main sync is stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The absolute session path, i.e. ‘/path/to/subject/yyyy-mm-dd/nnn’.</p></li>
<li><p><strong>sync_collection</strong> (<em>str</em>) – The session subdirectory where the sync data are located.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>one.alf.io.AlfBunch</em> – A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses and
the corresponding channel numbers.</p></li>
<li><p><em>dict</em> – A map of channel names and their corresponding indices.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.load_channel_map">
<span class="sig-name descname"><span class="pre">load_channel_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_collection</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#load_channel_map"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.load_channel_map" title="Link to this definition"></a></dt>
<dd><p>Load syncing channel map for session path and collection</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The absolute session path, i.e. ‘/path/to/subject/yyyy-mm-dd/nnn’.</p></li>
<li><p><strong>sync_collection</strong> (<em>str</em>) – The session subdirectory where the sync data are located.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A map of channel names and their corresponding indices.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.ephys_fpga.load_sync">
<span class="sig-name descname"><span class="pre">load_sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_collection</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/ephys_fpga.html#load_sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.ephys_fpga.load_sync" title="Link to this definition"></a></dt>
<dd><p>Load sync files from session path and collection.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The absolute session path, i.e. ‘/path/to/subject/yyyy-mm-dd/nnn’.</p></li>
<li><p><strong>sync_collection</strong> (<em>str</em>) – The session subdirectory where the sync data are located.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary with keys (‘times’, ‘polarities’, ‘channels’), containing the sync pulses and
the corresponding channel numbers.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://int-brain-lab.github.io/ONE/_autosummary/one.alf.io.html#one.alf.io.AlfBunch" title="(in ONE)">one.alf.io.AlfBunch</a></p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ibllib.io.extractors.default_channel_maps.html" class="btn btn-neutral float-left" title="ibllib.io.extractors.default_channel_maps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS.html" class="btn btn-neutral float-right" title="ibllib.io.extractors.ephys_fpga.SYNC_BATCH_SIZE_SECS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>