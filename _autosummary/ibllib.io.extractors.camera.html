<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ibllib.io.extractors.camera &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ibllib.io.extractors.default_channel_maps" href="ibllib.io.extractors.default_channel_maps.html" />
    <link rel="prev" title="ibllib.io.extractors.bpod_trials" href="ibllib.io.extractors.bpod_trials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/data_download.html">Download the public datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ibllib.html">ibllib</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ibllib.atlas.html">ibllib.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.ephys.html">ibllib.ephys</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.exceptions.html">ibllib.exceptions</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="ibllib.io.html">ibllib.io</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="ibllib.io.extractors.html">ibllib.io.extractors</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.ffmpeg.html">ibllib.io.ffmpeg</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.flags.html">ibllib.io.flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.globus.html">ibllib.io.globus</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.misc.html">ibllib.io.misc</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.npy_header.html">ibllib.io.npy_header</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.raw_daq_loaders.html">ibllib.io.raw_daq_loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.raw_data_loaders.html">ibllib.io.raw_data_loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.session_params.html">ibllib.io.session_params</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.io.video.html">ibllib.io.video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.misc.html">ibllib.misc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.oneibl.html">ibllib.oneibl</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.pipes.html">ibllib.pipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.plots.html">ibllib.plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.qc.html">ibllib.qc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.tests.html">ibllib.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.time.html">ibllib.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="brainbox.html">brainbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="iblatlas.html">iblatlas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../010_api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="ibllib.html">ibllib</a></li>
          <li class="breadcrumb-item"><a href="ibllib.io.html">ibllib.io</a></li>
          <li class="breadcrumb-item"><a href="ibllib.io.extractors.html">ibllib.io.extractors</a></li>
      <li class="breadcrumb-item active">ibllib.io.extractors.camera</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/ibllib.io.extractors.camera.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ibllib.io.extractors.camera">
<span id="ibllib-io-extractors-camera"></span><h1>ibllib.io.extractors.camera<a class="headerlink" href="#module-ibllib.io.extractors.camera" title="Link to this heading"></a></h1>
<p>Camera extractor functions.
This module handles extraction of camera timestamps for both Bpod and DAQ.</p>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.align_with_gpio" title="ibllib.io.extractors.camera.align_with_gpio"><code class="xref py py-obj docutils literal notranslate"><span class="pre">align_with_gpio</span></code></a></p></td>
<td><p>Groom the raw DAQ or Bpod camera timestamps using the frame embedded GPIO and frame counter.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.attribute_times" title="ibllib.io.extractors.camera.attribute_times"><code class="xref py py-obj docutils literal notranslate"><span class="pre">attribute_times</span></code></a></p></td>
<td><p>Returns the values of the first array that correspond to those of the second.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.extract_all" title="ibllib.io.extractors.camera.extract_all"><code class="xref py py-obj docutils literal notranslate"><span class="pre">extract_all</span></code></a></p></td>
<td><p>For the IBL ephys task, reads ephys binary file and extract:</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.extract_camera_sync" title="ibllib.io.extractors.camera.extract_camera_sync"><code class="xref py py-obj docutils literal notranslate"><span class="pre">extract_camera_sync</span></code></a></p></td>
<td><p>Extract camera timestamps from the sync matrix</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.get_video_length" title="ibllib.io.extractors.camera.get_video_length"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_video_length</span></code></a></p></td>
<td><p>Returns video length</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.groom_pin_state" title="ibllib.io.extractors.camera.groom_pin_state"><code class="xref py py-obj docutils literal notranslate"><span class="pre">groom_pin_state</span></code></a></p></td>
<td><p>Align the GPIO pin state to the DAQ sync TTLs.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.CameraTimestampsBpod" title="ibllib.io.extractors.camera.CameraTimestampsBpod"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CameraTimestampsBpod</span></code></a></p></td>
<td><p>Get the camera timestamps from the Bpod</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.CameraTimestampsCamlog" title="ibllib.io.extractors.camera.CameraTimestampsCamlog"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CameraTimestampsCamlog</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.io.extractors.camera.CameraTimestampsFPGA" title="ibllib.io.extractors.camera.CameraTimestampsFPGA"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CameraTimestampsFPGA</span></code></a></p></td>
<td><p>Extractor for videos using DAQ sync and channel map.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.extract_camera_sync">
<span class="sig-name descname"><span class="pre">extract_camera_sync</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#extract_camera_sync"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.extract_camera_sync" title="Link to this definition"></a></dt>
<dd><p>Extract camera timestamps from the sync matrix</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync</strong> – dictionary ‘times’, ‘polarities’ of fronts detected on sync trace</p></li>
<li><p><strong>chmap</strong> – dictionary containing channel indices. Default to constant.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dictionary containing camera timestamps</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.get_video_length">
<span class="sig-name descname"><span class="pre">get_video_length</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">video_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#get_video_length"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.get_video_length" title="Link to this definition"></a></dt>
<dd><p>Returns video length</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>video_path</strong> – A path to the video</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.CameraTimestampsFPGA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CameraTimestampsFPGA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#CameraTimestampsFPGA"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.CameraTimestampsFPGA" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="ibllib.io.extractors.base.html#ibllib.io.extractors.base.BaseExtractor" title="ibllib.io.extractors.base.BaseExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseExtractor</span></code></a></p>
<p>Extractor for videos using DAQ sync and channel map.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.CameraTimestampsCamlog">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CameraTimestampsCamlog</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#CameraTimestampsCamlog"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.CameraTimestampsCamlog" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="ibllib.io.extractors.base.html#ibllib.io.extractors.base.BaseExtractor" title="ibllib.io.extractors.base.BaseExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseExtractor</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.CameraTimestampsBpod">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CameraTimestampsBpod</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#CameraTimestampsBpod"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.CameraTimestampsBpod" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="ibllib.io.extractors.base.html#ibllib.io.extractors.base.BaseBpodTrialsExtractor" title="ibllib.io.extractors.base.BaseBpodTrialsExtractor"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseBpodTrialsExtractor</span></code></a></p>
<p>Get the camera timestamps from the Bpod</p>
<p>The camera events are logged only during the events not in between, so the times need
to be interpolated</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.CameraTimestampsBpod.save_names">
<span class="sig-name descname"><span class="pre">save_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'_ibl_leftCamera.times.npy'</span></em><a class="headerlink" href="#ibllib.io.extractors.camera.CameraTimestampsBpod.save_names" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.CameraTimestampsBpod.var_names">
<span class="sig-name descname"><span class="pre">var_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'left_camera_timestamps'</span></em><a class="headerlink" href="#ibllib.io.extractors.camera.CameraTimestampsBpod.var_names" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.align_with_gpio">
<span class="sig-name descname"><span class="pre">align_with_gpio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ttl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">count</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extrapolate_missing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#align_with_gpio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.align_with_gpio" title="Link to this definition"></a></dt>
<dd><p>Groom the raw DAQ or Bpod camera timestamps using the frame embedded GPIO and frame counter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamps</strong> (<em>numpy.array</em>) – An array of raw DAQ or Bpod camera timestamps.</p></li>
<li><p><strong>ttl</strong> (<em>dict</em>) – A dictionary of DAQ sync TTLs, with keys {‘times’, ‘polarities’}.</p></li>
<li><p><strong>pin_state</strong> (<em>dict</em>) – A dictionary containing GPIO pin state values, with keys {‘indices’, ‘polarities’}.</p></li>
<li><p><strong>count</strong> (<em>numpy.array</em>) – An array of frame numbers.</p></li>
<li><p><strong>extrapolate_missing</strong> (<em>bool</em>) – If true and the number of timestamps is fewer than the number of frame counts, the
remaining timestamps are extrapolated based on the frame rate, otherwise they are NaNs.</p></li>
<li><p><strong>display</strong> (<em>bool</em>) – Plot the resulting timestamps.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The corrected frame timestamps.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.attribute_times">
<span class="sig-name descname"><span class="pre">attribute_times</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">injective</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">take</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'first'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#attribute_times"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.attribute_times" title="Link to this definition"></a></dt>
<dd><p>Returns the values of the first array that correspond to those of the second.</p>
<p>Given two arrays of timestamps, the function will return the values of the first array
that most likely correspond to the values of the second.  For each of the values in the
second array, the absolute difference is taken and the index of either the first sufficiently
close value, or simply the closest one, is assigned.</p>
<p>If injective is True, once a value has been assigned to an event it can’t be assigned to
another.  In other words there is a one-to-one mapping between the two arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>numpy.array</em>) – An array of event times to attribute to those in <cite>events</cite>.</p></li>
<li><p><strong>events</strong> (<em>numpy.array</em>) – An array of event times considered a subset of <cite>arr</cite>.</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – The max absolute difference between values in order to be considered a match.</p></li>
<li><p><strong>injective</strong> (<em>bool</em>) – If true, once a value has been assigned it will not be assigned again.</p></li>
<li><p><strong>take</strong> (<em>{'first'</em><em>, </em><em>'nearest'</em><em>, </em><em>'after'}</em>) – If ‘first’ the first value within tolerance is assigned; if ‘nearest’ the
closest value is assigned; if ‘after’ assign the first event after.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An array the same length as <cite>events</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.groom_pin_state">
<span class="sig-name descname"><span class="pre">groom_pin_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gpio</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ttl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">take</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'first'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_diff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#groom_pin_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.groom_pin_state" title="Link to this definition"></a></dt>
<dd><p>Align the GPIO pin state to the DAQ sync TTLs.  Any sync TTLs not reflected in the pin
state are removed from the dict and the times of the detected fronts are converted to DAQ
time.  At the end of this the number of GPIO fronts should equal the number of TTLs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This function is ultra safe: we probably don’t need assign all the ups and down fronts.</p></li>
</ul>
<p>separately and could potentially even align the timestamps without removing the missed fronts
- The input gpio and TTL dicts may be modified by this function.
- For training sessions the frame rate is only 30Hz and the TTLs tend to be broken up by
small gaps.  Setting the min_diff to 5ms helps the timestamp assignment accuracy.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gpio</strong> (<em>dict</em>) – A dictionary containing GPIO pin state values, with keys {‘indices’, ‘polarities’}.</p></li>
<li><p><strong>ttl</strong> (<em>dict</em>) – A dictionary of DAQ sync TTLs, with keys {‘times’, ‘polarities’}.</p></li>
<li><p><strong>ts</strong> (<em>numpy.array</em>) – The camera frame times (the camera frame TTLs acquired by the main DAQ).</p></li>
<li><p><strong>tolerance</strong> (<em>float</em>) – Two pulses need to be within this many seconds to be considered related.</p></li>
<li><p><strong>display</strong> (<em>bool</em>) – If true, the resulting timestamps are plotted against the raw audio signal.</p></li>
<li><p><strong>take</strong> (<em>{'first'</em><em>, </em><em>'nearest'}</em>) – If ‘first’ the first value within tolerance is assigned; if ‘nearest’ the
closest value is assigned.</p></li>
<li><p><strong>min_diff</strong> (<em>float</em>) – Sync TTL fronts less than min_diff seconds apart will be removed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>dict</em> – Dictionary of GPIO DAQ front indices, polarities and DAQ aligned times.</p></li>
<li><p><em>dict</em> – Sync TTL times and polarities sans the TTLs not detected in the frame data.</p></li>
<li><p><em>numpy.array</em> – Frame times in DAQ time.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ibllib.io.extractors.ephys_fpga._get_sync_fronts</span></code></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ibllib.io.extractors.camera.extract_all">
<span class="sig-name descname"><span class="pre">extract_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/io/extractors/camera.html#extract_all"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ibllib.io.extractors.camera.extract_all" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>For the IBL ephys task, reads ephys binary file and extract:</dt><dd><ul class="simple">
<li><p>video time stamps</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>session_type</strong> – the session type to extract, i.e. ‘ephys’, ‘training’ or ‘biased’. If</p>
</dd>
</dl>
<p>None the session type is inferred from the settings file.
:param save: Bool, defaults to False
:param kwargs: parameters to pass to the extractor
:return: outputs, files</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_path</strong> (<em>str</em><em>, </em><em>pathlib.Path</em>) – The session path, e.g. ‘/path/to/subject/yyyy-mm-dd/001’.</p></li>
<li><p><strong>sync_type</strong> (<em>str</em>) – The sync label from the experiment description file.</p></li>
<li><p><strong>sync_collection</strong> (<em>str</em>) – The subdirectory containing the sync files.</p></li>
<li><p><strong>save</strong> (<em>bool</em>) – If True, save the camera timestamp files to disk.</p></li>
<li><p><strong>session_type</strong> (<em>str</em>) – (DEPRECATED) The session type, e.g. ‘ephys’.</p></li>
<li><p><strong>**kwargs</strong> – Extra keyword args to pass to the camera extractor classes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>list of numpy.array</em> – List of extracted output data, i.e. the camera times.</p></li>
<li><p><em>list of pathlib.Path</em> – The paths of the extracted data, if save = True</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ibllib.io.extractors.bpod_trials.html" class="btn btn-neutral float-left" title="ibllib.io.extractors.bpod_trials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ibllib.io.extractors.default_channel_maps.html" class="btn btn-neutral float-right" title="ibllib.io.extractors.default_channel_maps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>