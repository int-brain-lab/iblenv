<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IBL Viewer &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataJoint</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_introduction.html">Introduction to DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_public.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_credentials.html">DataJoint credentials for internal IBL users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06_examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_intro/dj_intro.html">Datajoint Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_basics/dj_basics.html">Exploring the IBL Data Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks_external/docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Detailed Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>IBL Viewer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs_external/ibl_viewer.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section class="tex2jax_ignore mathjax_ignore" id="ibl-viewer">
<h1>IBL Viewer<a class="headerlink" href="#ibl-viewer" title="Permalink to this headline"></a></h1>
<p>The International Brain Laboratory Viewer is a simple and fast 3D interactive visualization tool based on VTK that uses GPU accelerated volume and surface rendering. It runs on python 3.8+ and it can be embed in Jupyter Lab/Notebook and Qt user interfaces.</p>
<p>This viewer is featured with an optional QT user interface with more advanced functionalities like dynamic statistics. In the terminal, type <code class="docutils literal notranslate"><span class="pre">iblviewer</span></code> and see what parameters are available. The viewer launches by default with a Qt UI.</p>
<p>Most of the viewer makes VTK usable as an interactive application and you may use it as such. Just use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">iblviewer.application</span> <span class="pre">import</span> <span class="pre">Viewer</span></code></p>
<p>The small added part related to IBL allows scientists to view their data and models for further analysis. From electrophysiological data to neuronal connectivity, this tool allows simple and effective 3D visualization for many use-cases like multi-slicing and time series even on volumes. In that case, you will use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">iblviewer.mouse_brain</span> <span class="pre">import</span> <span class="pre">MouseBrainViewer</span></code></p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/int-brain-lab/iblviewer.git
</pre></div>
</div>
</section>
<section id="installation-related-to-ibl">
<h2>Installation related to IBL<a class="headerlink" href="#installation-related-to-ibl" title="Permalink to this headline"></a></h2>
<p>If you wish to use this viewer with International Brain Laboratory data sets and libraries, you will need ibllib:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install ibllib
</pre></div>
</div>
<p>An example of mouse brain-wide map of electrophysiological recordings (seen here as point neurons) in the Allen Brain Atlas CCF v3 with both DWI and segmented volumes.
<img alt="Viewer multi-volume and points rendering" src="../../iblviewer-repo/iblviewer_assets/doc/iblviewer_v2_demo_brain_wide_map_1.jpg?raw=true" /></p>
<p>Another example of the Qt UI with additional features like custom interactive statistics, in this case with matplotlib.
<img alt="Viewer with stats in Qt" src="../../iblviewer-repo/iblviewer_assets/doc/iblviewer_v2_demo_volume_mapping_qt.jpg?raw=true" /></p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h2>
<p>If at some point it complains about failing to uninstall vtk, it’s likely that vtk is already installed within your conda environment and that it causes troubles (even if it’s the proper version).
Run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda uninstall vtk
pip install vtk
</pre></div>
</div>
<p>This will uninstall vtk and reinstall it (version 9+) with pip.</p>
</section>
<section id="updating">
<h2>Updating<a class="headerlink" href="#updating" title="Permalink to this headline"></a></h2>
<p>If you have installed IBLViewer (see below) and you to update to the latest version, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -U git+https://github.com/int-brain-lab/iblviewer.git
</pre></div>
</div>
<p>In rare cases like observed on Windows once, updating fails and the user doesn’t know about it. Reinstall iblviewer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip uninstall iblviewer
pip install git+https://github.com/int-brain-lab/iblviewer.git
</pre></div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline"></a></h2>
<p>Write <code class="docutils literal notranslate"><span class="pre">iblviewer</span></code> in the command line to start the viewer, add <code class="docutils literal notranslate"><span class="pre">--help</span></code> for info about arguments.
You may launch examples/demos from the command line too, write <code class="docutils literal notranslate"><span class="pre">iblviewer</span></code>, hit <code class="docutils literal notranslate"><span class="pre">TAB</span></code> key twice and a list of names are given, like <code class="docutils literal notranslate"><span class="pre">iblviewer-volume-mapping-demo</span></code>. There’s a demo for headless rendering when you only need to execute code and produce an image or video.</p>
<p>If you wish to run your own code, here are steps below.</p>
<p>Code to run the launcher with arguments from the command line (such as using the Qt UI)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iblviewer.launcher</span> <span class="kn">import</span> <span class="n">IBLViewer</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">IBLViewer</span><span class="p">()</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>
</div>
<p>If you’re not interested in the Qt UI, you may either directly use the VTK viewer below or the neuroscience one.</p>
<p>Sample code to run the generic VTK viewer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iblviewer.application</span> <span class="kn">import</span> <span class="n">Viewer</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">Viewer</span><span class="p">()</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">embed_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Add some random point data</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="c1"># Select and autofocus the last added object (the points)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
<span class="c1"># viewer.select(points) or viewer.select(points.name) yield the same result</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Sample code to run the mouse atlas viewer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iblviewer.mouse_brain</span> <span class="kn">import</span> <span class="n">MouseBrainViewer</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">MouseBrainViewer</span><span class="p">()</span>
<span class="c1"># See initialize parameters for more choices</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Allen&#39;</span><span class="p">,</span> <span class="n">add_atlas</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                    <span class="n">add_dwi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><span class="xref myst">Volumetric time series</span> of values assigned to brain regions.</p>
<p><span class="xref myst">Point neurons</span> and connectivity data.</p>
<p><span class="xref myst">Insertion probes</span>, or how to display lines made of an heterogeneous amount of points. This example requires valid credentials to IBL back-end.</p>
<p>Since this tool is built on top of VTK and <a class="reference external" href="https://github.com/marcomusy/vedo">vedo</a>, a wrapper for VTK that makes it easy to use, you have endless possibilities for plotting and visualizing your data.</p>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline"></a></h2>
<p>This application relies on the well-known pattern MVC (Model-View-Controller).
By decoupling elements, it is easy to extend the application and to customize it for your needs.</p>
<p>This application partly relies on vedo, a wrapper for vtk python (that makes it easier to use). When it comes to volume rendering, vedo and its challenger pyvista are lacking. When you start working on scientific analysis and modeling using volumetric data (combined with surface meshes if you wish), this viewer comes in handy.</p>
<p>vedo and pyvista, two packages doing the same thing really, that is wrapping vtk python in an easily accessible way are great to start with. If you want to build an application with optimized updating mechanisms (that are part of VTK already), vedo and pyvista are not made for this per say. So we keep here the useful parts of vedo and for all the rest, we use vtk python.</p>
<p>IBLViewer adds the following features:</p>
<ul class="simple">
<li><p>simple but powerful features</p></li>
<li><p>update-oriented rather than destroy-create</p></li>
<li><p>per-context UI and state</p></li>
<li><p>slicer that can be controlled by the UI or by code</p></li>
<li><p>interactive volumetric data mapping</p></li>
<li><p>mixing volumes and surfaces</p></li>
</ul>
<p><img alt="UML schema" src="../../iblviewer-repo/iblviewer_assets/doc/iblviewer_architecture.jpg?raw=true" /></p>
</section>
<section id="issues-and-feature-request">
<h2>Issues and feature request<a class="headerlink" href="#issues-and-feature-request" title="Permalink to this headline"></a></h2>
<p>Feel free to request features, submit PRs and raise issues.</p>
</section>
<section id="author">
<h2>Author<a class="headerlink" href="#author" title="Permalink to this headline"></a></h2>
<p>Nicolas Antille, International Brain Laboratory, 2021</p>
</section>
<section id="special-thanks">
<h2>Special thanks<a class="headerlink" href="#special-thanks" title="Permalink to this headline"></a></h2>
<p>Thanks Marco Musy and Federico Claudi for their support in using <a class="reference external" href="https://github.com/marcomusy/vedo">vedo</a>. Check out the tool that Federico made, called <a class="reference external" href="https://github.com/brainglobe/brainrender">brainrender</a>, a tool that leverages surface rendering to create great scientific figures.</p>
<p>From International Brain Laboratory:
Thanks professor Alexandre Pouget, Berk Gerçek, Guido Meijer, Leenoy Meshulam and Alessandro Santos for their constructive feedbacks and guidance. Thanks Olivier Winter, Gaelle Chapuis and Shan Shen for their support.</p>
<p>The project was initiated and funded by <a class="reference external" href="https://www.unige.ch/medecine/neuf/en/research/grecherche/alexandre-pouget">the laboratory of professor Alexandre Pouget</a>, University of Geneva, Faculty of Medecine, Basic Neuroscience which participates to <a class="reference external" href="https://www.internationalbrainlab.com">International Brain Laboratory</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>