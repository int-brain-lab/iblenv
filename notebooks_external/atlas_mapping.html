<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atlas mapping &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting brain region values on histology slices" href="atlas_plotting_scalar_on_slice.html" />
    <link rel="prev" title="Atlas Examples" href="../atlas_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DataJoint</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_introduction.html">Introduction to DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_public.html">Publicly available IBL data via Datajoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dj_docs/dj_credentials.html">DataJoint credentials for internal IBL users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html#information-and-troubleshooting">Information and troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Atlas mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Available-Mappings">Available Mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Understanding-the-mappings">Understanding the mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Lateralisation">Lateralisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#How-to-map-your-data">How to map your data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Mapping-from-mlapdv-coordinates">Mapping from mlapdv coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Mapping-from-atlas-ids">Mapping from atlas ids</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Converting-to-acronyms">Converting to acronyms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="atlas_plotting_scalar_on_slice.html">Plotting brain region values on histology slices</a></li>
<li class="toctree-l2"><a class="reference internal" href="atlas_dorsal_cortex_flatmap.html">Plotting brain region values on cortical flatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="atlas_circular_pyramidal_flatmap.html">Plotting brain region values on circular flatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="atlas_plotting_points_on_slice.html">Plotting cluster locations on histology slices</a></li>
<li class="toctree-l2"><a class="reference internal" href="atlas_swanson_flatmap.html">Plotting brain region values on the Swanson flat map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_intro/dj_intro.html">Datajoint Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/dj_basics/dj_basics.html">Exploring the IBL Data Pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../atlas_examples.html">Atlas Examples</a></li>
      <li class="breadcrumb-item active">Atlas mapping</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_external/atlas_mapping.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Atlas-mapping">
<h1>Atlas mapping<a class="headerlink" href="#Atlas-mapping" title="Permalink to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># import brain atlas and brain regions objects
from ibllib.atlas import AllenAtlas
from ibllib.atlas.regions import BrainRegions
ba = AllenAtlas()
br = BrainRegions() # br is also an attribute of ba so could to br = ba.regions
</pre></div>
</div>
</div>
<section id="Available-Mappings">
<h2>Available Mappings<a class="headerlink" href="#Available-Mappings" title="Permalink to this heading"></a></h2>
<p>Three mappings are currently available within the IBL, these are:</p>
<ol class="arabic simple">
<li><p>Allen Atlas - total of 1328 annotation regions provided by Allen Atlas</p></li>
<li><p>Beryl Atlas - total of 310 annotation regions</p></li>
<li><p>Cosmos Atlas - total of 12 annotation regions</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># create figure
import matplotlib.pyplot as plt
fig, axs = plt.subplots(1, 3, figsize=(15, 18))

# plot coronal slice at ap = -2000 um
ap = -2000 / 1e6
# Allen mapping
ba.plot_cslice(ap, volume=&#39;annotation&#39;, mapping=&#39;Allen&#39;, ax=axs[0])
_ = axs[0].set_title(&#39;Allen&#39;)
# Beryl mapping
ba.plot_cslice(ap, volume=&#39;annotation&#39;, mapping=&#39;Beryl&#39;, ax=axs[1])
_ = axs[1].set_title(&#39;Beryl&#39;)
# Cosmos mapping
ba.plot_cslice(ap, volume=&#39;annotation&#39;, mapping=&#39;Cosmos&#39;, ax=axs[2])
_ = axs[2].set_title(&#39;Cosmos&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_atlas_mapping_3_0.png" src="../_images/notebooks_external_atlas_mapping_3_0.png" />
</div>
</div>
</section>
<section id="Understanding-the-mappings">
<h2>Understanding the mappings<a class="headerlink" href="#Understanding-the-mappings" title="Permalink to this heading"></a></h2>
<p>The mappings store the highest level annotation (or parent node) that should be considered. Any regions that are children of these nodes are assigned the same annotation as their parent.</p>
<p>For example, consider the region with the acronym <strong>MDm</strong> (Mediodorsal nucleus of the thalamus, medial part). Firstly, to navigate ourselves, we can find the acronyms of all the ancestors to this region,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># First find the atlas_id associated with acronym MDm
atlas_id = br.acronym2id(&#39;MDm&#39;)
# Then find the acronyms of the ancestors of this region
print(br.ancestors(ids=atlas_id)[&#39;acronym&#39;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;root&#39; &#39;grey&#39; &#39;BS&#39; &#39;IB&#39; &#39;TH&#39; &#39;DORpm&#39; &#39;MED&#39; &#39;MD&#39; &#39;MDm&#39;]
</pre></div></div>
</div>
<p>We can then take a look at what acronym this region will be assigned under the different mappings. Under the Allen mapping we expect it to be assigned the same acronym as this is the lowest level region parcelation that we use.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(br.acronym2acronym(&#39;MDm&#39;, mapping=&#39;Allen&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;MDm&#39;]
</pre></div></div>
</div>
<p>Under the Beryl mapping, <strong>MDm</strong> is given the acronym of it’s parent, <strong>MD</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(br.acronym2acronym(&#39;MDm&#39;, mapping=&#39;Beryl&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;MD&#39;]
</pre></div></div>
</div>
<p>Under the Cosmos mapping, it is assigned to the region <strong>TH</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(br.acronym2acronym(&#39;MDm&#39;, mapping=&#39;Cosmos&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;TH&#39;]
</pre></div></div>
</div>
<p>Therefore any clusters that are assigned an acronym <strong>MDm</strong> in the Allen mapping, will instead be assigned to the region <strong>MD</strong> in the Beryl mapping and <strong>TH</strong> in the Cosmos mapping.</p>
<p>If a region is not included in a mapping, the value for this region is set to root. For example <strong>TH</strong> is not included in the Beryl mapping</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(br.acronym2acronym(&#39;TH&#39;, mapping=&#39;Beryl&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;root&#39;]
</pre></div></div>
</div>
</section>
<section id="Lateralisation">
<h2>Lateralisation<a class="headerlink" href="#Lateralisation" title="Permalink to this heading"></a></h2>
<p>Lateralised versions of each of the three mappings are also available. This allow regions on the left and right hemispheres of the brain to be differentiated.</p>
<p>The convention used is that regions in the left hemisphere have negative atlas ids whereas those on the right hemisphere have positive atlas ids.</p>
<p>For the non lateralised mappings the atlas id is always positive regardless of whether the region lies in the left or right hemisphere. Aggregating values over regions could result, therefore, in values from different hemispheres being considered together.</p>
<p>One thing to be aware of, is that while lateralised mappings return distinct atlas ids for the left and right hemispheres, the acronyms returned are not lateralised.</p>
<p>For example consider findng the atlas id when mapping the acronym <strong>MDm</strong> onto the Beryl atlas. When specifying the left hemisphere, the returned atlas id is negative</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Left hemisphere gives negative atlas id
print(br.acronym2id(&#39;MDm&#39;, mapping=&#39;Beryl-lr&#39;, hemisphere=&#39;left&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-362]
</pre></div></div>
</div>
<p>When specifying the right hemisphere, the returned atlas id is positive</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Left hemisphere gives negative atlas id
print(br.acronym2id(&#39;MDm&#39;, mapping=&#39;Beryl-lr&#39;, hemisphere=&#39;right&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[362]
</pre></div></div>
</div>
<p>However, when converting from atlas id to acronym, regardless of whether we specify a negative (left hemisphere) or positive (right hemisphere) value, the returned acronym is always the same</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(br.id2acronym(-362, mapping=&#39;Beryl-lr&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;MD&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(br.id2acronym(362, mapping=&#39;Beryl-lr&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;MD&#39;]
</pre></div></div>
</div>
</section>
<section id="How-to-map-your-data">
<h2>How to map your data<a class="headerlink" href="#How-to-map-your-data" title="Permalink to this heading"></a></h2>
<section id="Mapping-from-mlapdv-coordinates">
<h3>Mapping from mlapdv coordinates<a class="headerlink" href="#Mapping-from-mlapdv-coordinates" title="Permalink to this heading"></a></h3>
<p>The recommended and most versatile way to find the locations of clusters under different mappings is to use the mlapdv coordinates of the clusters. Given a probe insertion id, the clusters object can be loaded in using the following code</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from brainbox.io.one import SpikeSortingLoader
from one.api import ONE
one = ONE()

pid = &#39;da8dfec1-d265-44e8-84ce-6ae9c109b8bd&#39;

sl = SpikeSortingLoader(pid=pid, one=one, atlas=ba)
spikes, clusters, channels = sl.load_spike_sorting()
clusters = sl.merge_clusters(spikes, clusters, channels)
</pre></div>
</div>
</div>
<p>You will find that the cluster object returned already contains an atlas_id attribute. These are the atlas ids that are obtained using the default mapping - <strong>non lateralised Allen</strong>. For this mapping regardless of whether the clusters lie in the right or left hemisphere the clusters are assigned positive atlas ids</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(clusters[&#39;atlas_id&#39;][0:10])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[596 596 596 596 596 596 596 596 596 596]
</pre></div></div>
</div>
<p>We can obtain the mlapdv coordinates of the clusters and explore in which hemisphere the clusters lie, clusters with negative x lie on the left hemisphere.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
mlapdv = np.c_[clusters[&#39;x&#39;], clusters[&#39;y&#39;], clusters[&#39;z&#39;]] # x = ml, y = ap, z = dv
clus_LH = np.sum(mlapdv[:, 0] &lt; 0)
clus_RH = np.sum(mlapdv[:, 0] &gt; 0)
print(f&#39;Total clusters = {len(mlapdv)}, LH clusters = {clus_LH}, RH clusters = {clus_RH}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total clusters = 914, LH clusters = 914, RH clusters = 0
</pre></div></div>
</div>
<p>To get a better understanding of the difference between using lateralised and non-lateralised mappings, let’s also make a manipulated version of the mlapdv positions where the first 5 clusters have been moved into the right hemisphere and call this <code class="docutils literal notranslate"><span class="pre">mlapdv_rh</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mlapdv_rh = np.copy(mlapdv)
mlapdv_rh[0:5, 0] = -1 * mlapdv_rh[0:5, 0]
clus_LH = np.sum(mlapdv_rh[:, 0] &lt; 0)
clus_RH = np.sum(mlapdv_rh[:, 0] &gt; 0)
print(f&#39;Total clusters = {len(mlapdv_rh)}, LH clusters = {clus_LH}, RH clusters = {clus_RH}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total clusters = 914, LH clusters = 909, RH clusters = 5
</pre></div></div>
</div>
<p>To find the locations of the clusters in the brain from the mlapdv position we can use the <a class="reference external" href="https://int-brain-lab.github.io/iblenv/_autosummary/ibllib.atlas.atlas.html#ibllib.atlas.atlas.BrainAtlas.get_labels">get_labels</a> method in the AllenAtlas object. First let’s explore the output of using a non lateralised mapping.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>atlas_id_Allen = ba.get_labels(mlapdv, mapping=&#39;Allen&#39;)
atlas_id_Allen_rh = ba.get_labels(mlapdv_rh, mapping=&#39;Allen&#39;)
print(f&#39;Non-lateralised Allen mapping ids using mlapdv: {atlas_id_Allen[0:10]}&#39;)
print(f&#39;Non-lateralised Allen mapping ids using mlapdv_rh: {atlas_id_Allen_rh[0:10]}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Non-lateralised Allen mapping ids using mlapdv: [596 596 596 596 596 596 596 596 596 596]
Non-lateralised Allen mapping ids using mlapdv_rh: [596 596 596 596 596 596 596 596 596 596]
</pre></div></div>
</div>
<p>Notice that regardless of whether the clusters lie in the left or right hemisphere the sign of the atlas id is the same. The result of this mapping is also equivalent the default output from <code class="docutils literal notranslate"><span class="pre">clusters['atlas_id']</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>np.array_equal(clusters[&#39;atlas_id&#39;], atlas_id_Allen)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>Out[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Now if we use the lateralised mapping, we notice that the clusters in the left hemisphere have been assigned negative atlas ids whereas those in the right hemisphere have positive atlas ids</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>atlas_id_Allen = ba.get_labels(mlapdv, mapping=&#39;Allen-lr&#39;)
atlas_id_Allen_rh = ba.get_labels(mlapdv_rh, mapping=&#39;Allen-lr&#39;)
print(f&#39;Lateralised Allen mapping ids using mlapdv: {atlas_id_Allen[0:10]}&#39;)
print(f&#39;Lateralised Allen mapping ids using mlapdv_rh: {atlas_id_Allen_rh[0:10]}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lateralised Allen mapping ids using mlapdv: [-596 -596 -596 -596 -596 -596 -596 -596 -596 -596]
Lateralised Allen mapping ids using mlapdv_rh: [ 596  596  596  596  596 -596 -596 -596 -596 -596]
</pre></div></div>
</div>
<p>By changing the mapping argument that we pass in, we can also easily obtain the atlas ids for the Beryl and Cosmos mappings</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>atlas_id_Beryl = ba.get_labels(mlapdv_rh, mapping=&#39;Beryl-lr&#39;)
atlas_id_Cosmos = ba.get_labels(mlapdv_rh, mapping=&#39;Cosmos&#39;)
print(f&#39;Lateralised Beryl mapping ids using mlapdv_rh: {atlas_id_Beryl[0:10]}&#39;)
print(f&#39;Non-lateralised Cosmos mapping ids using mlapdv_rh: {atlas_id_Cosmos[0:10]}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lateralised Beryl mapping ids using mlapdv_rh: [ 596  596  596  596  596 -596 -596 -596 -596 -596]
Non-lateralised Cosmos mapping ids using mlapdv_rh: [623 623 623 623 623 623 623 623 623 623]
</pre></div></div>
</div>
</section>
<section id="Mapping-from-atlas-ids">
<h3>Mapping from atlas ids<a class="headerlink" href="#Mapping-from-atlas-ids" title="Permalink to this heading"></a></h3>
<p>Methods are available that allow you to translate atlas ids from one mapping to another.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># map atlas ids from lateralised Allen to lateralised Beryl
atlas_id_Allen = ba.get_labels(mlapdv_rh, mapping=&#39;Allen-lr&#39;) # lateralised Allen

remap_beryl = br.id2id(atlas_id_Allen, mapping=&#39;Beryl-lr&#39;)
print(f&#39;Lateralised Beryl mapping ids using remap: {remap_beryl[0:10]}&#39;)

# map atlas ids from lateralised Allen to non-lateralised Cosmos
remap_cosmos = br.id2id(atlas_id_Allen_rh, mapping=&#39;Cosmos&#39;)
print(f&#39;Non-lateralised Cosmos mapping ids using remap: {remap_cosmos[0:10]}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lateralised Beryl mapping ids using remap: [ 596  596  596  596  596 -596 -596 -596 -596 -596]
Non-lateralised Cosmos mapping ids using remap: [623 623 623 623 623 623 623 623 623 623]
</pre></div></div>
</div>
<p>When remapping with atlas ids it is not possible to map from</p>
<ol class="arabic simple">
<li><p>A non-lateralised to a lateralised mapping.</p></li>
<li><p>From a higher mapping to a lower one (e.g cannot map from Beryl to Allen, or Cosmos to Allen)</p></li>
<li><p>From Beryl to Cosmos</p></li>
</ol>
<p>This is why it is recommened to use mlapdv coordinates for remappings as it allows complete flexibility</p>
</section>
<section id="Converting-to-acronyms">
<h3>Converting to acronyms<a class="headerlink" href="#Converting-to-acronyms" title="Permalink to this heading"></a></h3>
<p>Methods are available to convert between atlas ids and acronyms. Note that when converting to acronyms, even if the atlas ids are lateralised the returned acronyms are not</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>atlas_id_Allen = ba.get_labels(mlapdv_rh, mapping=&#39;Allen-lr&#39;) # lateralised Allen
acronym_Allen = br.id2acronym(atlas_id_Allen, mapping=&#39;Allen-lr&#39;)
print(f&#39;Acronyms of lateralised Allen ids: {acronym_Allen[0:10]}&#39;)

atlas_id_Allen = ba.get_labels(mlapdv_rh, mapping=&#39;Allen-lr&#39;) # Non-ateralised Allen
acronym_Allen = br.id2acronym(atlas_id_Allen)
print(f&#39;Acronyms of non-lateralised Allen: {acronym_Allen[0:10]}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acronyms of lateralised Allen ids: [&#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39;]
Acronyms of non-lateralised Allen: [&#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39; &#39;NDB&#39;]
</pre></div></div>
</div>
<p>It is also possible to simultaneously remap the acronyms with these methods</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>acronym_Cosmos = br.id2acronym(atlas_id_Allen, mapping=&#39;Cosmos-lr&#39;)
print(acronym_Cosmos[0:10])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39; &#39;CNU&#39;]
</pre></div></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../atlas_examples.html" class="btn btn-neutral float-left" title="Atlas Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="atlas_plotting_scalar_on_slice.html" class="btn btn-neutral float-right" title="Plotting brain region values on histology slices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>