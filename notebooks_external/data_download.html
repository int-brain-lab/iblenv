<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=17142d56" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Loading Data" href="../loading_examples.html" />
    <link rel="prev" title="Get to know the datasets and folder structure" href="data_structure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Environment">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Install-packages">Install packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Setting-up-credentials">Setting up credentials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Explore-and-download-data-using-the-ONE-api">Explore and download data using the ONE-api</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Useful-links">Useful links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Launch-the-ONE-api">Launch the ONE-api</a></li>
<li class="toctree-l2"><a class="reference internal" href="#List-all-sessions-available">List all sessions available</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Find-a-session-that-has-a-dataset-of-interest">Find a session that has a dataset of interest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Find-data-associated-with-a-release-or-publication">Find data associated with a release or publication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Downloading-data-using-the-ONE-api">Downloading data using the ONE-api</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Loading-different-objects">Loading different objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Advanced-examples">Advanced examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Example-1:-Searching-for-sessions-from-a-specific-lab">Example 1: Searching for sessions from a specific lab</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_screen_stimulus.html">Computing the stimulus position using the wheel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_external/data_download.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Installation">
<h1>Installation<a class="headerlink" href="#Installation" title="Link to this heading"></a></h1>
<section id="Environment">
<h2>Environment<a class="headerlink" href="#Environment" title="Link to this heading"></a></h2>
<p>To use IBL data you will need a python environment with python &gt; 3.8. To create a new environment from scratch you can install <a class="reference external" href="https://www.anaconda.com/products/distribution#download-section">anaconda</a> and follow the instructions below to create a new python environment (more information can also be found <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">here</a>)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conda create --name ibl python=3.11
</pre></div>
</div>
<p>Make sure to always activate this environment before installing or working with the IBL data</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conda activate ibl
</pre></div>
</div>
</section>
<section id="Install-packages">
<h2>Install packages<a class="headerlink" href="#Install-packages" title="Link to this heading"></a></h2>
<p>To use IBL data you will need to install the ONE-api package. We also recommend installing ibllib. These can be installed via pip.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">ONE</span><span class="o">-</span><span class="n">api</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">ibllib</span>
</pre></div>
</div>
</section>
<section id="Setting-up-credentials">
<h2>Setting up credentials<a class="headerlink" href="#Setting-up-credentials" title="Link to this heading"></a></h2>
<p>Credentials can be setup in a python terminal in the following way</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>

<span class="n">ONE</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;https://openalyx.internationalbrainlab.org&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;international&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Explore-and-download-data-using-the-ONE-api">
<h1>Explore and download data using the ONE-api<a class="headerlink" href="#Explore-and-download-data-using-the-ONE-api" title="Link to this heading"></a></h1>
<section id="Useful-links">
<h2>Useful links<a class="headerlink" href="#Useful-links" title="Link to this heading"></a></h2>
<p>To get a good understanding of the ONE-api and the various methods available we recommend working through these tutorials.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://int-brain-lab.github.io/iblenv/notebooks_external/one_quickstart.html">ONE quickstart</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/ONE/notebooks/one_search/one_search.html">Searching with ONE</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/ONE/notebooks/one_list/one_list.html">Listing with ONE</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/ONE/notebooks/one_load/one_load.html">Loading with ONE</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/ONE/notebooks/one_advanced/one_advanced.html">ONE Alyx REST API</a> (advanced)</p></li>
</ul>
<p>Further examples are given below.</p>
</section>
<section id="Launch-the-ONE-api">
<h2>Launch the ONE-api<a class="headerlink" href="#Launch-the-ONE-api" title="Link to this heading"></a></h2>
<p>Prior to do any searching / downloading, you need to instantiate ONE :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;https://openalyx.internationalbrainlab.org&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="List-all-sessions-available">
<h2>List all sessions available<a class="headerlink" href="#List-all-sessions-available" title="Link to this heading"></a></h2>
<p>Once ONE is instantiated, you can use the REST ONE-api to list all sessions publicly available:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Each session is given a unique identifier (eID); this eID is what you will use to download data for a given session:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Each session is represented by a unique experiment id (eID)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sessions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
adf19ea1-aa1e-4e0a-ab8b-59be2dfaeebe
</pre></div></div>
</div>
</section>
<section id="Find-a-session-that-has-a-dataset-of-interest">
<h2>Find a session that has a dataset of interest<a class="headerlink" href="#Find-a-session-that-has-a-dataset-of-interest" title="Link to this heading"></a></h2>
<p>Not all sessions will have all the datasets available. As such, it may be important for you to filter and search for only sessions with particular datasets of interest. The detailed list of datasets can be found in this <a class="reference external" href="https://docs.google.com/document/d/1OqIqqakPakHXRAwceYLwFY9gOrm8_P62XIfCTnHwstg/edit#">document</a>.</p>
<p>In the example below, we want to find all sessions that have <code class="docutils literal notranslate"><span class="pre">spikes.times</span></code> data:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find sessions that have spikes.times datasets</span>
<span class="n">sessions_with_spikes</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;spikes.times&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><a class="reference external" href="https://int-brain-lab.github.io/ONE/notebooks/one_search/one_search.html">Click here</a> for a complete guide to searching using ONE.</p>
</section>
<section id="Find-data-associated-with-a-release-or-publication">
<h2>Find data associated with a release or publication<a class="headerlink" href="#Find-data-associated-with-a-release-or-publication" title="Link to this heading"></a></h2>
<p>Datasets are often associated to a publication, and are tagged as such to facilitate reproducibility of analysis. You can list all tags and their associated publications like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List and print all tags in the public database</span>
<span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">]}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2021_Q1_IBL_et_al_Behaviour
https://doi.org/10.7554/eLife.63711

2021_Q2_PreRelease
https://figshare.com/articles/online_resource/Spike_sorting_pipeline_for_the_International_Brain_Laboratory/19705522/3

2021_Q2_Varol_et_al
https://doi.org/10.1109/ICASSP39728.2021.9414145

2021_Q3_Whiteway_et_al
https://doi.org/10.1371/journal.pcbi.1009439

2022_Q2_IBL_et_al_RepeatedSite
https://doi.org/10.1101/2022.05.09.491042

2022_Q3_IBL_et_al_DAWG
https://doi.org/10.1101/827873

2022_Q4_IBL_et_al_BWM
https://figshare.com/articles/preprint/Data_release_-_Brainwide_map_-_Q4_2022/21400815

2023_Q1_Biderman_Whiteway_et_al


2023_Q1_Mohammadi_et_al


2023_Q3_Findling_Hubert_et_al
https://doi.org/10.1101/2023.07.04.547684

2023_Q4_Bruijns_et_al


2023_Q4_IBL_et_al_BWM_2


2023_Q4_IBL_et_al_BWM_passive


Brainwidemap


</pre></div></div>
</div>
<p>You can use the tag to restrict your searches to a specific data release and as a filter when browsing the public database:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Note that tags are associated with datasets originally</span>
<span class="c1"># You can load a local index of sessions and datasets associated with a specific data release</span>
<span class="n">one</span><span class="o">.</span><span class="n">load_cache</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;2022_Q2_IBL_et_al_RepeatedSite&#39;</span><span class="p">)</span>
<span class="n">sessions_rep_site</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>  <span class="c1"># All sessions used in the repeated site paper</span>

<span class="c1"># Find insertions that are tagged</span>
<span class="c1"># (you do not have access to the tag endpoint from the insertion list, so you need to create a django query)</span>
<span class="n">ins_str_query</span> <span class="o">=</span> <span class="s1">&#39;datasets__tags__name,2022_Q2_IBL_et_al_RepeatedSite&#39;</span>
<span class="n">insertions_rep_site</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;insertions&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">=</span><span class="n">ins_str_query</span><span class="p">)</span>

<span class="c1"># To return to the full cache containing an index of all IBL experiments</span>
<span class="n">ONE</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;https://openalyx.internationalbrainlab.org&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Downloading-data-using-the-ONE-api">
<h2>Downloading data using the ONE-api<a class="headerlink" href="#Downloading-data-using-the-ONE-api" title="Link to this heading"></a></h2>
<p>Once sessions of interest are identified with the unique identifier (eID), all files ready for analysis are found in the <strong>alf</strong> collection:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find an example session with data</span>
<span class="n">eid</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;alf/&#39;</span><span class="p">)</span>
<span class="c1"># List datasets associated with a session, in the alf collection</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;alf*&#39;</span><span class="p">)</span>

<span class="c1"># Download all data in alf collection</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;alf&#39;</span><span class="p">,</span> <span class="n">download_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Show where files have been downloaded to</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Files downloaded to </span><span class="si">{</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Files downloaded to /home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/churchlandlab_ucla/Subjects/MFD_09/2023-10-20/001/alf
</pre></div></div>
</div>
<p>To download the spike sorting data we need to find out which probe label (<code class="docutils literal notranslate"><span class="pre">probeXX</span></code>) was used for this session. This can be done by finding the probe insertion associated with this session.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find an example session with spike data</span>
<span class="c1"># Note: Restricting by task and project makes searching for data much quicker</span>
<span class="n">eid</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;brainwide&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;spikes&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s1">&#39;ephys&#39;</span><span class="p">)</span>

<span class="c1"># Data for each probe insertion are stored in the alf/probeXX folder.</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;alf/probe*&#39;</span><span class="p">)</span>
<span class="n">probe_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">)</span>  <span class="c1"># List the insertions</span>

<span class="c1"># You can find full details of a session&#39;s insertions using the following database query:</span>
<span class="n">insertions</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;insertions&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">eid</span><span class="p">)</span>
<span class="n">probe_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">ins</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ins</span> <span class="ow">in</span> <span class="n">insertions</span><span class="p">]</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;alf/</span><span class="si">{</span><span class="n">probe_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">/pykilosort&#39;</span><span class="p">,</span> <span class="n">download_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Show where files have been downloaded to</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Files downloaded to </span><span class="si">{</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Files downloaded to /home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/churchlandlab_ucla/Subjects/MFD_09/2023-10-19/001/alf/probe00/pykilosort
</pre></div></div>
</div>
</section>
<section id="Loading-different-objects">
<h2>Loading different objects<a class="headerlink" href="#Loading-different-objects" title="Link to this heading"></a></h2>
<p>To load in the data we can use some of the following loading methods.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in all trials datasets</span>
<span class="n">trials</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;trials&#39;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;alf&#39;</span><span class="p">)</span>

<span class="c1"># Load in a single wheel dataset</span>
<span class="n">wheel_times</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;_ibl_wheel.timestamps.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Examples for loading different objects can be found in the following tutorials <a class="reference external" href="https://int-brain-lab.github.io/iblenv/loading_examples.html">here</a>.</p>
</section>
<section id="Advanced-examples">
<h2>Advanced examples<a class="headerlink" href="#Advanced-examples" title="Link to this heading"></a></h2>
<section id="Example-1:-Searching-for-sessions-from-a-specific-lab">
<h3>Example 1: Searching for sessions from a specific lab<a class="headerlink" href="#Example-1:-Searching-for-sessions-from-a-specific-lab" title="Link to this heading"></a></h3>
<p>Let’s imagine you are interested in obtaining the data from a given lab, that was part of the Reproducible Ephys data release. If you want to use data associated to a given lab only, you could simply query for the whole dataset as shown above, and filter <code class="docutils literal notranslate"><span class="pre">sessions_rep_site</span></code> for the key “lab” of a given value, for example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="n">one</span><span class="o">.</span><span class="n">load_cache</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;2022_Q2_IBL_et_al_RepeatedSite&#39;</span><span class="p">)</span>
<span class="n">sessions_lab</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lab</span><span class="o">=</span><span class="s1">&#39;mrsicflogellab&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>However, if you wanted to query only the data for a given lab, it might be most judicious to first know the list of all labs available, select an arbitrary lab name from it, and query the specific sessions from it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List details of all sessions (returns a list of dictionaries)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">labs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">det</span><span class="p">)</span>  <span class="c1"># Get the set of unique labs</span>

<span class="c1"># Example lab name</span>
<span class="n">lab_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Searching for RS sessions with specific lab name</span>
<span class="n">sessions_lab</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;spikes&#39;</span><span class="p">,</span> <span class="n">lab</span><span class="o">=</span><span class="n">lab_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can also get this list, using <a class="reference external" href="https://int-brain-lab.github.io/ONE/notebooks/one_advanced/one_advanced.html">one.alyx.rest</a>, however it is a little slower.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of labs (and all metadata information associated)</span>
<span class="n">labs</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;labs&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                     <span class="n">django</span><span class="o">=</span><span class="s1">&#39;session__data_dataset_session_related__tags__name,2022_Q2_IBL_et_al_RepeatedSite&#39;</span><span class="p">)</span>
<span class="c1"># Note the change in the django filter compared to searching over &#39;sessions&#39;</span>

<span class="c1"># Example lab name</span>
<span class="n">lab_name</span> <span class="o">=</span> <span class="n">labs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="c1"># e.g. &#39;mrsicflogellab&#39;</span>

<span class="c1"># Searching for RS sessions with specific lab name</span>
<span class="n">sessions_lab</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">dataset_types</span><span class="o">=</span><span class="s1">&#39;spikes.times&#39;</span><span class="p">,</span> <span class="n">lab</span><span class="o">=</span><span class="n">lab_name</span><span class="p">,</span>
                             <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;2022_Q2_IBL_et_al_RepeatedSite&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_structure.html" class="btn btn-neutral float-left" title="Get to know the datasets and folder structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../loading_examples.html" class="btn btn-neutral float-right" title="Loading Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>