<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loading Multi-photon Calcium Imaging Data &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=17142d56" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html">Download the public datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Loading Multi-photon Calcium Imaging Data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_external/loading_multi_photon_imaging_data.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Loading-Multi-photon-Calcium-Imaging-Data">
<h1>Loading Multi-photon Calcium Imaging Data<a class="headerlink" href="#Loading-Multi-photon-Calcium-Imaging-Data" title="Link to this heading"></a></h1>
<p>Cellular Calcium activity recorded using a multi-photon imaging.</p>
<section id="Relevant-ALF-objects">
<h2>Relevant ALF objects<a class="headerlink" href="#Relevant-ALF-objects" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>mpci</p></li>
<li><p>mpciROIs</p></li>
<li><p>mpciROITypes</p></li>
<li><p>mpciMeanImage</p></li>
<li><p>mpciStack</p></li>
</ul>
</section>
<section id="Terminology">
<h2>Terminology<a class="headerlink" href="#Terminology" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>ROI</strong> - A region of interest, usually a neuron soma, detected using an algorithm such as Suite2P.</p></li>
<li><p><strong>FOV</strong> - A field of view is a plane or volume covering a region of the brain.</p></li>
<li><p><strong>Imaging stack</strong> - Multiple FOVs acquired at different depths along the same z axis.</p></li>
</ul>
</section>
<section id="Finding-sessions-with-imaging-data">
<h2>Finding sessions with imaging data<a class="headerlink" href="#Finding-sessions-with-imaging-data" title="Link to this heading"></a></h2>
<p>Sessions that contain any form of imaging data have an ‘Imaging’ procedure. This includes sessions photometry, mesoscope, 2P, and widefield data. To further filter by imaging modality you can query the imaging type associated with a session’s field of view.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find mesoscope imaging sessions</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">one</span><span class="o">.</span><span class="n">offline</span><span class="p">,</span> <span class="s1">&#39;ONE must be connect to Alyx for searching imaging sessions&#39;</span>

<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;field_of_view__imaging_type__name,mesoscope&#39;</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">procedures</span><span class="o">=</span><span class="s1">&#39;Imaging&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Sessions can be further filtered by brain region. You can filter with by Allen atlas name, acronym or ID, for example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">atlas_name='Primary</span> <span class="pre">visual</span> <span class="pre">area'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atlas_acronym='VISp'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atlas_id=385</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find mesoscope imaging sessions in V1, layer 2/3</span>
<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;field_of_view__imaging_type__name,mesoscope&#39;</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">procedures</span><span class="o">=</span><span class="s1">&#39;Imaging&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="n">atlas_acronym</span><span class="o">=</span><span class="s1">&#39;VISp2/3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The ‘details’ flag will return the session details, including a <code class="docutils literal notranslate"><span class="pre">field_of_view</span></code> field which contains a list of each field of view and its location. All preprocessed mpci imaging data is in <code class="docutils literal notranslate"><span class="pre">alf/FOV_XX</span></code> where XX is the field of view number. The <code class="docutils literal notranslate"><span class="pre">FOV_XX</span></code> corresponds to a field of view name in Alyx.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eids</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">procedures</span><span class="o">=</span><span class="s1">&#39;Imaging&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="n">atlas_acronym</span><span class="o">=</span><span class="s1">&#39;VISp2/3&#39;</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">FOVs</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;field_of_view&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">FOVs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>The ibllib AllenAtlas class allows you to search brain region descendents and ancestors in order to find the IDs of brain regions at a certain granularity.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search brain areas by name using Alyx</span>
<span class="n">V1</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;brain-regions&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Primary visual area&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">V1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">: </span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="s1">&#39;acronym&#39;</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>


<span class="kn">from</span> <span class="nn">iblatlas.atlas</span> <span class="kn">import</span> <span class="n">AllenAtlas</span>
<span class="n">atlas</span> <span class="o">=</span> <span class="n">AllenAtlas</span><span class="p">()</span>

<span class="c1"># Interconvert ID and acronym</span>
<span class="n">V1_id</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">acronym2id</span><span class="p">(</span><span class="s1">&#39;VISp&#39;</span><span class="p">)</span>
<span class="n">V1_acronym</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">id2acronym</span><span class="p">(</span><span class="n">V1_id</span><span class="p">)</span>

<span class="c1"># Show all descendents of primary visual area (i.e. all layers)</span>
<span class="n">atlas</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">V1_id</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information see “<a class="reference external" href="../atlas_working_with_ibllib_atlas.html">Working with ibllib atlas</a>”.</p>
</section>
<section id="Loading-imaging-data-for-a-given-field-of-view">
<h2>Loading imaging data for a given field of view<a class="headerlink" href="#Loading-imaging-data-for-a-given-field-of-view" title="Link to this heading"></a></h2>
<p>For mesoscope sessions there are likely more than one field of view, not all of which cover the area of interest. For mesoscope sessions it’s therefore more useful to search by field of view instead. Each field of view returned contains a session eid for loading data with.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search for all mesoscope fields of view containing V1</span>
<span class="n">FOVs</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;fields-of-view&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">imaging_type</span><span class="o">=</span><span class="s1">&#39;mesoscope&#39;</span><span class="p">,</span> <span class="n">atlas_acronym</span><span class="o">=</span><span class="s1">&#39;VISp&#39;</span><span class="p">)</span>
<span class="c1"># Download all data for the first field of view</span>
<span class="n">FOV_00</span>  <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span><span class="n">FOVs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;session&#39;</span><span class="p">],</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">FOVs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<span class="c1"># Search the fields of view for a specific session that took place in a given brain region</span>
<span class="n">eid</span> <span class="o">=</span> <span class="s1">&#39;a5550a8e-2484-4539-b7f0-8e5f829d0ba7&#39;</span>
<span class="n">FOVs</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;fields-of-view&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">imaging_type</span><span class="o">=</span><span class="s1">&#39;mesoscope&#39;</span><span class="p">,</span> <span class="n">atlas_id</span><span class="o">=</span><span class="mi">187</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">eid</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="Loading-imaging-stacks">
<h2>Loading imaging stacks<a class="headerlink" href="#Loading-imaging-stacks" title="Link to this heading"></a></h2>
<p>For mesoscope sessions the same region may be acquired at multiple depths. The plane at each depth is considered a separate field of view and are related to one another through the stack object. If a field of view was acquired as part of a stack, the <code class="docutils literal notranslate"><span class="pre">stack</span></code> field will contain an ID. You can find all fields of view in a given stack by querying the ‘imaging-stack’ endpoint:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stack</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;imaging-stack&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">FOVs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;stack&#39;</span><span class="p">])</span>
<span class="n">FOVs</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="s1">&#39;slices&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There were </span><span class="si">%i</span><span class="s1"> fields of view in stack </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FOVs</span><span class="p">),</span> <span class="n">stack</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<section id="List-the-number-of-fields-of-view-(FOVs)-recorded-during-a-session">
<h3>List the number of fields of view (FOVs) recorded during a session<a class="headerlink" href="#List-the-number-of-fields-of-view-(FOVs)-recorded-during-a-session" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span>
<span class="n">eid</span> <span class="o">=</span> <span class="s1">&#39;b1ca324f-5db7-4106-8be2-0dd9cce17648&#39;</span>

<span class="n">fov_folders</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">list_collections</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="s1">&#39;alf/FOV_*&#39;</span><span class="p">)</span>
<span class="n">fovs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]),</span> <span class="n">fov_folders</span><span class="p">))</span>
<span class="n">nFOV</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fovs</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="Loading-ROI-activity-for-a-single-session">
<h2>Loading ROI activity for a single session<a class="headerlink" href="#Loading-ROI-activity-for-a-single-session" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading ROI activity for a single FOV</span>
<span class="n">ROI_data_00</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;alf/FOV_00&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mpci&#39;</span><span class="p">,</span> <span class="s1">&#39;mpciROIs&#39;</span><span class="p">,</span> <span class="s1">&#39;mpciROITypes&#39;</span><span class="p">,</span> <span class="s1">&#39;mpciStack&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ROI_data_00</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Loading ROI activity for all FOVs</span>
<span class="n">all_ROI_data</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;alf/FOV_*&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mpci&#39;</span><span class="p">,</span> <span class="s1">&#39;mpciROIs&#39;</span><span class="p">,</span> <span class="s1">&#39;mpciROITypes&#39;</span><span class="p">,</span> <span class="s1">&#39;mpciStack&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">all_ROI_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">all_ROI_data</span><span class="o">.</span><span class="n">FOV_00</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<section id="Get-the-brain-location-of-an-ROI">
<h3>Get the brain location of an ROI<a class="headerlink" href="#Get-the-brain-location-of-an-ROI" title="Link to this heading"></a></h3>
<p>The brain location of each ROI are first estimated using the surgical coordinates of the imaging window. These datasets have an ‘_estimate’ in the name. After histological alignment, datasets are created without ‘_estimate’ in the name. The histologically aligned locations are most accurate and should be used where available.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># The ROI index to lookup</span>
<span class="n">final_alignment</span> <span class="o">=</span>  <span class="s1">&#39;brainLocationsIds_ccf_2017&#39;</span> <span class="ow">in</span> <span class="n">ROI_data_00</span><span class="p">[</span><span class="s1">&#39;mpciROI&#39;</span><span class="p">]</span>
<span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;brainLocationsIds_ccf_2017&#39;</span> <span class="k">if</span> <span class="n">final_alignment</span> <span class="k">else</span> <span class="s1">&#39;brainLocationsIds_ccf_2017_estimate&#39;</span>

<span class="n">atlas_id</span> <span class="o">=</span> <span class="n">ROI_data_00</span><span class="p">[</span><span class="s1">&#39;mpciROI&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">roi</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ROI </span><span class="si">{</span><span class="n">roi</span><span class="si">}</span><span class="s1"> was located in </span><span class="si">{</span><span class="n">atlas</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">id2acronym</span><span class="p">(</span><span class="n">atlas_id</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="Loading-times">
<h2>Loading times<a class="headerlink" href="#Loading-times" title="Link to this heading"></a></h2>
<p>Timestamps for each frame are in seconds from session start and represent the time when frame acquisition started. Typically a laser scans each voxel in the field of view in a line by line fashion (this may vary across apparatus and in configuarations such as dual plane mode). Thus there is a fixed time offset between regions of interest. The offset can be found in the mpciStack.timeshift.npy dataset and depending on its shape, may be per voxel or per scan line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frame_times</span> <span class="o">=</span> <span class="n">ROI_data_00</span><span class="p">[</span><span class="s1">&#39;mpci&#39;</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">]</span>
<span class="n">roi_xyz</span> <span class="o">=</span> <span class="n">ROI_data_00</span><span class="p">[</span><span class="s1">&#39;mpciROIs&#39;</span><span class="p">][</span><span class="s1">&#39;stackPos&#39;</span><span class="p">]</span>
<span class="n">timeshift</span> <span class="o">=</span> <span class="n">ROI_data_00</span><span class="p">[</span><span class="s1">&#39;mpciStack&#39;</span><span class="p">][</span><span class="s1">&#39;timeshift&#39;</span><span class="p">]</span>
<span class="n">roi_offsets</span> <span class="o">=</span> <span class="n">timeshift</span><span class="p">[</span><span class="n">roi_xyz</span><span class="p">[:,</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeshift</span><span class="o">.</span><span class="n">shape</span><span class="p">)]]</span>
<span class="c1"># An array of timestamps of shape (n_roi, n_frames)</span>
<span class="n">roi_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="p">(</span><span class="n">roi_offsets</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">roi_offsets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">roi_signal</span> <span class="o">=</span> <span class="n">ROI_data_00</span><span class="p">[</span><span class="s1">&#39;mpci&#39;</span><span class="p">][</span><span class="s1">&#39;ROIActivityF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="n">roi</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># The ROI index to lookup</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">roi_times</span><span class="p">[</span><span class="n">roi</span><span class="p">],</span> <span class="n">roi_signal</span><span class="p">[</span><span class="n">roi</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Timestamps / s&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ROI activity / photodetector units&#39;</span><span class="p">)</span>
</pre></div>
</div>
<section id="Search-for-sessions-with-multi-depth-fields-of-view-(imaging-stacks)">
<h3>Search for sessions with multi-depth fields of view (imaging stacks)<a class="headerlink" href="#Search-for-sessions-with-multi-depth-fields-of-view-(imaging-stacks)" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;field_of_view__stack__isnull,False&#39;</span>
<span class="n">eids</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">procedures</span><span class="o">=</span><span class="s1">&#39;Imaging&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">query_type</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="Search-sessions-with-GCaMP-mice">
<h3>Search sessions with GCaMP mice<a class="headerlink" href="#Search-sessions-with-GCaMP-mice" title="Link to this heading"></a></h3>
<p>…</p>
</section>
</section>
<section id="More-details">
<h2>More details<a class="headerlink" href="#More-details" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/document/d/1OqIqqakPakHXRAwceYLwFY9gOrm8_P62XIfCTnHwstg/edit#heading=h.nvzaz0fozs8h">Description of mesoscope datasets</a></p></li>
<li><p><a class="reference internal" href="loading_raw_mesoscope_data.html"><span class="doc">Loading raw mesoscope data</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>