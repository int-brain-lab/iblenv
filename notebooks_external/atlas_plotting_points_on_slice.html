

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plotting cluster locations on histology slices &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=17142d56" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting brain region values on the Swanson flat map" href="atlas_swanson_flatmap.html" />
    <link rel="prev" title="Plotting brain region values on circular flatmap" href="atlas_circular_pyramidal_flatmap.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_repro_ephys.html">Data Release - Reproducible Ephys</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html#Explore-and-download-data-using-the-ONE-api">Explore and download data using the ONE-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../atlas_examples.html#anatomical-atlases">Anatomical Atlases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="atlas_working_with_ibllib_atlas.html">Working with IBL atlas object</a></li>
<li class="toctree-l3"><a class="reference internal" href="atlas_mapping.html">Atlas mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="atlas_plotting_scalar_on_slice.html">Plotting brain region values on histology slices</a></li>
<li class="toctree-l3"><a class="reference internal" href="atlas_dorsal_cortex_flatmap.html">Plotting brain region values on cortical flatmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="atlas_circular_pyramidal_flatmap.html">Plotting brain region values on circular flatmap</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Plotting cluster locations on histology slices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Data-Preparation">Data Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-1:-Aggregation-methods">Example 1: Aggregation methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-2:-Applying-gaussian-kernels-with-varying-FWHM">Example 2: Applying gaussian kernels with varying FWHM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-3:-Precomputing-Volume">Example 3: Precomputing Volume</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="atlas_swanson_flatmap.html">Plotting brain region values on the Swanson flat map</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../atlas_examples.html#gene-expression">Gene expression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_screen_stimulus.html">Computing the stimulus position using the wheel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../atlas_examples.html">Atlas Examples</a></li>
      <li class="breadcrumb-item active">Plotting cluster locations on histology slices</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_external/atlas_plotting_points_on_slice.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Plotting-cluster-locations-on-histology-slices">
<h1>Plotting cluster locations on histology slices<a class="headerlink" href="#Plotting-cluster-locations-on-histology-slices" title="Link to this heading"></a></h1>
<p>This example walks through various ways to display the 3D location of clusters on histology slices</p>
<section id="Data-Preparation">
<h2>Data Preparation<a class="headerlink" href="#Data-Preparation" title="Link to this heading"></a></h2>
<p>For all examples below the xyz coordinates of each point and an array of values must be provided. Here we load in the spikesorting data for an example probe insertion and set the xyz coordinates to the coordinates of the clusters and the array of values to the firing rate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">one.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ONE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">brainbox.io.one</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpikeSortingLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">iblatlas.atlas</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllenAtlas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span>
<span class="n">ba</span> <span class="o">=</span> <span class="n">AllenAtlas</span><span class="p">()</span>
<span class="n">pid</span> <span class="o">=</span> <span class="s1">&#39;da8dfec1-d265-44e8-84ce-6ae9c109b8bd&#39;</span>
<span class="n">sl</span> <span class="o">=</span> <span class="n">SpikeSortingLoader</span><span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">one</span><span class="o">=</span><span class="n">one</span><span class="p">,</span> <span class="n">atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">)</span>
<span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">load_spike_sorting</span><span class="p">()</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">merge_clusters</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>

<span class="c1"># Extract xyz coords from clusters dict</span>
<span class="c1"># Here we will set all ap values to a chosen value for visualisation purposes</span>
<span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">400</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;firing_rate&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-1:-Aggregation-methods">
<h2>Example 1: Aggregation methods<a class="headerlink" href="#Example-1:-Aggregation-methods" title="Link to this heading"></a></h2>
<p>The values of points that lie within the same voxel within the volume can be aggregated together in different ways by changing the <code class="docutils literal notranslate"><span class="pre">aggr</span></code> argument. Below shows an example where values in each voxel have been aggregated according to the average firing rate of the clusters (left) and according to the count of clusters in each voxel (right)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">iblatlas.plots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_points_on_slice</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># Plot points on the coronal slice at ap=400um overlaid overlaid on brain region boundaries using Allen mapping</span>
<span class="c1"># and a 3D gaussian kernel with fwhm=100um is applied</span>

<span class="c1"># Values in the same voxel are aggregated by the mean</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_points_on_slice</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Allen&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">aggr</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Values in the same voxel are aggregated by the count</span>
<span class="c1"># N.B. can also pass values=None in this case as they are not used in the computation</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">plot_points_on_slice</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Allen&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">aggr</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">show_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_atlas_plotting_points_on_slice_7_0.png" src="../_images/notebooks_external_atlas_plotting_points_on_slice_7_0.png" />
</div>
</div>
<p>The different options for aggregation are listed in the docstring of the function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">plot_points_on_slice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function plot_points_on_slice in module iblatlas.plots:

plot_points_on_slice(xyz, values=None, coord=-1000, slice=&#39;coronal&#39;, mapping=&#39;Allen&#39;, background=&#39;boundary&#39;, cmap=&#39;Reds&#39;, clevels=None, show_cbar=False, aggr=&#39;mean&#39;, fwhm=100, brain_atlas=None, ax=None)
    Plot xyz points on slice. Points that lie in the same voxel within slice are aggregated according to method specified.
    A 3D Gaussian smoothing kernel with distance specified by fwhm is applied to images.

    :param xyz: 3 column array of xyz coordinates of points in metres
    :param values: array of values per xyz coordinates, if no values are given the sum of xyz points in each voxel is
    returned
    :param coord: coordinate of slice in um (not needed when slice=&#39;top&#39;)
    :param slice: orientation of slice, options are &#39;coronal&#39;, &#39;sagittal&#39;, &#39;horizontal&#39;, &#39;top&#39; (top view of brain)
    :param mapping: atlas mapping to use, options are &#39;Allen&#39;, &#39;Beryl&#39; or &#39;Cosmos&#39;
    :param background: background slice to overlay onto, options are &#39;image&#39; or &#39;boundary&#39;
    :param cmap: colormap to use
    :param clevels: min max color levels [cmin, cmax]
    :param show_cbar: whether to add colorbar to axis
    :param aggr: aggregation method. Options are sum, count, mean, std, median, min and max.
    Can also give in custom function (https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.binned_statistic.html)
    :param fwhm: fwhm distance of gaussian kernel in um
    :param brain_atlas: AllenAtlas object
    :param ax: optional axis object to plot on

    :return:

</pre></div></div>
</div>
</section>
<section id="Example-2:-Applying-gaussian-kernels-with-varying-FWHM">
<h2>Example 2: Applying gaussian kernels with varying FWHM<a class="headerlink" href="#Example-2:-Applying-gaussian-kernels-with-varying-FWHM" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot points on the coronal slice at ap=400um overlaid overlaid on Allen dwi image using Cosmos mapping with</span>
<span class="c1"># values aggregated by max</span>

<span class="n">figs</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># FWHM of 100 um</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_points_on_slice</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">aggr</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># FWHM of 300 um</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_points_on_slice</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">aggr</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># FWHM of 0 um</span>
<span class="c1"># if fwhm=0 no gaussian kernal applied</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_points_on_slice</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">aggr</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_atlas_plotting_points_on_slice_11_0.png" src="../_images/notebooks_external_atlas_plotting_points_on_slice_11_0.png" />
</div>
</div>
</section>
<section id="Example-3:-Precomputing-Volume">
<h2>Example 3: Precomputing Volume<a class="headerlink" href="#Example-3:-Precomputing-Volume" title="Link to this heading"></a></h2>
<p>Convolving the 3D volume with the gaussian kernal can take some time to compute, particularly when using a large fwhm value. When exploring the same volume at different coordinates and using different slices it is recommended to precompute the volume and then plot the slices. Below shows an example of how to do this.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">iblatlas.plots</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_volume_from_points</span><span class="p">,</span> <span class="n">plot_volume_on_slice</span>

<span class="c1"># Extract xyz coords from clusters dict</span>
<span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;amp_max&#39;</span><span class="p">]</span>

<span class="c1"># Compute volume</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">compute_volume_from_points</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">aggr</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">ba</span><span class="o">=</span><span class="n">ba</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot points on the coronal slices on brain region boundaries using Beryl maping</span>
<span class="n">figs</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_volume_on_slice</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Beryl&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Oranges&#39;</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ap = 300um&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_volume_on_slice</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Beryl&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Oranges&#39;</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ap = 400um&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_volume_on_slice</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Beryl&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Oranges&#39;</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ap = 500um&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>Out[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;ap = 500um&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_atlas_plotting_points_on_slice_15_1.png" src="../_images/notebooks_external_atlas_plotting_points_on_slice_15_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot points on the saggital slice at ap=-800um overlaid on brain region boundaries using Cosmos mapping</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">plot_volume_on_slice</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">coord</span><span class="o">=-</span><span class="mi">800</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;sagittal&#39;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;Cosmos&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">,</span> <span class="n">clevels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2e-7</span><span class="p">],</span> <span class="n">show_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_atlas_plotting_points_on_slice_16_0.png" src="../_images/notebooks_external_atlas_plotting_points_on_slice_16_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot points on the horizontal slice at dv=-5000um overlaid on allen dwi image</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_volume_on_slice</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">coord</span><span class="o">=-</span><span class="mi">5000</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">brain_atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_atlas_plotting_points_on_slice_17_0.png" src="../_images/notebooks_external_atlas_plotting_points_on_slice_17_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="atlas_circular_pyramidal_flatmap.html" class="btn btn-neutral float-left" title="Plotting brain region values on circular flatmap" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="atlas_swanson_flatmap.html" class="btn btn-neutral float-right" title="Plotting brain region values on the Swanson flat map" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>