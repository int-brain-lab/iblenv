<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loading SpikeSorting Data &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Loading Spike Waveforms" href="loading_spike_waveforms.html" />
    <link rel="prev" title="Loading Wheel Data" href="loading_wheel_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly available IBL data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_behavior.html">Data Release - Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_repro_ephys.html">Data Release - Reproducible Ephys Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_brainwidemap.html">Data Release - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_release_spikesorting_benchmarks.html">Data Release - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Information and troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html">Download the public datasets</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../loading_examples.html">Loading Data</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="loading_trials_data.html">Loading Trials Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_wheel_data.html">Loading Wheel Data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Loading SpikeSorting Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Relevant-Alf-objects">Relevant Alf objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Loading">Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#More-details">More details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Important-information">Important information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Useful-modules">Useful modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Exploring-spikesorting-data">Exploring spikesorting data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Example-1:-Loading-different-spikesorting-versions">Example 1: Loading different spikesorting versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-2:-Loading-additional-data">Example 2: Loading additional data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-3:-Compute-firing-rate-across-session">Example 3: Compute firing rate across session</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-4:-Find-clusters-labelled-as-good">Example 4: Find clusters labelled as good</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Example-5:-Plot-a-raster-for-all-units">Example 5: Plot a raster for all units</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Other-relevant-examples">Other relevant examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="loading_spike_waveforms.html">Loading Spike Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_passive_data.html">Loading Passive Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_ephys_data.html">Loading Ephys Data (AP and LFP band)</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_raw_ephys_data.html">Loading Raw Ephys Data (AP and LFP band)</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_video_data.html">Loading Video Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_raw_video_data.html">Loading Raw Video Data</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_moves.html">Working with wheel data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../loading_examples.html">Loading Data</a></li>
      <li class="breadcrumb-item active">Loading SpikeSorting Data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_external/loading_spikesorting_data.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Loading-SpikeSorting-Data">
<h1>Loading SpikeSorting Data<a class="headerlink" href="#Loading-SpikeSorting-Data" title="Link to this heading"></a></h1>
<p>Spikesorted output of electrophysiology data.</p>
<section id="Relevant-Alf-objects">
<h2>Relevant Alf objects<a class="headerlink" href="#Relevant-Alf-objects" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>channels</p></li>
<li><p>clusters</p></li>
<li><p>spikes</p></li>
</ul>
</section>
<section id="Loading">
<h2>Loading<a class="headerlink" href="#Loading" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">one.api</span> <span class="kn">import</span> <span class="n">ONE</span>
<span class="kn">from</span> <span class="nn">brainbox.io.one</span> <span class="kn">import</span> <span class="n">SpikeSortingLoader</span>
<span class="kn">from</span> <span class="nn">ibllib.atlas</span> <span class="kn">import</span> <span class="n">AllenAtlas</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span>
<span class="n">ba</span> <span class="o">=</span> <span class="n">AllenAtlas</span><span class="p">()</span>
<span class="n">pid</span> <span class="o">=</span> <span class="s1">&#39;da8dfec1-d265-44e8-84ce-6ae9c109b8bd&#39;</span>

<span class="n">sl</span> <span class="o">=</span> <span class="n">SpikeSortingLoader</span><span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">one</span><span class="o">=</span><span class="n">one</span><span class="p">,</span> <span class="n">atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">)</span>
<span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">load_spike_sorting</span><span class="p">()</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">merge_clusters</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Downloading: /home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/histology/ATLAS/Needles/Allen/average_template_25.nrrd Bytes: 32998960
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 31.470260620117188/31.470260620117188 [00:04&lt;00:00,  7.36it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Downloading: /home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/histology/ATLAS/Needles/Allen/annotation_25.nrrd Bytes: 4035363
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 3.848422050476074/3.848422050476074 [00:00&lt;00:00,  4.55it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-fg">2023-08-31 10:21:02.723 INFO     [atlas.py:1335] Computing brain atlas annotations lookup table</span>
<span class="ansi-cyan-fg">2023-08-31 10:21:16.46 INFO     [atlas.py:1359] Cached remapping file /home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/histology/ATLAS/Needles/Allen/annotation_25_lut_v01.npz ...</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/spikes.amps.npy: 100%|██████████| 141M/141M [00:01&lt;00:00, 72.8MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/spikes.clusters.npy: 100%|██████████| 70.3M/70.3M [00:00&lt;00:00, 76.3MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/spikes.times.npy: 100%|██████████| 141M/141M [00:00&lt;00:00, 169MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/spikes.depths.npy: 100%|██████████| 141M/141M [00:00&lt;00:00, 159MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/clusters.depths.npy: 100%|██████████| 3.78k/3.78k [00:00&lt;00:00, 27.5kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/clusters.uuids.csv: 100%|██████████| 33.8k/33.8k [00:00&lt;00:00, 224kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/clusters.channels.npy: 100%|██████████| 7.44k/7.44k [00:00&lt;00:00, 32.1kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/clusters.metrics.pqt: 100%|██████████| 108k/108k [00:00&lt;00:00, 561kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/channels.mlapdv.npy: 100%|██████████| 4.74k/4.74k [00:00&lt;00:00, 34.8kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/channels.rawInd.npy: 100%|██████████| 3.20k/3.20k [00:00&lt;00:00, 13.5kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/channels.localCoordinates.npy: 100%|██████████| 3.20k/3.20k [00:00&lt;00:00, 11.7kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/channels.brainLocationIds_ccf_2017.npy: 100%|██████████| 3.20k/3.20k [00:00&lt;00:00, 26.5kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/electrodeSites.brainLocationIds_ccf_2017.npy: 100%|██████████| 3.20k/3.20k [00:00&lt;00:00, 27.2kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/electrodeSites.mlapdv.npy: 100%|██████████| 4.74k/4.74k [00:00&lt;00:00, 34.4kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/electrodeSites.localCoordinates.npy: 100%|██████████| 3.20k/3.20k [00:00&lt;00:00, 10.9kB/s]
</pre></div></div>
</div>
<p>Alternatively, one can instantiate the spike sorting loader using the session unique identifier eid and the probe name pname:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eid</span><span class="p">,</span> <span class="n">pname</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">pid2eid</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="n">sl</span> <span class="o">=</span> <span class="n">SpikeSortingLoader</span><span class="p">(</span><span class="n">eid</span><span class="o">=</span><span class="n">eid</span><span class="p">,</span> <span class="n">pname</span><span class="o">=</span><span class="n">pname</span><span class="p">,</span> <span class="n">one</span><span class="o">=</span><span class="n">one</span><span class="p">,</span> <span class="n">atlas</span><span class="o">=</span><span class="n">ba</span><span class="p">)</span>
<span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">load_spike_sorting</span><span class="p">()</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">merge_clusters</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="More-details">
<h2>More details<a class="headerlink" href="#More-details" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/document/d/1OqIqqakPakHXRAwceYLwFY9gOrm8_P62XIfCTnHwstg/edit#heading=h.5houj8bng5o">Description of spikesorting datasets</a></p></li>
<li><p>Available spikesorting algorithms</p>
<ul>
<li><p><a class="reference external" href="https://github.com/int-brain-lab/pykilosort#readme">pykilosort</a> (All data)</p></li>
<li><p><a class="reference external" href="https://github.com/MouseLand/Kilosort/releases/tag/v2.5">Kilosort 2.5</a> (Most data collected before August 2021)</p></li>
</ul>
</li>
</ul>
</section>
<section id="Important-information">
<h2>Important information<a class="headerlink" href="#Important-information" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Data sorted with pykilosort is loaded by default. If the pykilosort spikesorting data is not available, the matlab kilosort 2.5 version will be loaded. See <a class="reference internal" href="#Example-1:-Loading-different-spikesorting-versions"><span class="std std-ref">Example 1</span></a> for more information.</p></li>
<li><p>The channel locations in the brain can come from several sources. it will load the most advanced version of the histology available, regardless of the spike sorting version loaded.
The steps, from most to least advanced, are:</p>
<ul class="simple">
<li><p><strong>alf</strong>: the final version of channel locations, same as resolved with the difference that data has been written out to files</p></li>
<li><p><strong>resolved</strong>: channel location alignments have been agreed upon</p></li>
<li><p><strong>aligned</strong>: channel locations have been aligned, but review or other alignments are pending, potentially not accurate</p></li>
<li><p><strong>traced</strong>: the histology track has been recovered from microscopy, however the depths may not match, inacurate data</p></li>
</ul>
</li>
<li><p>The attributes <code class="docutils literal notranslate"><span class="pre">mlapdv</span></code>, <code class="docutils literal notranslate"><span class="pre">atlas_ids</span></code> and <code class="docutils literal notranslate"><span class="pre">acronyms</span></code> in the <code class="docutils literal notranslate"><span class="pre">clusters</span></code> and <code class="docutils literal notranslate"><span class="pre">channels</span></code> objects are only available for probe insertions where <code class="docutils literal notranslate"><span class="pre">sl.histology</span></code> is equal to <strong>traced</strong>, <strong>aligned</strong>, <strong>resolved</strong> or <strong>alf</strong>.</p></li>
<li><p>The cluster and channel locations in the brain are only considered final for probe insertions with <code class="docutils literal notranslate"><span class="pre">sl.histology='resolved'</span></code>or <code class="docutils literal notranslate"><span class="pre">sl.histology='alf'</span></code>.</p></li>
</ol>
</section>
<section id="Useful-modules">
<h2>Useful modules<a class="headerlink" href="#Useful-modules" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://int-brain-lab.github.io/iblenv/_autosummary/brainbox.io.one.html#brainbox.io.one.SpikeSortingLoader">brainbox.io.one.SpikeSortingLoader</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/iblenv/_autosummary/brainbox.ephys_plots.html">brainbox.ephys_plots</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/iblenv/_autosummary/brainbox.population.decode.html#brainbox.population.decode.get_spike_counts_in_bins">brainbox.population.decode.get_spike_counts_in_bins</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/iblenv/_autosummary/brainbox.processing.html#brainbox.processing">brainbox.processing</a></p></li>
<li><p><a class="reference external" href="https://int-brain-lab.github.io/iblenv/_autosummary/brainbox.metrics.single_units.html#module-brainbox.metrics.single_units">brainbox.metrics.single_units</a></p></li>
</ul>
</section>
<section id="Exploring-spikesorting-data">
<h2>Exploring spikesorting data<a class="headerlink" href="#Exploring-spikesorting-data" title="Link to this heading"></a></h2>
<section id="Example-1:-Loading-different-spikesorting-versions">
<h3>Example 1: Loading different spikesorting versions<a class="headerlink" href="#Example-1:-Loading-different-spikesorting-versions" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># By default, if available, the data spikesorted with pykilosort is loaded.</span>
<span class="c1"># To find the spikesorting version that is loaded we can use</span>
<span class="n">sl</span><span class="o">.</span><span class="n">collection</span>

<span class="c1"># To see all available spikesorted data for this probe insertion we can list the collections.</span>
<span class="c1"># N.B. ks2.5 matlab spikesorted data is stored in the alf/probe00 folder</span>
<span class="n">sl</span><span class="o">.</span><span class="n">collections</span>

<span class="c1"># The following can be used to load a specific version of spikesorting</span>

<span class="c1"># pykilosort version</span>
<span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">load_spike_sorting</span><span class="p">(</span><span class="n">spike_sorter</span><span class="o">=</span><span class="s1">&#39;pykilosort&#39;</span><span class="p">)</span>

<span class="c1"># ks2.5 matlab version</span>
<span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">load_spike_sorting</span><span class="p">(</span><span class="n">spike_sorter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/spikes.depths.npy: 100%|██████████| 161M/161M [00:02&lt;00:00, 53.6MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/spikes.clusters.npy: 100%|██████████| 80.4M/80.4M [00:00&lt;00:00, 104MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/spikes.amps.npy: 100%|██████████| 161M/161M [00:01&lt;00:00, 115MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/spikes.times.npy: 100%|██████████| 161M/161M [00:00&lt;00:00, 171MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/clusters.channels.npy: 100%|██████████| 6.48k/6.48k [00:00&lt;00:00, 45.4kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/clusters.uuids.csv: 100%|██████████| 29.4k/29.4k [00:00&lt;00:00, 176kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/clusters.metrics.pqt: 100%|██████████| 97.0k/97.0k [00:00&lt;00:00, 294kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/clusters.depths.npy: 100%|██████████| 6.48k/6.48k [00:00&lt;00:00, 53.4kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/channels.rawInd.npy: 100%|██████████| 3.12k/3.12k [00:00&lt;00:00, 20.7kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/channels.localCoordinates.npy: 100%|██████████| 6.06k/6.06k [00:00&lt;00:00, 26.9kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/channels.brainLocationIds_ccf_2017.npy: 100%|██████████| 3.12k/3.12k [00:00&lt;00:00, 21.3kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/channels.mlapdv.npy: 100%|██████████| 4.62k/4.62k [00:00&lt;00:00, 35.2kB/s]
</pre></div></div>
</div>
</section>
<section id="Example-2:-Loading-additional-data">
<h3>Example 2: Loading additional data<a class="headerlink" href="#Example-2:-Loading-additional-data" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The default spikes and cluster attributes loaded are:</span>
<span class="c1"># spikes - amps, clusters, depths, times</span>
<span class="c1"># cluster - channels, depths, metrics</span>

<span class="c1">#Other attributes can additionally be loaded in the following way</span>
<span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">load_spike_sorting</span><span class="p">(</span><span class="n">dataset_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;clusters.amps&#39;</span><span class="p">,</span> <span class="s1">&#39;spikes.samples&#39;</span><span class="p">])</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">merge_clusters</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/spikes.samples.npy: 100%|██████████| 141M/141M [00:01&lt;00:00, 76.1MB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/#2022-10-31#/clusters.amps.npy: 100%|██████████| 7.44k/7.44k [00:00&lt;00:00, 53.5kB/s]
</pre></div></div>
</div>
</section>
<section id="Example-3:-Compute-firing-rate-across-session">
<h3>Example 3: Compute firing rate across session<a class="headerlink" href="#Example-3:-Compute-firing-rate-across-session" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">brainbox.ephys_plots</span> <span class="kn">import</span> <span class="n">image_fr_plot</span>
<span class="kn">from</span> <span class="nn">iblutil.numerical</span> <span class="kn">import</span> <span class="n">bincount2D</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">time_bin</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1"># time bin in seconds</span>
<span class="n">depth_bin</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># depth bin in um</span>

<span class="c1"># Remove any nan values</span>
<span class="n">kp_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spikes</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]),</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spikes</span><span class="p">[</span><span class="s1">&#39;depths&#39;</span><span class="p">]))</span>

<span class="n">fr</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">bincount2D</span><span class="p">(</span><span class="n">spikes</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="n">kp_idx</span><span class="p">],</span> <span class="n">spikes</span><span class="p">[</span><span class="s1">&#39;depths&#39;</span><span class="p">][</span><span class="n">kp_idx</span><span class="p">],</span> <span class="n">time_bin</span><span class="p">,</span> <span class="n">depth_bin</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-4:-Find-clusters-labelled-as-good">
<h3>Example 4: Find clusters labelled as good<a class="headerlink" href="#Example-4:-Find-clusters-labelled-as-good" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">good_clusterIDs</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">][</span><span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Example-5:-Plot-a-raster-for-all-units">
<h3>Example 5: Plot a raster for all units<a class="headerlink" href="#Example-5:-Plot-a-raster-for-all-units" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sl</span><span class="o">.</span><span class="n">raster</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/drift.times.npy: 100%|██████████| 15.8k/15.8k [00:00&lt;00:00, 81.4kB/s]
/home/runner/Downloads/ONE/openalyx.internationalbrainlab.org/hoferlab/Subjects/SWC_043/2020-09-21/001/alf/probe00/pykilosort/drift.um.npy: 100%|██████████| 142k/142k [00:00&lt;00:00, 531kB/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>Out[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1600x900 with 4 Axes&gt;,
 array([[&lt;Axes: title={&#39;center&#39;: &#39;2020-09-21_1_SWC_043_probe00, None \n17_575_242 spikes, 914 clusters&#39;}&gt;,
         &lt;Axes: &gt;],
        [&lt;Axes: xlabel=&#39;time (secs)&#39;, ylabel=&#39;depth (um)&#39;&gt;,
         &lt;Axes: title={&#39;center&#39;: &#39;alf&#39;}&gt;]], dtype=object))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_loading_spikesorting_data_21_2.png" src="../_images/notebooks_external_loading_spikesorting_data_21_2.png" />
</div>
</div>
</section>
</section>
<section id="Other-relevant-examples">
<h2>Other relevant examples<a class="headerlink" href="#Other-relevant-examples" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>COMING SOON</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="loading_wheel_data.html" class="btn btn-neutral float-left" title="Loading Wheel Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="loading_spike_waveforms.html" class="btn btn-neutral float-right" title="Loading Spike Waveforms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>