

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Computing the stimulus position using the wheel &mdash; IBL Library  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=17142d56" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../010_api_reference.html" />
    <link rel="prev" title="Working with wheel data" href="docs_wheel_moves.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBL Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Open Neurophysiology Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="one_quickstart.html">ONE Quick Start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://int-brain-lab.github.io/ONE/">Full documentation Website for ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/public_introduction.html">Publicly Available IBL Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/dataset_overview.html">What is available for download ?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Datasets - Collaboration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2025_data_release_brainwidemap.html">2025 - Brain Wide Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="2024_data_release_repro_ephys.html">2024 - Reproducible Ephys</a></li>
<li class="toctree-l1"><a class="reference internal" href="2021_data_release_behavior.html">2021 - Behavior</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Datasets - Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2025_data_release_autism_noel.html">2025 - Autism</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022_data_release_spikesorting_benchmarks.html">2022 - Spike sorting benchmark datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/data_release_pilot.html">Data Release - Pilot Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exploring IBL Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Installation of IBL Unified Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_structure.html">Get to know the datasets and folder structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html">Setting up credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html#Explore-and-download-data-using-the-ONE-api">Explore and download data using the ONE-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loading_examples.html">Loading Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../public_docs/information_contact.html">Getting Help: Information and Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples &amp; Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../atlas_examples.html">Atlas Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_wheel_moves.html">Working with wheel data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Computing the stimulus position using the wheel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Step-1:-Load-data">Step 1: Load data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-2:-Compute-evenly-sampled-wheel-data">Step 2: Compute evenly sampled wheel data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-3:-Extract-wheel-data-for-a-given-trial">Step 3: Extract wheel data for a given trial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-4:-Compute-the-position-in-mm">Step 4: Compute the position in mm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-5:-Compute-the-wheel-displacement-from-stimOn">Step 5: Compute the wheel displacement from stimOn</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-6:-Convert-wheel-displacement-to-screen-position">Step 6: Convert wheel displacement to screen position</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-7:-Fixing-screen-position-linked-to-events">Step 7: Fixing screen position linked to events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-8:-Plotting-our-results">Step 8: Plotting our results</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../010_api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Computing the stimulus position using the wheel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_external/docs_wheel_screen_stimulus.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Computing-the-stimulus-position-using-the-wheel">
<h1>Computing the stimulus position using the wheel<a class="headerlink" href="#Computing-the-stimulus-position-using-the-wheel" title="Link to this heading"></a></h1>
<p>In the IBL task a visual stimulus (Gabor patch of size 7°2) appears on the left (-35°) or right (+35°) of a screen and the mouse must use a wheel to bring the stimulus to the centre of the screen (0°). If the mouse moves the wheel in the correct direction, the trial is deemed correct and the mouse receives a reward. If however, the mouse moves the wheel 35° in the wrong direction and the stimulus goes off the screen, this is an error trial and the mouse receives a white noise error tone. The
screen was positioned 8 cm in front of the animal and centralized relative to the position of eyes to cover ~102 visual degree azimuth. In the case that the mouse moves the stimulus 35° in the wrong direction, the stimulus, therefore is visible for 20° and the rest is off the screen.</p>
<p>For some analyses it may be useful to know the position of the visual stimulus on the screen during a trial. While there is no direct read out of the location of the stimulus on the screen, as the stimulus is coupled to the wheel, we can infer the position using the wheel position.</p>
<p>Below we walk you through an example of how to compute the continuous stimulus position on the screen for a given trial.</p>
<p>For this anaylsis we need access to information about the wheel radius (3.1 cm) and the wheel gain (visual degrees moved on screen per mm of wheel movement). The wheel gain changes throughout the training period (see our <a class="reference external" href="https://doi.org/10.7554/eLife.63711">behavior paper</a> for more information) but for the majority of sessions is set at 4°/mm.</p>
<section id="Step-1:-Load-data">
<h2>Step 1: Load data<a class="headerlink" href="#Step-1:-Load-data" title="Link to this heading"></a></h2>
<p>For this analysis we will need to load in the trials and wheel data for a chosen session</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">one.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ONE</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;https://openalyx.internationalbrainlab.org&#39;</span><span class="p">)</span>

<span class="n">eid</span> <span class="o">=</span> <span class="s1">&#39;f88d4dd4-ccd7-400e-9035-fa00be3bcfa8&#39;</span>
<span class="n">trials</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;trials&#39;</span><span class="p">)</span>
<span class="n">wheel</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;wheel&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-2:-Compute-evenly-sampled-wheel-data">
<h2>Step 2: Compute evenly sampled wheel data<a class="headerlink" href="#Step-2:-Compute-evenly-sampled-wheel-data" title="Link to this heading"></a></h2>
<p>The wheel data returned is not evenly sampled, we can sample the data at 1000 Hz using the following function</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">brainbox.behavior.wheel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">wh</span>
<span class="n">wheel_pos</span><span class="p">,</span> <span class="n">wheel_times</span> <span class="o">=</span> <span class="n">wh</span><span class="o">.</span><span class="n">interpolate_position</span><span class="p">(</span><span class="n">wheel</span><span class="o">.</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">wheel</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-3:-Extract-wheel-data-for-a-given-trial">
<h2>Step 3: Extract wheel data for a given trial<a class="headerlink" href="#Step-3:-Extract-wheel-data-for-a-given-trial" title="Link to this heading"></a></h2>
<p>We now want to find the wheel data in the interval for a given trial</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># Choose trial no. 110 (right contrast = 1) ; or 150 (left)</span>
<span class="n">tr_idx</span> <span class="o">=</span> <span class="mi">110</span>
<span class="c1"># Get interval of trial, gives two values, start of trial and end of trial</span>
<span class="n">interval</span> <span class="o">=</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;intervals&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]</span>
<span class="c1"># Find the index of the wheel timestamps that contain this interval</span>
<span class="n">wheel_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">wheel_times</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
<span class="c1"># Limit our wheel data to these indexes</span>
<span class="n">wh_pos</span> <span class="o">=</span> <span class="n">wheel_pos</span><span class="p">[</span><span class="n">wheel_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">wheel_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">wh_times</span> <span class="o">=</span> <span class="n">wheel_times</span><span class="p">[</span><span class="n">wheel_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">wheel_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-4:-Compute-the-position-in-mm">
<h2>Step 4: Compute the position in mm<a class="headerlink" href="#Step-4:-Compute-the-position-in-mm" title="Link to this heading"></a></h2>
<p>The values for the wheel position are given in radians. Since the wheel gain is defined in visual degrees per mm we need to convert the wheel position to mm. We can use the radius of the wheel for this.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># radius of wheel in mm</span>
<span class="n">WHEEL_RADIUS</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">*</span> <span class="mi">10</span>
<span class="c1"># compute circumference of wheel</span>
<span class="n">wh_circ</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">WHEEL_RADIUS</span>
<span class="c1"># compute the mm turned be wheel degree</span>
<span class="n">mm_per_wh_deg</span> <span class="o">=</span> <span class="n">wh_circ</span> <span class="o">/</span> <span class="mi">360</span>
<span class="c1"># convert wh_pos from radians to degrees</span>
<span class="n">wh_pos</span> <span class="o">=</span> <span class="n">wh_pos</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># convert wh_pos from degrees to mm</span>
<span class="n">wh_pos</span> <span class="o">=</span> <span class="n">wh_pos</span> <span class="o">*</span> <span class="n">mm_per_wh_deg</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-5:-Compute-the-wheel-displacement-from-stimOn">
<h2>Step 5: Compute the wheel displacement from stimOn<a class="headerlink" href="#Step-5:-Compute-the-wheel-displacement-from-stimOn" title="Link to this heading"></a></h2>
<p>To link the visual stimulus movement to the wheel position we need to compute the displacement of the wheel position relative to the time at which the stimulus first appears on the screen.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the index of the wheel timestamps when the stimulus was presented (stimOn_times)</span>
<span class="n">idx_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">wh_times</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;stimOn_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">])</span>
<span class="c1"># Zero the wh_pos to the position at stimOn</span>
<span class="n">wh_pos</span> <span class="o">=</span> <span class="n">wh_pos</span> <span class="o">-</span> <span class="n">wh_pos</span><span class="p">[</span><span class="n">idx_stim</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-6:-Convert-wheel-displacement-to-screen-position">
<h2>Step 6: Convert wheel displacement to screen position<a class="headerlink" href="#Step-6:-Convert-wheel-displacement-to-screen-position" title="Link to this heading"></a></h2>
<p>Now that we have computed the displacement of the wheel relative to when the stimulus was presented we can use the wheel gain to convert this into degrees of the visual stimlus on the screen.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GAIN_MM_TO_SC_DEG</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">stim_pos</span> <span class="o">=</span> <span class="n">wh_pos</span> <span class="o">*</span> <span class="n">GAIN_MM_TO_SC_DEG</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-7:-Fixing-screen-position-linked-to-events">
<h2>Step 7: Fixing screen position linked to events<a class="headerlink" href="#Step-7:-Fixing-screen-position-linked-to-events" title="Link to this heading"></a></h2>
<p>The stim_pos values that we have above have been computed over the whole trial interval, from trial start to trial end. The stimlus on the screen however is can only move with the wheel between the time at which the stimlus is presented (stimOn_times) and the time at which a choice is made (response_times). After a response is made the visual stimulus then remains in a fixed position until the it disappears from the screen (stimOff_times)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the index of the wheel timestamps when the stimulus was presented (stimOn_times)</span>
<span class="n">idx_stim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">wh_times</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;stimOn_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">])</span>
<span class="c1"># Find the index of the wheel timestamps when the choice was made (response_times)</span>
<span class="n">idx_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">wh_times</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;response_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">])</span>
<span class="c1"># Find the index of the wheel timestamps when the stimulus disappears (stimOff_times)</span>
<span class="n">idx_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">wh_times</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;response_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">])</span>

<span class="c1"># Before stimOn no stimulus on screen, so set to nan</span>
<span class="n">stim_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">idx_stim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="c1"># Stimulus is in a fixed position between response time and stimOff time</span>
<span class="n">stim_pos</span><span class="p">[</span><span class="n">idx_res</span><span class="p">:</span><span class="n">idx_off</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stim_pos</span><span class="p">[</span><span class="n">idx_res</span><span class="p">]</span>
<span class="c1"># After stimOff no stimulus on screen, so set to nan</span>
<span class="n">stim_pos</span><span class="p">[</span><span class="n">idx_off</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
<p>The stim_pos values are given relative to stimOn times but the stimulus appears at either -35° or 35° depending on the stimlus side. We therefore need to apply this offset to our stimulus position. We also need to account for the convention that increasing wheel position indicates a counter-clockwise movement and therefore a left-ward (-ve) movement of the stimulus in visual azimuth.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># offset depends on whether stimulus was shown on left or right of screen</span>

<span class="n">ONSET_OFFSET</span> <span class="o">=</span> <span class="mi">35</span>

<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;contrastLeft&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]):</span>
    <span class="c1"># The stimulus appeared on the right</span>
    <span class="c1"># Values for the screen position will be &gt;0</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">ONSET_OFFSET</span>  <span class="c1"># The stimulus starts at +35 and goes to --&gt; 0</span>
    <span class="n">stim_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">stim_pos</span> <span class="o">+</span> <span class="n">offset</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># The stimulus appeared on the left</span>
    <span class="c1"># Values for the screen position will be &lt;0</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ONSET_OFFSET</span> <span class="c1"># The stimulus starts at -35 and goes to --&gt; 0</span>
    <span class="n">stim_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">stim_pos</span> <span class="o">+</span> <span class="n">offset</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-8:-Plotting-our-results">
<h2>Step 8: Plotting our results<a class="headerlink" href="#Step-8:-Plotting-our-results" title="Link to this heading"></a></h2>
<p>Finally we can plot our results to see if they make sense</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1"># On top axis plot the wheel displacement</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wh_times</span><span class="p">,</span> <span class="n">wh_pos</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;stimOn_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">],</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;response_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]],</span>
              <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;stimOn_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">],</span> <span class="mf">1.01</span><span class="p">,</span> <span class="s1">&#39;stimOn&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;response_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">],</span> <span class="mf">1.01</span><span class="p">,</span> <span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Wheel displacement (mm)&#39;</span><span class="p">)</span>


<span class="c1"># On bottom axis plot the stimulus position</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wh_times</span><span class="p">,</span> <span class="n">stim_pos</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;stimOn_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">],</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;response_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]],</span>
              <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;intervals&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">])</span>
<span class="c1"># black dotted lines indicate starting stimulus position</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">([</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span> <span class="o">*</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<span class="c1"># green line indicates threshold for good trial</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">)</span>
<span class="c1"># red lines indicate threshold for incorrect trial</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">([</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span> <span class="o">*</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;stimOn_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">trials</span><span class="p">[</span><span class="s1">&#39;response_times&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Visual azimuth angle (°)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time in session (s)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ContrastLeft: </span><span class="si">{</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;contrastLeft&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">, ContrastRight: </span><span class="si">{</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;contrastRight&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">,&quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;FeedbackType </span><span class="si">{</span><span class="n">trials</span><span class="p">[</span><span class="s1">&#39;feedbackType&#39;</span><span class="p">][</span><span class="n">tr_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>Out[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0.98, &#39;ContrastLeft: nan, ContrastRight: 1.0,FeedbackType 1.0&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_external_docs_wheel_screen_stimulus_28_1.png" src="../_images/notebooks_external_docs_wheel_screen_stimulus_28_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="docs_wheel_moves.html" class="btn btn-neutral float-left" title="Working with wheel data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../010_api_reference.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, International Brain Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>